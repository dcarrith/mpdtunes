!function(b,a){function c(a,h){for(var f,e=[],q=0;q<a.length;++q){var l;if(!(l=g[a[q]]))a:{l=b;for(var d=a[q].split(/[.\/]/),c=0;c<d.length;++c){if(!l[d[c]]){l=void 0;break a}l=l[d[c]]}}if(f=l,!f)throw"module definition dependecy not found: "+a[q];e.push(f)}h.apply(null,e)}function d(b,h,f){if("string"!=typeof b)throw"invalid module definition, module id must be defined and be a string";if(h===a)throw"invalid module definition, dependencies must be specified";if(f===a)throw"invalid module definition, definition function must be specified";
c(h,function(){g[b]=f.apply(null,arguments)})}var g={};d("moxie/core/utils/Basic",[],function(){var a=function(a){return void 0===a?"undefined":null===a?"null":a.nodeType?"node":{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},b=function(q){return f(arguments,function(d,c){0<c&&f(d,function(f,d){void 0!==f&&(a(q[d])===a(f)&&~e(a(f),["array","object"])?b(q[d],f):q[d]=f)})}),q},f=function(a,e){var f,b;if(a){try{f=a.length}catch(h){f=void 0}if(void 0===f)for(b in a){if(a.hasOwnProperty(b)&&
!1===e(a[b],b))break}else for(b=0;f>b&&!1!==e(a[b],b);b++);}},e=function(a,e){if(e){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,a);for(var f=0,b=e.length;b>f;f++)if(e[f]===a)return f}return-1};return{guid:function(){var a=0;return function(e){var f=(new Date).getTime().toString(32),b;for(b=0;5>b;b++)f+=Math.floor(65535*Math.random()).toString(32);return(e||"o_")+f+(a++).toString(32)}}(),typeOf:a,extend:b,each:f,isEmptyObj:function(e){var f;if(!e||"object"!==a(e))return!0;for(f in e)return!1;
return!0},inSeries:function(e,f){function b(d){"function"===a(e[d])&&e[d](function(a){++d<h&&!a?b(d):f(a)})}var h=e.length;"function"!==a(f)&&(f=function(){});e&&e.length||f();b(0)},inArray:e,arrayDiff:function(f,b){var h=[];"array"!==a(f)&&(f=[f]);"array"!==a(b)&&(b=[b]);for(var d in f)-1===e(f[d],b)&&h.push(f[d]);return h.length?h:!1},arrayIntersect:function(a,b){var h=[];return f(a,function(a){-1!==e(a,b)&&h.push(a)}),h.length?h:null},toArray:function(a){var e,f=[];for(e=0;e<a.length;e++)f[e]=
a[e];return f},trim:function(a){return a?String.prototype.trim?String.prototype.trim.call(a):a.toString().replace(/^\s*/,"").replace(/\s*$/,""):a},parseSizeStr:function(a){if("string"!=typeof a)return a;var e={t:1099511627776,g:1073741824,m:1048576,k:1024},f;return a=/^([0-9]+)([mgk]?)$/.exec(a.toLowerCase().replace(/[^0-9mkg]/g,"")),f=a[2],a=+a[1],e.hasOwnProperty(f)&&(a*=e[f]),a}}});d("moxie/core/I18n",["moxie/core/utils/Basic"],function(a){var b={};return{addI18n:function(f){return a.extend(b,
f)},translate:function(a){return b[a]||a},_:function(a){return this.translate(a)},sprintf:function(f){var e=[].slice.call(arguments,1),b="";return a.each(f.split(/%[a-z]/),function(a){b+=a;e.length&&(b+=e.shift())}),b}}});d("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(a,b){var f={mimes:{},extensions:{},addMimeType:function(a){a=a.split(/,/);var f,b,h;for(f=0;f<a.length;f+=2){h=a[f+1].split(/ /);for(b=0;b<h.length;b++)this.mimes[h[b]]=a[f];this.extensions[a[f]]=h}},
extList2mimes:function(e,f){var b,h,d,c,p=[];for(h=0;h<e.length;h++)for(b=e[h].extensions.split(/\s*,\s*/),d=0;d<b.length;d++){if("*"===b[d])return[];if(c=this.mimes[b[d]])-1===a.inArray(c,p)&&p.push(c);else{if(!f||!/^\w+$/.test(b[d]))return[];p.push("."+b[d])}}return p},mimes2extList:function(e){var f=this,d=[],c=[];return e=a.trim(e).split(/\s*,\s*/),"*"!==e&&a.each(e,function(e){var b=e.match(/^(\w+)\/(\*|\w+)$/);b&&("*"===b[2]?a.each(f.extensions,function(a,e){RegExp("^"+b[1]+"/").test(e)&&[].push.apply(d,
f.extensions[e])}):f.extensions[e]&&[].push.apply(d,f.extensions[e]))}),c.push({title:b.translate("Files"),extensions:d.length?d.join(","):"*"}),c.mimes=e,c},getFileExtension:function(a){return(a=a&&a.match(/\.([^.]+)$/))?a[1].toLowerCase():""},getFileMime:function(a){return this.mimes[this.getFileExtension(a)]||""}};return f.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/mp4,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe"),
f});d("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(a){function b(a){for(var e,f,h=0;h<a.length;h++)if(e=a[h].s1,f=a[h].prop,c=a[h].sv||a[h].id,e){if(-1!=e.indexOf(a[h].s2))return a[h].id}else if(f)return a[h].id}function f(a){var e=a.indexOf(c);if(-1!=e)return parseFloat(a.substring(e+c.length+1))}var e=[{s1:navigator.userAgent,s2:"Android",id:"Android Browser",sv:"Version"},{s1:navigator.userAgent,s2:"Chrome",id:"Chrome"},{s1:navigator.vendor,s2:"Apple",id:"Safari",sv:"Version"},{prop:window.opera&&
window.opera.buildNumber,id:"Opera",sv:"Version"},{s1:navigator.vendor,s2:"KDE",id:"Konqueror"},{s1:navigator.userAgent,s2:"Firefox",id:"Firefox"},{s1:navigator.vendor,s2:"Camino",id:"Camino"},{s1:navigator.userAgent,s2:"Netscape",id:"Netscape"},{s1:navigator.userAgent,s2:"MSIE",id:"IE",sv:"MSIE"},{s1:navigator.userAgent,s2:"Gecko",id:"Mozilla",sv:"rv"}],d=[{s1:navigator.platform,s2:"Win",id:"Windows"},{s1:navigator.platform,s2:"Mac",id:"Mac"},{s1:navigator.userAgent,s2:"iPhone",id:"iOS"},{s1:navigator.userAgent,
s2:"iPad",id:"iOS"},{s1:navigator.userAgent,s2:"Android",id:"Android"},{s1:navigator.platform,s2:"Linux",id:"Linux"}],c,s={can:function(){var e={define_property:!1,create_canvas:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),return_response_type:function(e){try{if(-1!==a.inArray(e,["","text","document"]))return!0;if(window.XMLHttpRequest){var f=new XMLHttpRequest;if(f.open("get","/"),"responseType"in f)return f.responseType=e,f.responseType!==e?!1:
!0}}catch(b){}return!1},use_data_uri:function(){var a=new Image;return a.onload=function(){e.use_data_uri=1===a.width&&1===a.height},setTimeout(function(){a.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return e.use_data_uri&&("IE"!==s.browser||9<=s.version)},use_data_uri_of:function(a){return e.use_data_uri&&33E3>a||e.use_data_uri_over32kb()},use_fileinput:function(){var a=document.createElement("input");return a.setAttribute("type",
"file"),!a.disabled}};return function(f){var b=[].slice.call(arguments);return b.shift(),"function"===a.typeOf(e[f])?e[f].apply(this,b):!!e[f]}}(),browser:b(e),version:f(navigator.userAgent)||f(navigator.appVersion),OS:b(d),swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return s});d("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(a){var b=function(a,e){var b;return""===a.className?!1:(b=RegExp("(^|\\s+)"+
e+"(\\s+|$)"),b.test(a.className))};return{get:function(a){return"string"!=typeof a?a:document.getElementById(a)},hasClass:b,addClass:function(a,e){b(a,e)||(a.className=""===a.className?e:a.className.replace(/\s+$/,"")+" "+e)},removeClass:function(a,e){a.className=a.className.replace(RegExp("(^|\\s+)"+e+"(\\s+|$)"),function(a,e,f){return" "===e&&" "===f?" ":""})},getStyle:function(a,e){return a.currentStyle?a.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(a,null)[e]:void 0},getPos:function(f,
e){function b(a){var e,f,h=0,d=0;return a&&(f=a.getBoundingClientRect(),e="CSS1Compat"===m.compatMode?m.documentElement:m.body,h=f.left+e.scrollLeft,d=f.top+e.scrollTop),{x:h,y:d}}var h=0,d=0,c,m=document,p;if(e=e||m.body,f&&f.getBoundingClientRect&&"IE"===a.browser&&(!m.documentMode||8>m.documentMode))return c=b(f),p=b(e),{x:c.x-p.x,y:c.y-p.y};for(c=f;c&&c!=e&&c.nodeType;)h+=c.offsetLeft||0,d+=c.offsetTop||0,c=c.offsetParent;for(c=f.parentNode;c&&c!=e&&c.nodeType;)h-=c.scrollLeft||0,d-=c.scrollTop||
0,c=c.parentNode;return{x:h,y:d}},getSize:function(a){return{w:a.offsetWidth||a.clientWidth,h:a.offsetHeight||a.clientHeight}}}});d("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(a){function b(a,e){for(var h in a)if(a[h]===e)return h;return null}return{RuntimeError:function(){function f(a){this.code=a;this.name=b(e,a);this.message=this.name+": RuntimeError "+this.code}var e={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return a.extend(f,e),f.prototype=Error.prototype,f}(),OperationNotAllowedException:function(){function f(a){this.code=
a;this.name="OperationNotAllowedException"}return a.extend(f,{NOT_ALLOWED_ERR:1}),f.prototype=Error.prototype,f}(),ImageError:function(){function f(a){this.code=a;this.name=b(e,a);this.message=this.name+": ImageError "+this.code}var e={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return a.extend(f,e),f.prototype=Error.prototype,f}(),FileException:function(){function f(a){this.code=a;this.name=b(e,a);this.message=this.name+": FileException "+this.code}var e={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,
ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return a.extend(f,e),f.prototype=Error.prototype,f}(),DOMException:function(){function f(a){this.code=a;this.name=b(e,a);this.message=this.name+": DOMException "+this.code}var e={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,
INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return a.extend(f,e),f.prototype=Error.prototype,f}(),EventException:function(){function f(a){this.code=a;this.name="EventException"}return a.extend(f,{UNSPECIFIED_EVENT_TYPE_ERR:0}),f.prototype=Error.prototype,f}()}});d("moxie/core/EventTarget",["moxie/core/Exceptions",
"moxie/core/utils/Basic"],function(a,b){function f(){var e={};b.extend(this,{uid:null,init:function(){this.uid||(this.uid=b.guid("uid_"))},addEventListener:function(a,f,d,c){var k=this,p;return a=b.trim(a),/\s/.test(a)?(b.each(a.split(/\s+/),function(a){k.addEventListener(a,f,d,c)}),void 0):(a=a.toLowerCase(),d=parseInt(d,10)||0,p=e[this.uid]&&e[this.uid][a]||[],p.push({fn:f,priority:d,scope:c||this}),e[this.uid]||(e[this.uid]={}),e[this.uid][a]=p,void 0)},hasEventListener:function(a){return a?!(!e[this.uid]||
!e[this.uid][a]):!!e[this.uid]},removeEventListener:function(a,f){a=a.toLowerCase();var d=e[this.uid]&&e[this.uid][a],c;if(d){if(f)for(c=d.length-1;0<=c;c--){if(d[c].fn===f){d.splice(c,1);break}}else d=[];d.length||(delete e[this.uid][a],b.isEmptyObj(e[this.uid])&&delete e[this.uid])}},removeAllEventListeners:function(){e[this.uid]&&delete e[this.uid]},dispatchEvent:function(f){var d,c,n,m={};if("string"!==b.typeOf(f)){if(c=f,"string"!==b.typeOf(c.type))throw new a.EventException(a.EventException.UNSPECIFIED_EVENT_TYPE_ERR);
f=c.type;c.total&&c.loaded&&(m.total=c.total,m.loaded=c.loaded);m.async=c.async||!1}if(-1!==f.indexOf("::")?function(a){d=a[0];f=a[1]}(f.split("::")):d=this.uid,f=f.toLowerCase(),c=e[d]&&e[d][f]){c.sort(function(a,e){return e.priority-a.priority});n=[].slice.call(arguments);n.shift();m.type=f;n.unshift(m);var p=[];b.each(c,function(a){n[0].target=a.scope;m.async?p.push(function(e){setTimeout(function(){e(!1===a.fn.apply(a.scope,n))},1)}):p.push(function(e){e(!1===a.fn.apply(a.scope,n))})});p.length&&
b.inSeries(p)}return!0},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(a){var e;"array"!==b.typeOf(a)&&(a=[a]);for(var f=0;f<a.length;f++)e="on"+a[f],"function"===b.typeOf(this[e])?this.addEventListener(a[f],this[e]):"undefined"===b.typeOf(this[e])&&
(this[e]=null)}})}return f.instance=new f,f});d("moxie/core/utils/Encode",[],function(){var a=function(a){return unescape(encodeURIComponent(a))},b=function(a){return decodeURIComponent(escape(a))};return{utf8_encode:a,utf8_decode:b,atob:function(a,e){if("function"==typeof window.atob)return e?b(window.atob(a)):window.atob(a);var d,c,k,n,m,p=0,t=0,y="",v=[];if(!a)return a;a+="";do d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(p++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(p++)),
n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(p++)),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(p++)),k=d<<18|c<<12|n<<6|m,d=255&k>>16,c=255&k>>8,k&=255,v[t++]=64==n?String.fromCharCode(d):64==m?String.fromCharCode(d,c):String.fromCharCode(d,c,k);while(p<a.length);return y=v.join(""),e?b(y):y},btoa:function(b,e){if(e&&a(b),"function"==typeof window.btoa)return window.btoa(b);var d,c,h,n,m=0,p=0,t="",t=[];if(!b)return b;
do d=b.charCodeAt(m++),c=b.charCodeAt(m++),h=b.charCodeAt(m++),n=d<<16|c<<8|h,d=63&n>>18,c=63&n>>12,h=63&n>>6,n&=63,t[p++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n);while(m<b.length);t=t.join("");m=b.length%3;return(m?t.slice(0,m-3):
t)+"===".slice(m||3)}}});d("moxie/runtime/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(a,b,f){function e(f,d,q,p,t){var y=this,v,r=a.guid(d+"_");c[r]=this;q=a.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,
send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},q);v=function(){var e={};return{exec:function(a,b,f,d){return v[b]&&(e[a]||(e[a]={context:this,instance:new v[b]}),e[a].instance[f])?e[a].instance[f].apply(this,d):void 0},removeInstance:function(a){delete e[a]},removeAllInstances:function(){var b=this;a.each(e,function(e,f){"function"===a.typeOf(e.instance.destroy)&&e.instance.destroy.call(e.context);
b.removeInstance(f)})}}}();a.extend(this,{initialized:!1,uid:r,type:d,mode:null,shimid:r+"_container",clients:0,options:f,can:function(b,f,d){d=d||q;if("string"===a.typeOf(b)&&"undefined"===a.typeOf(f)&&(b=e.parseCaps(b)),"object"===a.typeOf(b)){for(var c in b)if(!this.can(c,b[c],d))return!1;return!0}return"function"===a.typeOf(d[b])?d[b].call(this,f):f===d[b]},getShimContainer:function(){var e,f=b.get(this.shimid);return f||(e=this.options.container?b.get(this.options.container):document.body,f=
document.createElement("div"),f.id=this.shimid,f.className="moxie-shim moxie-shim-"+this.type,a.extend(f.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),e.appendChild(f)),f},getShim:function(){return v},shimExec:function(a,e){var b=[].slice.call(arguments,2);return y.getShim().exec.call(this,this.uid,a,e,b)},exec:function(a,e){var b=[].slice.call(arguments,2);return y[a]&&y[a][e]?y[a][e].apply(this,b):y.shimExec.apply(this,arguments)},destroy:function(){if(y){var a=
b.get(this.shimid);a&&a.parentNode.removeChild(a);v&&v.removeAllInstances();this.unbindAll();delete c[this.uid];r=y=v=this.uid=null}}});(function(e,b){var d=null,c=f&&f.required_caps;return b=b||"browser",null!==this.mode?this.mode:(c&&!a.isEmptyObj(e)&&(a.each(c,function(b,f){if(e.hasOwnProperty(f)){var c=e[f](b);if("string"==typeof c&&(c=[c]),d){if(!(d=a.arrayIntersect(d,c)))return d=!1}else d=c}}),d?this.mode=-1!==a.inArray(b,d)?b:d[0]:!1===d&&(this.mode=!1)),null===this.mode&&(this.mode=b),this.mode&&
c&&!this.can(c)&&(this.mode=!1),void 0)}).call(this,p,t)}var d={},c={};return e.order="html5,flash,silverlight,html4",e.getRuntime=function(a){return c[a]?c[a]:!1},e.addConstructor=function(a,e){e.prototype=f.instance;d[a]=e},e.getConstructor=function(a){return d[a]||null},e.getInfo=function(a){var b=e.getRuntime(a);return b?{uid:b.uid,type:b.type,can:function(){return b.can.apply(b,arguments)}}:null},e.parseCaps=function(e){var b={};return"string"!==a.typeOf(e)?e||{}:(a.each(e.split(","),function(a){b[a]=
!0}),b)},e.can=function(a,b){var f,d=e.getConstructor(a),c;return d?(f=new d({required_caps:b}),c=f.mode,f.destroy(),!!c):!1},e.thatCan=function(a,b){var f=(b||e.order).split(/\s*,\s*/),d;for(d in f)if(e.can(f[d],a))return f[d];return null},e.capTrue=function(){return!0},e.capFalse=function(){return!1},e.capTest=function(a){return function(){return!!a}},e});d("moxie/runtime/RuntimeClient",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(a,b,f){return function(){var e;
b.extend(this,{connectRuntime:function(d){function c(b){var h,t;return b.length?(h=b.shift(),(t=f.getConstructor(h))?(e=new t(d),e.bind("Init",function(){e.initialized=!0;setTimeout(function(){e.clients++;s.trigger("RuntimeInit",e)},1)}),e.bind("Error",function(){e.destroy();c(b)}),e.mode?(e.init(),void 0):(e.trigger("Error"),void 0)):(c(b),void 0)):(s.trigger("RuntimeError",new a.RuntimeError(a.RuntimeError.NOT_INIT_ERR)),e=null,void 0)}var s=this,n;if("string"===b.typeOf(d)?n=d:"string"===b.typeOf(d.ruid)&&
(n=d.ruid),n){if(e=f.getRuntime(n))return e.clients++,e;throw new a.RuntimeError(a.RuntimeError.NOT_INIT_ERR);}c((d.runtime_order||f.order).split(/\s*,\s*/))},getRuntime:function(){return e&&e.uid?e:(e=null,null)},disconnectRuntime:function(){e&&0>=--e.clients&&(e.destroy(),e=null)}})}});d("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(a,b,f){function e(c,s){function n(b,f,c){var h,l=d[this.uid];return"string"===a.typeOf(l)&&l.length?
(h=new e(null,{type:c,size:f-b}),h.detach(l.substr(b,h.size)),h):null}f.call(this);c&&this.connectRuntime(c);s?"string"===a.typeOf(s)&&(s={data:s}):s={};a.extend(this,{uid:s.uid||a.guid("uid_"),ruid:c,size:s.size||0,type:s.type||"",slice:function(a,b,e){return this.isDetached()?n.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),a,b,e)},getSource:function(){return d[this.uid]?d[this.uid]:null},detach:function(a){this.ruid&&(this.getRuntime().exec.call(this,"Blob",
"destroy",d[this.uid]),this.disconnectRuntime(),this.ruid=null);a=a||"";var e=a.match(/^data:([^;]*);base64,/);e&&(this.type=e[1],a=b.atob(a.substring(a.indexOf("base64,")+7)));this.size=a.length;d[this.uid]=a},isDetached:function(){return!this.ruid&&"string"===a.typeOf(d[this.uid])},destroy:function(){this.detach();delete d[this.uid]}});s.data?this.detach(s.data):d[this.uid]=s}var d={};return e});d("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(a,
b,f){function e(e,d){var c,n;(d||(d={}),n=d.type&&""!==d.type?d.type:b.getFileMime(d.name),d.name)?(c=d.name.replace(/\\/g,"/"),c=c.substr(c.lastIndexOf("/")+1)):(c=n.split("/")[0],c=a.guid((""!==c?c:"file")+"_"),b.extensions[n]&&(c+="."+b.extensions[n][0]));f.apply(this,arguments);a.extend(this,{type:n||"",name:c||a.guid("file_"),lastModifiedDate:d.lastModifiedDate||(new Date).toLocaleString()})}return e.prototype=f.prototype,e});d("moxie/file/FileInput","moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/I18n moxie/file/File moxie/runtime/Runtime moxie/runtime/RuntimeClient".split(" "),
function(a,b,f,e,d,c,s,n,m){function p(d){var q=this,p;if(-1!==a.inArray(a.typeOf(d),["string","node"])&&(d={browse_button:d}),p=f.get(d.browse_button),!p)throw new e.DOMException(e.DOMException.NOT_FOUND_ERR);p={accept:[{title:c.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:p.parentNode||document.body};d=a.extend({},p,d);"string"==typeof d.required_caps&&(d.required_caps=n.parseCaps(d.required_caps));"string"==typeof d.accept&&(d.accept=b.mimes2extList(d.accept));
(p=f.get(d.container))||(p=document.body);"static"===f.getStyle(p,"position")&&(p.style.position="relative");p=p=null;m.call(q);a.extend(q,{uid:a.guid("uid_"),ruid:null,files:null,init:function(){q.convertEventPropsToHandlers(t);q.bind("RuntimeInit",function(b,e){q.ruid=e.uid;q.bind("Ready",function(){q.trigger("Refresh")},999);q.bind("Change",function(){var b=e.exec.call(q,"FileInput","getFiles");q.files=[];a.each(b,function(a){q.files.push(new s(q.ruid,a))})},999);q.bind("Refresh",function(){var b,
c,h,q;h=f.get(d.browse_button);q=f.get(e.shimid);h&&(b=f.getPos(h,f.get(d.container)),c=f.getSize(h),q&&a.extend(q.style,{top:b.y+"px",left:b.x+"px",width:c.w+"px",height:c.h+"px"}))});e.exec.call(q,"FileInput","init",d)});q.connectRuntime(a.extend({},d,{required_caps:{select_file:!0}}))},disable:function(b){var e=this.getRuntime();e&&e.exec.call(this,"FileInput","disable","undefined"===a.typeOf(b)?!0:b)},refresh:function(){q.trigger("Refresh")},destroy:function(){var b=this.getRuntime();b&&(b.exec.call(this,
"FileInput","destroy"),this.disconnectRuntime());"array"===a.typeOf(this.files)&&a.each(this.files,function(a){a.destroy()});this.files=null}})}var t="ready change cancel mouseenter mouseleave mousedown mouseup".split(" ");return p.prototype=d.instance,p});d("moxie/file/FileDrop","moxie/core/I18n moxie/core/utils/Dom moxie/core/Exceptions moxie/core/utils/Basic moxie/file/File moxie/runtime/RuntimeClient moxie/core/EventTarget moxie/core/utils/Mime".split(" "),function(a,b,f,e,d,c,s,n){function m(f){var m=
this,s;"string"==typeof f&&(f={drop_zone:f});s={accept:[{title:a.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};f="object"==typeof f?e.extend({},s,f):s;f.container=b.get(f.drop_zone)||document.body;"static"===b.getStyle(f.container,"position")&&(f.container.style.position="relative");"string"==typeof f.accept&&(f.accept=n.mimes2extList(f.accept));c.call(m);e.extend(m,{uid:e.guid("uid_"),ruid:null,files:null,init:function(){m.convertEventPropsToHandlers(p);m.bind("RuntimeInit",
function(a,b){m.ruid=b.uid;m.bind("Drop",function(){var a=b.exec.call(m,"FileDrop","getFiles");m.files=[];e.each(a,function(a){m.files.push(new d(m.ruid,a))})},999);b.exec.call(m,"FileDrop","init",f);m.dispatchEvent("ready")});m.connectRuntime(f)},destroy:function(){var a=this.getRuntime();a&&(a.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime());this.files=null}})}var p=["ready","dragenter","dragleave","drop","error"];return m.prototype=s.instance,m});d("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic",
"moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(a,b,f){function e(){this.uid=a.guid("uid_");b.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}return e.prototype=f.instance,e});d("moxie/file/FileReader","moxie/core/utils/Basic moxie/core/utils/Encode moxie/core/Exceptions moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/runtime/RuntimeTarget".split(" "),function(a,b,f,e,d,c,s){function n(){function e(a,k){function p(a){c.readyState=n.DONE;
c.error=a;c.trigger("error");g()}function g(){l.destroy();l=null;c.trigger("loadend")}function x(b){l.bind("Error",function(a,b){p(b)});l.bind("Progress",function(a){c.result=b.exec.call(l,"FileReader","getResult");c.trigger(a)});l.bind("Load",function(a){c.readyState=n.DONE;c.result=b.exec.call(l,"FileReader","getResult");c.trigger(a);g()});b.exec.call(l,"FileReader","read",a,k)}if(l=new s,this.convertEventPropsToHandlers(m),this.readyState===n.LOADING)return p(new f.DOMException(f.DOMException.INVALID_STATE_ERR));
if(this.readyState=n.LOADING,this.trigger("loadstart"),k instanceof d)if(k.isDetached()){var u=k.getSource();switch(a){case "readAsText":case "readAsBinaryString":this.result=u;break;case "readAsDataURL":this.result="data:"+k.type+";base64,"+b.btoa(u)}this.readyState=n.DONE;this.trigger("load");g()}else x(l.connectRuntime(k.ruid));else p(new f.DOMException(f.DOMException.NOT_FOUND_ERR))}var c=this,l;a.extend(this,{uid:a.guid("uid_"),readyState:n.EMPTY,result:null,error:null,readAsBinaryString:function(a){e.call(this,
"readAsBinaryString",a)},readAsDataURL:function(a){e.call(this,"readAsDataURL",a)},readAsText:function(a){e.call(this,"readAsText",a)},abort:function(){this.result=null;-1===a.inArray(this.readyState,[n.EMPTY,n.DONE])&&(this.readyState===n.LOADING&&(this.readyState=n.DONE),l&&l.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort();l&&(l.getRuntime().exec.call(this,"FileReader","destroy"),l.disconnectRuntime());c=l=null}})}
var m="loadstart progress load abort error loadend".split(" ");return n.EMPTY=0,n.LOADING=1,n.DONE=2,n.prototype=e.instance,n});d("moxie/core/utils/Url",[],function(){var a=function(a){var b="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" "),e=b.length,d={http:80,https:443},c={};for(a=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(a||
"");e--;)a[e]&&(c[b[e]]=a[e]);/^[^\/]/.test(c.path)&&!c.scheme&&(b=document.location.pathname,/(\/|\/[^\.]+)$/.test(b)||(b=b.replace(/[^\/]+$/,"")),c.host=document.location.hostname,c.path=b+(c.path||""));return c.scheme||(c.scheme=document.location.protocol.replace(/:$/,"")),c.host||(c.host=document.location.hostname),c.port||(c.port=document.location.port||d[c.scheme]||80),c.port=parseInt(c.port,10),c.path||(c.path="/"),delete c.source,c};return{parseUrl:a,resolveUrl:function(b){b=a(b);return b.scheme+
"://"+b.host+(b.port!=={http:80,https:443}[b.scheme]?":"+b.port:"")+b.path+(b.query?b.query:"")},hasSameOrigin:function(b){function f(a){return[a.scheme,a.host,a.port].join("/")}return"string"==typeof b&&(b=a(b)),f(a())===f(b)}}});d("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(a,b,f){return function(){function e(a,b){if(!b.isDetached()){var e=this.connectRuntime(b.ruid).exec.call(this,"FileReaderSync","read",a,b);return this.disconnectRuntime(),
e}e=b.getSource();switch(a){case "readAsBinaryString":return e;case "readAsDataURL":return"data:"+b.type+";base64,"+f.btoa(e);case "readAsText":for(var d="",c=0,h=e.length;h>c;c++)d+=String.fromCharCode(e[c]);return d}}b.call(this);a.extend(this,{uid:a.guid("uid_"),readAsBinaryString:function(a){return e.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){return e.call(this,"readAsDataURL",a)},readAsText:function(a){return e.call(this,"readAsText",a)}})}});d("moxie/xhr/FormData",["moxie/core/Exceptions",
"moxie/core/utils/Basic","moxie/file/Blob"],function(a,b,f){return function(){var a,d={};b.extend(this,{append:function(c,k){var n=this,m=b.typeOf(k);k instanceof f?(a&&delete d[a],a=c,d[c]=[k]):"array"===m?(c+="[]",b.each(k,function(a){n.append.call(n,c,a)})):"object"===m?b.each(k,function(a,b){n.append.call(n,c+"["+b+"]",a)}):(k=k.toString(),d[c]||(d[c]=[]),d[c].push(k))},hasBlob:function(){return!!a},getBlob:function(){return d[a]&&d[a][0]||null},getBlobName:function(){return a||null},each:function(a){b.each(d,
function(e,f){b.each(e,function(b){a(b,f)})})},destroy:function(){a=null;d={}}})}});d("moxie/xhr/XMLHttpRequest","moxie/core/utils/Basic moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/core/utils/Url moxie/runtime/Runtime moxie/runtime/RuntimeTarget moxie/file/Blob moxie/file/FileReaderSync moxie/xhr/FormData moxie/core/utils/Env moxie/core/utils/Mime".split(" "),function(a,b,f,e,d,c,s,n,m,p,t,y){function v(){this.uid=a.guid("uid_")}function r(){function f(a,b){return B.hasOwnProperty(a)?
1===arguments.length?t.can("define_property")?B[a]:w[a]:(t.can("define_property")?B[a]=b:w[a]=b,void 0):void 0}function m(b){function e(){D.destroy();D=null;h.dispatchEvent("loadend");h=null}function d(c){D.bind("LoadStart",function(a){f("readyState",r.LOADING);h.dispatchEvent("readystatechange");h.dispatchEvent(a);M&&h.upload.dispatchEvent(a)});D.bind("Progress",function(a){f("readyState")!==r.LOADING&&(f("readyState",r.LOADING),h.dispatchEvent("readystatechange"));h.dispatchEvent(a)});D.bind("UploadProgress",
function(a){M&&h.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:a.total,loaded:a.loaded})});D.bind("Load",function(b){f("readyState",r.DONE);f("status",Number(c.exec.call(D,"XMLHttpRequest","getStatus")||0));f("statusText",g[f("status")]||"");f("response",c.exec.call(D,"XMLHttpRequest","getResponse",f("responseType")));~a.inArray(f("responseType"),["text",""])?f("responseText",f("response")):"document"===f("responseType")&&f("responseXML",f("response"));J=c.exec.call(D,"XMLHttpRequest",
"getAllResponseHeaders");h.dispatchEvent("readystatechange");0<f("status")?(M&&h.upload.dispatchEvent(b),h.dispatchEvent(b)):(K=!0,h.dispatchEvent("error"));e()});D.bind("Abort",function(a){h.dispatchEvent(a);e()});D.bind("Error",function(a){K=!0;f("readyState",r.DONE);h.dispatchEvent("readystatechange");N=!0;h.dispatchEvent(a);e()});c.exec.call(D,"XMLHttpRequest","send",{url:F,method:G,async:C,user:R,password:S,headers:H,mimeType:O,encoding:T,responseType:h.responseType,withCredentials:h.withCredentials,
options:E},b)}var h=this;(new Date).getTime();D=new s;"string"==typeof E.required_caps&&(E.required_caps=c.parseCaps(E.required_caps));E.required_caps=a.extend({},E.required_caps,{return_response_type:h.responseType});b instanceof p&&(E.required_caps.send_multipart=!0);P||(E.required_caps.do_cors=!0);E.ruid?d(D.connectRuntime(E)):(D.bind("RuntimeInit",function(a,b){d(b)}),D.bind("RuntimeError",function(a,b){h.dispatchEvent("RuntimeError",b)}),D.connectRuntime(E))}var w=this,B={timeout:0,readyState:r.UNSENT,
withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},C=!0,F,G,H={},R,S,T=null,O=null,Q=!1,L=!1,M=!1,N=!1,K=!1,P=!1,E={},D,J="",I;a.extend(this,B,{uid:a.guid("uid_"),upload:new v,open:function(c,m,l,p,n){var t;if(!c||!m)throw new b.DOMException(b.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(c)||e.utf8_encode(c)!==c)throw new b.DOMException(b.DOMException.SYNTAX_ERR);if(~a.inArray(c.toUpperCase(),"CONNECT DELETE GET HEAD OPTIONS POST PUT TRACE TRACK".split(" "))&&
(G=c.toUpperCase()),~a.inArray(G,["CONNECT","TRACE","TRACK"]))throw new b.DOMException(b.DOMException.SECURITY_ERR);if(m=e.utf8_encode(m),t=d.parseUrl(m),P=d.hasSameOrigin(t),F=d.resolveUrl(m),(p||n)&&!P)throw new b.DOMException(b.DOMException.INVALID_ACCESS_ERR);if(R=p||t.user,S=n||t.pass,C=l||!0,!1===C&&(f("timeout")||f("withCredentials")||""!==f("responseType")))throw new b.DOMException(b.DOMException.INVALID_ACCESS_ERR);Q=!C;L=!1;H={};f("responseText","");f("responseXML",null);f("response",null);
f("status",0);f("statusText","");f("readyState",r.OPENED);this.convertEventPropsToHandlers(["readystatechange"]);this.dispatchEvent("readystatechange")},setRequestHeader:function(c,d){if(f("readyState")!==r.OPENED||L)throw new b.DOMException(b.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(c)||e.utf8_encode(c)!==c)throw new b.DOMException(b.DOMException.SYNTAX_ERR);return c=a.trim(c).toLowerCase(),~a.inArray(c,"accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 content-transfer-encoding date expect host keep-alive origin referer te trailer transfer-encoding upgrade user-agent via".split(" "))||
/^(proxy\-|sec\-)/.test(c)?!1:(H[c]?H[c]+=", "+d:H[c]=d,!0)},getAllResponseHeaders:function(){return J||""},getResponseHeader:function(b){return b=b.toLowerCase(),K||~a.inArray(b,["set-cookie","set-cookie2"])?null:J&&""!==J&&(I||(I={},a.each(J.split(/\r\n/),function(b){b=b.split(/:\s+/);2===b.length&&(b[0]=a.trim(b[0]),I[b[0].toLowerCase()]={header:b[0],value:a.trim(b[1])})})),I.hasOwnProperty(b))?I[b].header+": "+I[b].value:null},overrideMimeType:function(e){var c;if(~a.inArray(f("readyState"),[r.LOADING,
r.DONE]))throw new b.DOMException(b.DOMException.INVALID_STATE_ERR);if(e=a.trim(e.toLowerCase()),/;/.test(e)&&(c=e.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(e=c[1]),!y.mimes[e])throw new b.DOMException(b.DOMException.SYNTAX_ERR);},send:function(f,c){if(E="string"===a.typeOf(c)?{ruid:c}:c?c:{},this.convertEventPropsToHandlers(z),this.upload.convertEventPropsToHandlers(z),this.readyState!==r.OPENED||L)throw new b.DOMException(b.DOMException.INVALID_STATE_ERR);if(f instanceof n)E.ruid=f.ruid,O=f.type||
"application/octet-stream";else if(f instanceof p){if(f.hasBlob()){var d=f.getBlob();E.ruid=d.ruid;O=d.type||"application/octet-stream"}}else"string"==typeof f&&(T="UTF-8",O="text/plain;charset=UTF-8",f=e.utf8_encode(f));this.withCredentials||(this.withCredentials=E.required_caps&&E.required_caps.send_browser_cookies&&!P);M=!Q&&this.upload.hasEventListener();K=!1;N=!f;Q||(L=!0);m.call(this,f)},abort:function(){if(K=!0,Q=!1,~a.inArray(f("readyState"),[r.UNSENT,r.OPENED,r.DONE]))f("readyState",r.UNSENT);
else{if(f("readyState",r.DONE),L=!1,!D)throw new b.DOMException(b.DOMException.INVALID_STATE_ERR);D.getRuntime().exec.call(D,"XMLHttpRequest","abort",N);N=!0}},destroy:function(){D&&("function"===a.typeOf(D.destroy)&&D.destroy(),D=null);this.unbindAll();this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var g={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",
207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",
415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};v.prototype=f.instance;var z="loadstart progress abort error load timeout loadend".split(" ");return r.UNSENT=
0,r.OPENED=1,r.HEADERS_RECEIVED=2,r.LOADING=3,r.DONE=4,r.prototype=f.instance,r});d("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(a,b,f,e){function c(){function e(b,f){var h=this;m=f;h.bind("TransportingProgress",function(b){y=b.loaded;t>y&&-1===a.inArray(h.state,[c.IDLE,c.DONE])&&d.call(h)},999);h.bind("TransportingComplete",function(){y=t;h.state=c.DONE;p=null;h.result=m.exec.call(h,"Transporter",
"getAsBlob",b||"")},999);h.state=c.BUSY;h.trigger("TransportingStarted");d.call(h)}function d(){var a;a=t-y;v>a&&(v=a);a=b.btoa(p.substr(y,v));m.exec.call(this,"Transporter","receive",a,t)}var n,m,p,t,y,v;f.call(this);a.extend(this,{uid:a.guid("uid_"),state:c.IDLE,result:null,transport:function(b,f,c){var d=this;c=a.extend({chunk_size:204798},c);(n=c.chunk_size%3)&&(c.chunk_size+=3-n);v=c.chunk_size;t=y=0;p=this.result=null;if(p=b,t=b.length,"string"===a.typeOf(c)||c.ruid)e.call(d,f,this.connectRuntime(c));
else{var h=function(a,b){d.unbind("RuntimeInit",h);e.call(d,f,b)};this.bind("RuntimeInit",h);this.connectRuntime(c)}},abort:function(){this.state=c.IDLE;m&&(m.exec.call(this,"Transporter","clear"),this.trigger("TransportingAborted"));t=y=0;p=this.result=null},destroy:function(){this.unbindAll();m=null;this.disconnectRuntime();t=y=0;p=this.result=null}})}return c.IDLE=0,c.BUSY=1,c.DONE=2,c.prototype=e.instance,c});d("moxie/core/JSON",[],function(){return!!window.JSON&&JSON.parse||function(){var b,
c,f={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},e,d=function(a){throw{name:"SyntaxError",message:a,at:b,text:e};},l=function(a){return a&&a!==c&&d("Expected '"+a+"' instead of '"+c+"'"),c=e.charAt(b),b+=1,c},s=function(){var a,b="";for("-"===c&&(b="-",l("-"));"0"<=c&&"9">=c;)b+=c,l();if("."===c)for(b+=".";l()&&"0"<=c&&"9">=c;)b+=c;if("e"===c||"E"===c)for(b+=c,l(),"-"!==c&&"+"!==c||(b+=c,l());"0"<=c&&"9">=c;)b+=c,l();return a=+b,isFinite(a)?a:(d("Bad number"),void 0)},n=function(){var a,
b,e="",m;if('"'===c)for(;l();){if('"'===c)return l(),e;if("\\"===c)if(l(),"u"===c){for(b=m=0;4>b&&(a=parseInt(l(),16),isFinite(a));b+=1)m=16*m+a;e+=String.fromCharCode(m)}else{if("string"!=typeof f[c])break;e+=f[c]}else e+=c}d("Bad string")},m=function(){for(;c&&" ">=c;)l()},p=function(){switch(c){case "t":return l("t"),l("r"),l("u"),l("e"),!0;case "f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case "n":return l("n"),l("u"),l("l"),l("l"),null}d("Unexpected '"+c+"'")},t;return t=function(){switch(m(),
c){case "{":var a;a:{var b={};if("{"===c){if(l("{"),m(),"}"===c){a=(l("}"),b);break a}for(;c;){if(a=n(),m(),l(":"),Object.hasOwnProperty.call(b,a)&&d('Duplicate key "'+a+'"'),b[a]=t(),m(),"}"===c){a=(l("}"),b);break a}l(",");m()}}d("Bad object");a=void 0}return a;case "[":a:{a=[];if("["===c){if(l("["),m(),"]"===c){a=(l("]"),a);break a}for(;c;){if(a.push(t()),m(),"]"===c){a=(l("]"),a);break a}l(",");m()}}d("Bad array");a=void 0}return a;case '"':return n();case "-":return s();default:return"0"<=c&&
"9">=c?s():p()}},function(f,l){var p;return e=f,b=0,c=" ",p=t(),m(),c&&d("Syntax error"),"function"==typeof l?function z(b,c){var e,f,d=b[c];if(d&&"object"==typeof d)for(e in d)Object.prototype.hasOwnProperty.call(d,e)&&(f=z(d,e),f!==a?d[e]=f:delete d[e]);return l.call(b,c,d)}({"":p},""):p}}()});d("moxie/image/Image","moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/Exceptions moxie/file/FileReaderSync moxie/xhr/XMLHttpRequest moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/runtime/Transporter moxie/core/utils/Env moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/core/utils/Encode moxie/core/JSON".split(" "),
function(a,b,c,e,d,l,s,n,m,p,t,g,v,r){function A(){function e(b){var d=a.typeOf(b);try{if(b instanceof A){if(!b.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);p.apply(this,arguments)}else if(b instanceof t){if(!~a.inArray(b.type,["image/jpeg","image/png"]))throw new c.ImageError(c.ImageError.WRONG_FORMAT);w.apply(this,arguments)}else if(-1!==a.inArray(d,["blob","file"]))e.call(this,new g(null,b),arguments[1]);else if("string"===d)/^data:[^;]*;base64,/.test(b)?e.call(this,new t(null,
{data:b}),arguments[1]):B.apply(this,arguments);else{if("node"!==d||"img"!==b.nodeName.toLowerCase())throw new c.DOMException(c.DOMException.TYPE_MISMATCH_ERR);e.call(this,b.src,arguments[1])}}catch(h){this.trigger("error",h)}}function p(b,c){var e=this.connectRuntime(b.ruid);this.ruid=e.uid;e.exec.call(this,"Image","loadFromImage",b,"undefined"===a.typeOf(c)?!0:c)}function w(b,c){function e(a){d.ruid=a.uid;a.exec.call(d,"Image","loadFromBlob",b)}var d=this;d.name=b.name||"";b.isDetached()?(this.bind("RuntimeInit",
function(a,b){e(b)}),c&&"string"==typeof c.required_caps&&(c.required_caps=l.parseCaps(c.required_caps)),this.connectRuntime(a.extend({required_caps:{access_image_binary:!0,resize_image:!0}},c))):e(this.connectRuntime(b.ruid))}function B(a,b){var c=this,e;e=new d;e.open("get",a);e.responseType="blob";e.onprogress=function(a){c.trigger(a)};e.onload=function(){w.call(c,e.response,!0)};e.onerror=function(a){c.trigger(a)};e.onloadend=function(){e.destroy()};e.bind("RuntimeError",function(a,b){c.trigger("RuntimeError",
b)});e.send(null,b)}s.call(this);a.extend(this,{uid:a.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){var b=void 0;if(b||(b=this.getRuntime().exec.call(this,"Image","getInfo")),b)if("string"===a.typeOf(b.meta))try{this.meta=r(b.meta)}catch(c){}else this.meta=b.meta;a.extend(this,{size:parseInt(b.size,10),width:parseInt(b.width,10),height:parseInt(b.height,10),type:b.type});""===
this.name&&(this.name=b.name)},999);this.convertEventPropsToHandlers(z);e.apply(this,arguments)},downsize:function(b,e,d,h){try{if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);if(this.width>A.MAX_RESIZE_WIDTH||this.height>A.MAX_RESIZE_HEIGHT)throw new c.ImageError(c.ImageError.MAX_RESOLUTION_ERR);(b||e)&&"undefined"!==a.typeOf(d)||(d=!1);b=b||this.width;e=e||this.height;h="undefined"===a.typeOf(h)?!0:!!h;this.getRuntime().exec.call(this,"Image","downsize",b,e,d,h)}catch(m){this.trigger("error",
m)}},crop:function(a,b,c){this.downsize(a,b,!0,c)},getAsCanvas:function(){if(!m.can("create_canvas"))throw new c.RuntimeError(c.RuntimeError.NOT_SUPPORTED_ERR);return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(a,b){if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);return a||(a="image/jpeg"),"image/jpeg"!==a||b||(b=90),this.getRuntime().exec.call(this,"Image","getAsBlob",a,b)},getAsDataURL:function(a,b){if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);
return this.getRuntime().exec.call(this,"Image","getAsDataURL",a,b)},getAsBinaryString:function(a,b){var c=this.getAsDataURL(a,b);return v.atob(c.substring(c.indexOf("base64,")+7))},embed:function(e,d){function q(){if(m.can("create_canvas")){var b=l.getAsCanvas();if(b)return e.appendChild(b),b=null,l.destroy(),p.trigger("embedded"),void 0}b=l.getAsDataURL(t,s);if(!b)throw new c.ImageError(c.ImageError.WRONG_FORMAT);if(m.can("use_data_uri_of",b.length))e.innerHTML='<img src="'+b+'" width="'+l.width+
'" height="'+l.height+'" />',l.destroy(),p.trigger("embedded");else{var d=new n;d.bind("TransportingComplete",function(){B=p.connectRuntime(this.result.ruid);p.bind("Embedded",function(){a.extend(B.getShimContainer().style,{top:"0px",left:"0px",width:l.width+"px",height:l.height+"px"});B=null},999);B.exec.call(p,"ImageView","display",this.result.uid,r,w);l.destroy()});d.transport(v.atob(b.substring(b.indexOf("base64,")+7)),t,a.extend({},y,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",
container:e}))}}var p=this,l,t,s,g,y=d||{},r=this.width,w=this.height,B;try{if(!(e=b.get(e)))throw new c.DOMException(c.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);if(this.width>A.MAX_RESIZE_WIDTH||this.height>A.MAX_RESIZE_HEIGHT)throw new c.ImageError(c.ImageError.MAX_RESOLUTION_ERR);if(t=y.type||this.type||"image/jpeg",s=y.quality||90,g="undefined"!==a.typeOf(y.crop)?y.crop:!1,y.width)r=y.width,w=y.height||r;else{var z=b.getSize(e);
z.w&&z.h&&(r=z.w,w=z.h)}return l=new A,l.bind("Resize",function(){q.call(p)}),l.bind("Load",function(){l.downsize(r,w,g,!1)}),l.clone(this,!1),l}catch(u){this.trigger("error",u)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime());this.unbindAll()}})}var z=["progress","load","error","resize","embedded"];return A.MAX_RESIZE_WIDTH=6500,A.MAX_RESIZE_HEIGHT=6500,A.prototype=p.instance,A});d("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic",
"moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(a,b,c,e){var d={};return c.addConstructor("html5",function(b,h,n){var m=this,p=c.capTest,t=c.capTrue;n=a.extend({access_binary:p(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return m.can("access_binary")&&!!d.Image},display_media:p(e.can("create_canvas")||e.can("use_data_uri_over32kb")),do_cors:p(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:p(function(){var a=
document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&("IE"!==e.browser||9<e.version)}()),filter_by_extension:p("Chrome"===e.browser&&28<=e.version||"IE"===e.browser&&10<=e.version),return_response_headers:t,return_response_type:function(a){return"json"===a?!0:e.can("return_response_type",a)},report_upload_progress:p(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return m.can("access_binary")&&e.can("create_canvas")},select_file:function(){return e.can("use_fileinput")&&
window.File},select_folder:function(){return m.can("select_file")&&"Chrome"===e.browser&&21<=e.version},select_multiple:function(){return m.can("select_file")&&!("Safari"===e.browser&&"Windows"===e.OS)},send_binary_string:p(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:p(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||m.can("send_binary_string")},
slice_blob:p(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return m.can("slice_blob")&&m.can("send_multipart")},summon_file_dialog:p("Firefox"===e.browser&&4<=e.version||"Opera"===e.browser&&12<=e.version||"IE"===e.browser&&10<=e.version||!!~a.inArray(e.browser,["Chrome","Safari"])),upload_filesize:t},n);c.call(this,b,h||"html5",n);a.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(m);
a=m=null}}(this.destroy)});a.extend(this.getShim(),d)}),d});d("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(a,b){return a.Blob=function(){function a(b,c,d){var f;if(!window.File.prototype.slice)return(f=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?f.call(b,c,d):null;try{return b.slice(),b.slice(c,d)}catch(h){return b.slice(c,d-c)}}this.slice=function(){return new b(this.getRuntime().uid,a.apply(this,arguments))}}});d("moxie/core/utils/Events",
["moxie/core/utils/Basic"],function(a){function b(){this.returnValue=!1}function c(){this.cancelBubble=!0}var e={},d="moxie_"+a.guid(),l=function(b,c,f){var h;if(c=c.toLowerCase(),b[d]&&e[b[d]]&&e[b[d]][c]){h=e[b[d]][c];for(var l=h.length-1;0<=l&&(h[l].orig!==f&&h[l].key!==f||(b.removeEventListener?b.removeEventListener(c,h[l].func,!1):b.detachEvent&&b.detachEvent("on"+c,h[l].func),h[l].orig=null,h[l].func=null,h.splice(l,1),void 0===f));l--);if(h.length||delete e[b[d]][c],a.isEmptyObj(e[b[d]])){delete e[b[d]];
try{delete b[d]}catch(g){b[d]=void 0}}}};return{addEvent:function(l,n,m,p){var t;n=n.toLowerCase();l.addEventListener?(t=m,l.addEventListener(n,t,!1)):l.attachEvent&&(t=function(){var a=window.event;a.target||(a.target=a.srcElement);a.preventDefault=b;a.stopPropagation=c;m(a)},l.attachEvent("on"+n,t));l[d]||(l[d]=a.guid());e.hasOwnProperty(l[d])||(e[l[d]]={});l=e[l[d]];l.hasOwnProperty(n)||(l[n]=[]);l[n].push({func:t,orig:m,key:p})},removeEvent:l,removeAllEvents:function(b,c){b&&b[d]&&a.each(e[b[d]],
function(a,e){l(b,e,c)})}}});d("moxie/runtime/html5/file/FileInput","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(a,b,c,e,d,l){return a.FileInput=function(){var a=[],k;b.extend(this,{init:function(m){var p=this,t=p.getRuntime(),g,v,r;k=m;a=[];m=k.accept.mimes||d.extList2mimes(k.accept,t.can("filter_by_extension"));g=t.getShimContainer();g.innerHTML='<input id="'+t.uid+'" type="file" style="font-size:999px;opacity:0;"'+
(k.multiple&&t.can("select_multiple")?"multiple":"")+(k.directory&&t.can("select_folder")?"webkitdirectory directory":"")+(m?' accept="'+m.join(",")+'"':"")+" />";m=c.get(t.uid);b.extend(m.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});v=c.get(k.browse_button);t.can("summon_file_dialog")&&("static"===c.getStyle(v,"position")&&(v.style.position="relative"),r=parseInt(c.getStyle(v,"z-index"),10)||1,v.style.zIndex=r,g.style.zIndex=r-1,e.addEvent(v,"click",function(a){var b=c.get(t.uid);
b&&!b.disabled&&b.click();a.preventDefault()},p.uid));r=t.can("summon_file_dialog")?v:g;e.addEvent(r,"mouseover",function(){p.trigger("mouseenter")},p.uid);e.addEvent(r,"mouseout",function(){p.trigger("mouseleave")},p.uid);e.addEvent(r,"mousedown",function(){p.trigger("mousedown")},p.uid);e.addEvent(c.get(k.container),"mouseup",function(){p.trigger("mouseup")},p.uid);m.onchange=function z(){if(a=[],k.directory?b.each(this.files,function(b){"."!==b.name&&a.push(b)}):a=[].slice.call(this.files),"IE"!==
l.browser)this.value="";else{var c=this.cloneNode(!0);this.parentNode.replaceChild(c,this);c.onchange=z}p.trigger("change")};p.trigger({type:"ready",async:!0});g=null},getFiles:function(){return a},disable:function(a){var b=this.getRuntime(),e;(e=c.get(b.uid))&&(e.disabled=!!a)},destroy:function(){var b=this.getRuntime().getShimContainer();e.removeAllEvents(b,this.uid);e.removeAllEvents(k&&c.get(k.container),this.uid);e.removeAllEvents(k&&c.get(k.browse_button),this.uid);b&&(b.innerHTML="");a=k=null}})}});
d("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(a,b,c,e,d){return a.FileDrop=function(){function a(c){var e=t.accept.mimes||d.extList2mimes(t.accept);c=c.type||d.getFileMime(c.name)||"";return e.length&&-1===b.inArray(c,e)?!1:!0}function k(a,c){var e=[];b.each(a,function(a){e.push(function(b){n(a,b)})});b.inSeries(e,function(){c()})}function n(b,c){b.isFile?b.file(function(b){a(b)&&
p.push(b);c()},function(){c()}):b.isDirectory?m(b,c):c()}function m(a,b){function c(a){d.readEntries(function(b){b.length?([].push.apply(e,b),c(a)):a()},a)}var e=[],d=a.createReader();c(function(){k(e,b)})}var p=[],t;b.extend(this,{init:function(c){var d=this;t=c;c=t.container;e.addEvent(c,"dragover",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect="copy"},d.uid);e.addEvent(c,"drop",function(c){if(c.preventDefault(),c.stopPropagation(),p=[],c.dataTransfer.items&&c.dataTransfer.items[0].webkitGetAsEntry){var e=
[];b.each(c.dataTransfer.items,function(a){e.push(a.webkitGetAsEntry())});k(e,function(){d.trigger("drop")})}else b.each(c.dataTransfer.files,function(b){a(b)&&p.push(b)}),d.trigger("drop")},d.uid);e.addEvent(c,"dragenter",function(a){a.preventDefault();a.stopPropagation();d.trigger("dragenter")},d.uid);e.addEvent(c,"dragleave",function(a){a.preventDefault();a.stopPropagation();d.trigger("dragleave")},d.uid)},getFiles:function(){return p},destroy:function(){e.removeAllEvents(t&&c.get(t.container),
this.uid);p=t=null}})}});d("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(a,b,c){return a.FileReader=function(){var a,d=!1;c.extend(this,{read:function(b,h){var k=this;a=new window.FileReader;a.addEventListener("progress",function(a){k.trigger(a)});a.addEventListener("load",function(a){k.trigger(a)});a.addEventListener("error",function(b){k.trigger(b,a.error)});a.addEventListener("loadend",function(){a=null});"function"===
c.typeOf(a[b])?(d=!1,a[b](h.getSource())):"readAsBinaryString"===b&&(d=!0,a.readAsDataURL(h.getSource()))},getResult:function(){return a&&a.result?d?b.atob(a.result.substring(a.result.indexOf("base64,")+7)):a.result:null},abort:function(){a&&a.abort()},destroy:function(){a=null}})}});d("moxie/runtime/html5/xhr/XMLHttpRequest","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Url moxie/file/File moxie/file/Blob moxie/xhr/FormData moxie/core/Exceptions moxie/core/utils/Env moxie/core/JSON".split(" "),
function(a,b,c,e,d,l,g,n,m){return a.XMLHttpRequest=function(){function a(b,c){var e=this,f,h;f=c.getBlob().getSource();h=new window.FileReader;h.onload=function(){c.append(c.getBlobName(),new d(null,{type:f.type,data:h.result}));v.send.call(e,b,c)};h.readAsBinaryString(f)}function k(){var a;if(!window.XMLHttpRequest||"IE"===n.browser&&8>n.version)a:{for(var b=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],c=0;c<b.length;c++)try{a=new ActiveXObject(b[c]);break a}catch(e){}a=void 0}else a=new window.XMLHttpRequest;
return a}function y(a){var b="----moxieboundary"+(new Date).getTime(),c="";if(!this.getRuntime().can("send_binary_string"))throw new g.RuntimeError(g.RuntimeError.NOT_SUPPORTED_ERR);return r.setRequestHeader("Content-Type","multipart/form-data; boundary="+b),a.each(function(a,e){c+=a instanceof d?"--"+b+'\r\nContent-Disposition: form-data; name="'+e+'"; filename="'+unescape(encodeURIComponent(a.name||"blob"))+'"\r\nContent-Type: '+a.type+"\r\n\r\n"+a.getSource()+"\r\n":"--"+b+'\r\nContent-Disposition: form-data; name="'+
e+'"\r\n\r\n'+unescape(encodeURIComponent(a))+"\r\n"}),c+="--"+b+"--\r\n"}var v=this,r,A;b.extend(this,{send:function(e,m){var g=this,s="Mozilla"===n.browser&&4<=n.version&&7>n.version,v="Android Browser"===n.browser,C=!1;if(A=e.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),r=k(),r.open(e.method,e.url,e.async,e.user,e.password),m instanceof d)m.isDetached()&&(C=!0),m=m.getSource();else if(m instanceof l){if(m.hasBlob())if(m.getBlob().isDetached())m=y.call(g,m),C=!0;else if((s||v)&&"blob"===
b.typeOf(m.getBlob().getSource())&&window.FileReader)return a.call(g,e,m),void 0;if(m instanceof l){var F=new window.FormData;m.each(function(a,b){a instanceof d?F.append(b,a.getSource()):F.append(b,a)});m=F}}r.upload?(e.withCredentials&&(r.withCredentials=!0),r.addEventListener("load",function(a){g.trigger(a)}),r.addEventListener("error",function(a){g.trigger(a)}),r.addEventListener("progress",function(a){g.trigger(a)}),r.upload.addEventListener("progress",function(a){g.trigger({type:"UploadProgress",
loaded:a.loaded,total:a.total})})):r.onreadystatechange=function(){switch(r.readyState){case 3:var a,b;try{c.hasSameOrigin(e.url)&&(a=r.getResponseHeader("Content-Length")||0),r.responseText&&(b=r.responseText.length)}catch(d){a=b=0}g.trigger({type:"progress",lengthComputable:!!a,total:parseInt(a,10),loaded:b});break;case 4:r.onreadystatechange=function(){},0===r.status?g.trigger("error"):g.trigger("load")}};b.isEmptyObj(e.headers)||b.each(e.headers,function(a,b){r.setRequestHeader(b,a)});""!==e.responseType&&
"responseType"in r&&(r.responseType="json"!==e.responseType||n.can("return_response_type","json")?e.responseType:"text");C?r.sendAsBinary?r.sendAsBinary(m):function(){for(var a=new Uint8Array(m.length),b=0;b<m.length;b++)a[b]=255&m.charCodeAt(b);r.send(a.buffer)}():r.send(m);g.trigger("loadstart")},getStatus:function(){try{if(r)return r.status}catch(a){}return 0},getResponse:function(a){var b=this.getRuntime();try{switch(a){case "blob":var c=new e(b.uid,r.response),d=r.getResponseHeader("Content-Disposition");
if(d){var f=d.match(/filename=([\'\"'])([^\1]+)\1/);f&&(A=f[2])}return c.name=A,c;case "json":return n.can("return_response_type","json")?r.response:200===r.status?m(r.responseText):null;case "document":var h=r.responseXML,l=r.responseText;return"IE"===n.browser&&l&&h&&!h.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(r.getResponseHeader("Content-Type"))&&(h=new window.ActiveXObject("Microsoft.XMLDOM"),h.async=!1,h.validateOnParse=!1,h.loadXML(l)),h&&("IE"===n.browser&&0!==h.parseError||!h.documentElement||
"parsererror"===h.documentElement.tagName)?null:h;default:return""!==r.responseText?r.responseText:null}}catch(k){return null}},getAllResponseHeaders:function(){try{return r.getAllResponseHeaders()}catch(a){}return""},abort:function(){r&&r.abort()},destroy:function(){v=A=null}})}});d("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){function b(a,c){var h=d?0:-8*(c-1),k=0,m;for(m=0;c>m;m++)k|=e.charCodeAt(a+m)<<Math.abs(h+8*m);return k}function c(a,b,d){d=3===arguments.length?
d:e.length-b-1;e=e.substr(0,b)+a+e.substr(d+b)}var d=!1,e;return{II:function(b){return b===a?d:(d=b,void 0)},init:function(a){d=!1;e=a},SEGMENT:function(a,b,d){switch(arguments.length){case 1:return e.substr(a,e.length-a-1);case 2:return e.substr(a,b);case 3:c(d,a,b);break;default:return e}},BYTE:function(a){return b(a,1)},SHORT:function(a){return b(a,2)},LONG:function(e,l){var g;if(l===a)g=b(e,4);else{g="";var n=d?0:-24,m;for(m=0;4>m;m++)g+=String.fromCharCode(255&l>>Math.abs(n+8*m));c(g,e,4);g=
void 0}return g},SLONG:function(a){a=b(a,4);return 2147483647<a?a-4294967296:a},STRING:function(a,c){var e="";for(c+=a;c>a;a++)e+=String.fromCharCode(b(a,1));return e}}}});d("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(a){return function f(b){var c=[],d,g,n,m=0;if(d=new a,d.init(b),65496===d.SHORT(0)){for(g=2;g<=b.length;)if(n=d.SHORT(g),65488<=n&&65495>=n)g+=2;else{if(65498===n||65497===n)break;m=d.SHORT(g+2)+2;65505<=n&&65519>=n&&c.push({hex:n,name:"APP"+
(15&n),start:g,length:m,segment:d.SEGMENT(g,m)});g+=m}return d.init(null),{headers:c,restore:function(a){var b,e;d.init(a);g=65504==d.SHORT(2)?4+d.SHORT(4):2;e=0;for(b=c.length;b>e;e++)d.SEGMENT(g,0,c[e].segment),g+=c[e].length;return a=d.SEGMENT(),d.init(null),a},strip:function(a){var b,c;c=new f(a);b=c.headers;c.purge();d.init(a);for(c=b.length;c--;)d.SEGMENT(b[c].start,b[c].length,"");return a=d.SEGMENT(),d.init(null),a},get:function(a){for(var b=[],e=0,d=c.length;d>e;e++)c[e].name===a.toUpperCase()&&
b.push(c[e].segment);return b},set:function(a,b){var e=[],d,f,m;"string"==typeof b?e.push(b):e=b;d=f=0;for(m=c.length;m>d&&(c[d].name===a.toUpperCase()&&(c[d].segment=e[f],c[d].length=e[f].length,f++),!(f>=e.length));d++);},purge:function(){c=[];d.init(null);d=null}}}}});d("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(b,c){return function(){function d(b,c){var f=e.SHORT(b),h,k,l,g,q,x,u=[],w={};for(h=0;f>h;h++)if(x=b+12*h+2,l=c[e.SHORT(x)],
l!==a){switch(g=e.SHORT(x+=2),q=e.LONG(x+=2),x+=4,u=[],g){case 1:case 7:4<q&&(x=e.LONG(x)+s.tiffHeader);for(k=0;q>k;k++)u[k]=e.BYTE(x+k);break;case 2:4<q&&(x=e.LONG(x)+s.tiffHeader);w[l]=e.STRING(x,q-1);continue;case 3:2<q&&(x=e.LONG(x)+s.tiffHeader);for(k=0;q>k;k++)u[k]=e.SHORT(x+2*k);break;case 4:1<q&&(x=e.LONG(x)+s.tiffHeader);for(k=0;q>k;k++)u[k]=e.LONG(x+4*k);break;case 5:x=e.LONG(x)+s.tiffHeader;for(k=0;q>k;k++)u[k]=e.LONG(x+4*k)/e.LONG(x+4*k+4);break;case 9:x=e.LONG(x)+s.tiffHeader;for(k=0;q>
k;k++)u[k]=e.SLONG(x+4*k);break;case 10:x=e.LONG(x)+s.tiffHeader;for(k=0;q>k;k++)u[k]=e.SLONG(x+4*k)/e.SLONG(x+4*k+4);break;default:continue}k=1==q?u[0]:u;w[l]=n.hasOwnProperty(l)&&"object"!=typeof k?n[l][k]:k}return w}var e,g,l,s={},n;return e=new c,g={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",
33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},n={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",
2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},
Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",
32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",
95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",
W:"West longitude"}},{init:function(b){s={tiffHeader:10};if(b!==a&&b.length)if(e.init(b),65505===e.SHORT(0)&&"EXIF\x00"===e.STRING(4,5).toUpperCase()){var c=s.tiffHeader;b=(e.II(18761==e.SHORT(c)),42!==e.SHORT(c+=2)?!1:(s.IFD0=s.tiffHeader+e.LONG(c+2),l=d(s.IFD0,g.tiff),"ExifIFDPointer"in l&&(s.exifIFD=s.tiffHeader+l.ExifIFDPointer,delete l.ExifIFDPointer),"GPSInfoIFDPointer"in l&&(s.gpsIFD=s.tiffHeader+l.GPSInfoIFDPointer,delete l.GPSInfoIFDPointer),!0))}else b=!1;else b=!1;return b},TIFF:function(){return l},
EXIF:function(){var a;if(a=d(s.exifIFD,g.exif),a.ExifVersion&&"array"===b.typeOf(a.ExifVersion)){for(var c=0,e="";c<a.ExifVersion.length;c++)e+=String.fromCharCode(a.ExifVersion[c]);a.ExifVersion=e}return a},GPS:function(){var a;return a=d(s.gpsIFD,g.gps),a.GPSVersionID&&"array"===b.typeOf(a.GPSVersionID)&&(a.GPSVersionID=a.GPSVersionID.join(".")),a},setExif:function(a,b){var c;if("PixelXDimension"!==a&&"PixelYDimension"!==a)c=!1;else{c=a;var d,f,h,k=0;if("string"==typeof c)for(f in d=g.exif,d)if(d[f]===
c){c=f;break}d=s.exifIFD;f=e.SHORT(d);for(var l=0;f>l;l++)if(h=d+12*l+2,e.SHORT(h)==c){k=h+8;break}c=k?(e.LONG(k,b),!0):!1}return c},getBinary:function(){return e.SEGMENT()},purge:function(){e.init(null);e=l=null;s={}}}}});d("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(a,b,c,e,d){return function(l){var g,n,m,p,t,y;if(g=l,n=new e,n.init(g),
65496!==n.SHORT(0))throw new b.ImageError(b.ImageError.WRONG_FORMAT);m=new c(l);p=new d;y=!!p.init(m.get("app1")[0]);t=function(){for(var a=0,b,c;a<=g.length;){if(b=n.SHORT(a+=2),65472<=b&&65475>=b)return a+=5,{height:n.SHORT(a),width:n.SHORT(a+2)};c=n.SHORT(a+=2);a+=c-2}return null}.call(this);a.extend(this,{type:"image/jpeg",size:g.length,width:t&&t.width||0,height:t&&t.height||0,setExif:function(b,c){return y?("object"===a.typeOf(b)?a.each(b,function(a,b){p.setExif(b,a)}):p.setExif(b,c),m.set("app1",
p.getBinary()),void 0):!1},writeHeaders:function(){return arguments.length?m.restore(arguments[0]):g=m.restore(g)},stripHeaders:function(a){return m.strip(a)},purge:function(){p&&m&&n&&(p.purge(),m.purge(),n.init(null),g=t=m=p=n=null)}});y&&(this.meta={tiff:p.TIFF(),exif:p.EXIF(),gps:p.GPS()})}});d("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(a,b,c){return function(d){function g(){s&&(s.init(null),l=n=s=null)}
var l,s,n;l=d;s=new c;s.init(l);(function(){for(var b=0,c=0,d=[35152,20039,3338,6666],c=0;c<d.length;c++,b+=2)if(d[c]!=s.SHORT(b))throw new a.ImageError(a.ImageError.WRONG_FORMAT);})();n=function(){var a,b,c=8,d,e,f,h;return a=(d=s.LONG(c),e=s.STRING(c+=4,4),f=c+=4,h=s.LONG(c+d),{length:d,type:e,start:f,CRC:h}),"IHDR"==a.type?(b=a.start,{width:s.LONG(b),height:s.LONG(b+4)}):null}.call(this);b.extend(this,{type:"image/png",size:l.length,width:n.width,height:n.height,purge:function(){g.call(this)}});
g.call(this)}});d("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(a,b,c,d){return function(g){var l=[c,d],s;s=function(){for(var a=0;a<l.length;a++)try{return new l[a](g)}catch(c){}throw new b.ImageError(b.ImageError.WRONG_FORMAT);}();a.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(a){return a},stripHeaders:function(a){return a},purge:function(){}});
a.extend(this,s);this.purge=function(){s.purge();s=null}}});d("moxie/runtime/html5/image/MegaPixel",[],function(){function a(b){var c=b.naturalWidth;if(1048576<c*b.naturalHeight){var d=document.createElement("canvas");d.width=d.height=1;d=d.getContext("2d");return d.drawImage(b,-c+1,0),0===d.getImageData(0,0,1,1).data[3]}return!1}return{isSubsampled:a,renderTo:function(b,c,d){var g=b.naturalWidth,l=b.naturalHeight,s=d.width,n=d.height,m=d.x||0;d=d.y||0;c=c.getContext("2d");a(b)&&(g/=2,l/=2);var p=
document.createElement("canvas");p.width=p.height=1024;var t=p.getContext("2d"),y;y=l;var v=document.createElement("canvas");v.width=1;v.height=y;v=v.getContext("2d");v.drawImage(b,0,0);for(var v=v.getImageData(0,0,1,y).data,r=0,A=y,z=y;z>r;)0===v[4*(z-1)+3]?A=z:r=z,z=A+r>>1;y=z/y;y=0===y?1:y;for(v=0;l>v;){r=v+1024>l?l-v:1024;for(A=0;g>A;){z=A+1024>g?g-A:1024;t.clearRect(0,0,1024,1024);t.drawImage(b,-A,-v);var x=A*s/g+m<<0,u=Math.ceil(z*s/g),w=v*n/l/y+d<<0,B=Math.ceil(r*n/l/y);c.drawImage(p,0,0,z,
r,x,w,u,B);A+=1024}v+=1024}}}});d("moxie/runtime/html5/image/Image","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/Exceptions moxie/core/utils/Encode moxie/file/Blob moxie/runtime/html5/image/ImageInfo moxie/runtime/html5/image/MegaPixel moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(a,b,c,d,g,l,s,n,m){return a.Image=function(){function a(){if(!w&&!x)throw new c.ImageError(c.DOMException.INVALID_STATE_ERR);return w||x}function k(a){return d.atob(a.substring(a.indexOf("base64,")+
7))}function y(a){var b=this;x=new Image;x.onerror=function(){A.call(this);b.trigger("error",new c.ImageError(c.ImageError.WRONG_FORMAT))};x.onload=function(){b.trigger("load")};x.src=/^data:[^;]*;base64,/.test(a)?a:"data:"+(C.type||"")+";base64,"+d.btoa(a)}function v(a,b){var d=this,e;return window.FileReader?(e=new FileReader,e.onload=function(){b(this.result)},e.onerror=function(){d.trigger("error",new c.FileException(c.FileException.NOT_READABLE_ERR))},e.readAsDataURL(a),void 0):b(a.getAsDataURL())}
function r(c,d,e,f){var k,g,l;if(G=f,l=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==b.inArray(l,[5,6,7,8]))g=c,c=d,d=g;g=a();k=(e?Math.max:Math.min)(c/g.width,d/g.height);if(1<k&&(!e||f))g=(this.trigger("Resize"),void 0);else{f=Math.round(g.width*k);k=Math.round(g.height*k);w||(w=document.createElement("canvas"));w.getContext("2d");e?(w.width=c,w.height=d):(w.width=f,w.height=k);d=f>w.width?Math.round((f-w.width)/2):0;c=k>w.height?Math.round((k-w.height)/2):0;if(!G){e=w.width;var n=
w.height;switch(l){case 5:case 6:case 7:case 8:w.width=n;w.height=e;break;default:w.width=e,w.height=n}var q=w.getContext("2d");switch(l){case 2:q.translate(e,0);q.scale(-1,1);break;case 3:q.translate(e,n);q.rotate(Math.PI);break;case 4:q.translate(0,n);q.scale(1,-1);break;case 5:q.rotate(0.5*Math.PI);q.scale(1,-1);break;case 6:q.rotate(0.5*Math.PI);q.translate(0,-n);break;case 7:q.rotate(0.5*Math.PI);q.translate(e,-n);q.scale(-1,1);break;case 8:q.rotate(-0.5*Math.PI),q.translate(-e,0)}}l=w;d=-d;
c=-c;"iOS"===m.OS?s.renderTo(g,l,{width:f,height:k,x:d,y:c}):l.getContext("2d").drawImage(g,d,c,f,k);g=(this.width=w.width,this.height=w.height,F=!0,this.trigger("Resize"),void 0)}return g}function A(){u&&(u.purge(),u=null);B=x=w=null;F=!1}var z=this,x,u,w,B,C,F=!1,G=!0;b.extend(this,{loadFromBlob:function(a){var b=this,d=b.getRuntime(),e=1<arguments.length?arguments[1]:!0;if(!d.can("access_binary"))throw new c.RuntimeError(c.RuntimeError.NOT_SUPPORTED_ERR);return a.isDetached()?(C={name:a.name,size:a.size,
type:a.type},B=a.getSource(),y.call(this,B),void 0):(C=a.getSource(),v.call(this,C,function(a){e&&(B=k(a));y.call(b,a)}),void 0)},loadFromImage:function(a,b){this.meta=a.meta;C={name:a.name,size:a.size,type:a.type};y.call(this,b?B=a.getAsBinaryString():a.getAsDataURL())},getInfo:function(){var b=this.getRuntime();return!u&&B&&b.can("access_image_binary")&&(u=new l(B)),{width:a().width||0,height:a().height||0,type:C.type||n.getFileMime(C.name),size:B&&B.length||C.size||0,name:C.name||"",meta:u&&u.meta||
this.meta||{}}},downsize:function(){r.apply(this,arguments)},getAsCanvas:function(){return w&&(w.id=this.uid+"_canvas"),w},getAsBlob:function(a,b){return a!==this.type&&r.call(this,this.width,this.height,!1),new g(null,{type:a,data:z.getAsBinaryString.call(this,a,b)})},getAsDataURL:function(a,b){var c=b||90;if(!F)return x.src;if("image/jpeg"!==a)return w.toDataURL("image/png");try{return w.toDataURL("image/jpeg",c/100)}catch(d){return w.toDataURL("image/jpeg")}},getAsBinaryString:function(a,b){if(!F)return B||
(B=k(z.getAsDataURL(a,b))),B;if("image/jpeg"!==a)B=k(z.getAsDataURL(a,b));else{var c;b||(b=90);try{c=w.toDataURL("image/jpeg",b/100)}catch(d){c=w.toDataURL("image/jpeg")}B=k(c);u&&(B=u.stripHeaders(B),G&&(u.meta&&u.meta.exif&&u.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),B=u.writeHeaders(B)),u.purge(),u=null)}return F=!1,B},destroy:function(){z=null;A.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}});d("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic",
"moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(a,b,c,d,g){function l(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(c){a="0.0"}}return a=a.match(/\d+/g),parseFloat(a[0]+"."+a[1])}var s={};return g.addConstructor("flash",function(n){var m=this,p;n=a.extend({swf_url:b.swf_url},n);g.call(this,n,"flash",{access_binary:function(a){return a&&
"browser"===m.mode},access_image_binary:function(a){return a&&"browser"===m.mode},display_media:g.capTrue,do_cors:g.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===m.mode},resize_image:g.capTrue,return_response_headers:!1,return_response_type:function(b){return!a.arrayDiff(b,["","text","json","document"])||"browser"===m.mode},return_status_code:function(b){return"browser"===m.mode||!a.arrayDiff(b,[200,404])},select_file:g.capTrue,select_multiple:g.capTrue,send_binary_string:function(a){return a&&
"browser"===m.mode},send_browser_cookies:function(a){return a&&"browser"===m.mode},send_custom_headers:function(a){return a&&"browser"===m.mode},send_multipart:g.capTrue,slice_blob:g.capTrue,stream_upload:function(a){return a&&"browser"===m.mode},summon_file_dialog:!1,upload_filesize:function(b){return 2097152>=a.parseSizeStr(b)||"client"===m.mode},use_http_method:function(b){return!a.arrayDiff(b,["GET","POST"])}},{access_binary:function(a){return a?"browser":"client"},access_image_binary:function(a){return a?
"browser":"client"},report_upload_progress:function(a){return a?"browser":"client"},return_response_type:function(b){return a.arrayDiff(b,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(b){return a.arrayDiff(b,[200,404])?"browser":["client","browser"]},send_binary_string:function(a){return a?"browser":"client"},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"browser":"client"},stream_upload:function(a){return a?
"client":"browser"},upload_filesize:function(b){return 2097152<=a.parseSizeStr(b)?"client":"browser"}},"client");10>l()&&(this.mode=!1);a.extend(this,{getShim:function(){return c.get(this.uid)},shimExec:function(a,b){var c=[].slice.call(arguments,2);return m.getShim().exec(this.uid,a,b,c)},init:function(){var c,f,g;g=this.getShimContainer();a.extend(g.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});c='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+
n.swf_url+'" ';"IE"===b.browser&&(c+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');c+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+n.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+b.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';"IE"===b.browser?(f=document.createElement("div"),g.appendChild(f),f.outerHTML=c,f=g=null):g.innerHTML=c;p=setTimeout(function(){m&&
!m.initialized&&m.trigger("Error",new d.RuntimeError(d.RuntimeError.NOT_INIT_ERR))},5E3)},destroy:function(a){return function(){a.call(m);clearTimeout(p);n=p=a=m=null}}(this.destroy)},s)}),s});d("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(a,b){return a.Blob={slice:function(a,c,d,g){var k=this.getRuntime();return 0>c?c=Math.max(a.size+c,0):0<c&&(c=Math.min(c,a.size)),0>d?d=Math.max(a.size+d,0):0<d&&(d=Math.min(d,a.size)),a=k.shimExec.call(this,"Blob",
"slice",c,d,g||""),a&&(a=new b(k.uid,a)),a}}});d("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(a){return a.FileInput={init:function(a){this.getRuntime().shimExec.call(this,"FileInput","init",{name:a.name,accept:a.accept,multiple:a.multiple});this.trigger("ready")}}});d("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(a,b){function c(a,d){switch(d){case "readAsText":return b.atob(a,"utf8");case "readAsBinaryString":return b.atob(a);
case "readAsDataURL":return a}return null}var d="";return a.FileReader={read:function(a,b){var h=this.getRuntime();return"readAsDataURL"===a&&(d="data:"+(b.type||"")+";base64,"),this.bind("Progress",function(b,h){h&&(d+=c(h,a))}),h.shimExec.call(this,"FileReader","readAsBase64",b.uid)},getResult:function(){return d},destroy:function(){d=null}}});d("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(a,b){function c(a,d){switch(d){case "readAsText":return b.atob(a,
"utf8");case "readAsBinaryString":return b.atob(a);case "readAsDataURL":return a}return null}return a.FileReaderSync={read:function(a,b){var d;return(d=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",b.uid))?("readAsDataURL"===a&&(d="data:"+(b.type||"")+";base64,"+d),c(d,a,b.type)):null}}});d("moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/flash/Runtime moxie/core/utils/Basic moxie/file/Blob moxie/file/File moxie/file/FileReaderSync moxie/xhr/FormData moxie/runtime/Transporter moxie/core/JSON".split(" "),
function(a,b,c,d,g,l,s,n){return a.XMLHttpRequest={send:function(a,d){function e(){a.transport=q.mode;q.shimExec.call(n,"XMLHttpRequest","send",a,d)}function g(a,b){q.shimExec.call(n,"XMLHttpRequest","appendBlob",a,b.uid);d=null;e()}function k(a,b){var c=new s;c.bind("TransportingComplete",function(){b(this.result)});c.transport(a.getSource(),a.type,{ruid:q.uid})}var n=this,q=n.getRuntime();if(b.isEmptyObj(a.headers)||b.each(a.headers,function(a,b){q.shimExec.call(n,"XMLHttpRequest","setRequestHeader",
b,a.toString())}),d instanceof l){var z;if(d.each(function(a,b){a instanceof c?z=b:q.shimExec.call(n,"XMLHttpRequest","append",b,a)}),d.hasBlob()){var x=d.getBlob();x.isDetached()?k(x,function(a){x.destroy();g(z,a)}):g(z,x)}else d=null,e()}else d instanceof c?d.isDetached()?k(d,function(a){d.destroy();d=a.uid;e()}):(d=d.uid,e()):e()},getResponse:function(a){var c,f,k=this.getRuntime();if(f=k.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(f=new d(k.uid,f),"blob"===a)return f;if(~b.inArray(a,
["","text"]))return c=new g,c.readAsText(f);if("arraybuffer"!==a&&"json"===a){c=new g;try{return n(c.readAsText(f))}catch(l){}}}return null},abort:function(a){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}}});d("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(a,b){return a.Transporter={getAsBlob:function(a){var c=this.getRuntime();return(a=c.shimExec.call(this,"Transporter",
"getAsBlob",a))?new b(c.uid,a):null}}});d("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(a,b,c,d,g){return a.Image={loadFromBlob:function(a){function b(a){e.shimExec.call(d,"Image","loadFromBlob",a.uid);d=e=null}var d=this,e=d.getRuntime();if(a.isDetached()){var h=new c;h.bind("TransportingComplete",function(){b(h.result.getSource())});h.transport(a.getSource(),a.type,{ruid:e.uid})}else b(a.getSource())},
loadFromImage:function(a){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",a.uid)},getAsBlob:function(a,b){var c=this.getRuntime(),f=c.shimExec.call(this,"Image","getAsBlob",a,b);return f?new d(c.uid,f):null},getAsDataURL:function(){var a=this.getRuntime().Image.getAsBlob.apply(this,arguments),b;return a?(b=new g,b.readAsDataURL(a)):null}}});d("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],
function(a,b,c,d,g){function l(a){var b=!1,c=null,d,e,f,h,g,k=0;try{try{c=new ActiveXObject("AgControl.AgControl"),c.IsVersionSupported(a)&&(b=!0)}catch(l){var q=navigator.plugins["Silverlight Plug-In"];if(q){d=q.description;"1.0.30226.2"===d&&(d="2.0.30226.2");for(e=d.split(".");3<e.length;)e.pop();for(;4>e.length;)e.push(0);for(f=a.split(".");4<f.length;)f.pop();do h=parseInt(f[k],10),g=parseInt(e[k],10),k++;while(k<f.length&&h===g);g>=h&&!isNaN(h)&&(b=!0)}}}catch(s){b=!1}return b}var s={};return g.addConstructor("silverlight",
function(n){var m=this,p;n=a.extend({xap_url:b.xap_url},n);g.call(this,n,"silverlight",{access_binary:g.capTrue,access_image_binary:g.capTrue,display_media:g.capTrue,do_cors:g.capTrue,drag_and_drop:!1,report_upload_progress:g.capTrue,resize_image:g.capTrue,return_response_headers:function(a){return a&&"client"===m.mode},return_response_type:g.capTrue,return_status_code:function(b){return"client"===m.mode||!a.arrayDiff(b,[200,404])},select_file:g.capTrue,select_multiple:g.capTrue,send_binary_string:g.capTrue,
send_browser_cookies:function(a){return a&&"browser"===m.mode},send_custom_headers:function(a){return a&&"client"===m.mode},send_multipart:g.capTrue,slice_blob:g.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:g.capTrue,use_http_method:function(b){return"client"===m.mode||!a.arrayDiff(b,["GET","POST"])}},{return_response_headers:function(a){return a?"client":"browser"},return_status_code:function(b){return a.arrayDiff(b,[200,404])?"client":["client","browser"]},send_browser_cookies:function(a){return a?
"browser":"client"},send_custom_headers:function(a){return a?"client":"browser"},use_http_method:function(b){return a.arrayDiff(b,["GET","POST"])?"client":["client","browser"]}});l("2.0.31005.0")&&"Opera"!==b.browser||(this.mode=!1);a.extend(this,{getShim:function(){return c.get(this.uid).content.Moxie},shimExec:function(a,b){var c=[].slice.call(arguments,2);return m.getShim().exec(this.uid,a,b,c)},init:function(){this.getShimContainer().innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+
n.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+b.global_event_dispatcher+'"/></object>';p=setTimeout(function(){m&&!m.initialized&&m.trigger("Error",new d.RuntimeError(d.RuntimeError.NOT_INIT_ERR))},"Windows"!==b.OS?1E4:5E3)},destroy:function(a){return function(){a.call(m);clearTimeout(p);n=p=a=m=null}}(this.destroy)},s)}),s});d("moxie/runtime/silverlight/file/Blob",
["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(a,b,c){return a.Blob=b.extend({},c)});d("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(a){return a.FileInput={init:function(a){this.getRuntime().shimExec.call(this,"FileInput","init",function(a){for(var b="",c=0;c<a.length;c++)b+=(""!==b?"|":"")+a[c].title+" | *."+a[c].extensions.replace(/,/g,";*.");return b}(a.accept),a.name,a.multiple);this.trigger("ready")}}});
d("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(a,b,c){return a.FileDrop={init:function(){var a=this.getRuntime(),d;return d=a.getShimContainer(),c.addEvent(d,"dragover",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect="copy"},this.uid),c.addEvent(d,"dragenter",function(c){c.preventDefault();b.get(a.uid).dragEnter(c)&&c.stopPropagation()},this.uid),c.addEvent(d,"drop",function(c){c.preventDefault();
b.get(a.uid).dragDrop(c)&&c.stopPropagation()},this.uid),a.shimExec.call(this,"FileDrop","init")}}});d("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(a,b,c){return a.FileReader=b.extend({},c)});d("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(a,b,c){return a.FileReaderSync=b.extend({},
c)});d("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(a,b,c){return a.XMLHttpRequest=b.extend({},c)});d("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(a,b,c){return a.Transporter=b.extend({},c)});d("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime",
"moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(a,b,c){return a.Image=b.extend({},c)});d("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(a,b,c,d){var g={};return c.addConstructor("html4",function(b){var h=this,n=c.capTest,m=c.capTrue;c.call(this,b,"html4",{access_binary:n(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:n(g.Image&&(d.can("create_canvas")||
d.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:n("Chrome"===d.browser&&28<=d.version||"IE"===d.browser&&10<=d.version),resize_image:function(){return g.Image&&h.can("access_binary")&&d.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(b){return!!~a.inArray(b,["json","text","document",""])},return_status_code:function(b){return!a.arrayDiff(b,[200,404])},select_file:function(){return d.can("use_fileinput")},select_multiple:!1,
send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return h.can("select_file")},summon_file_dialog:n("Firefox"===d.browser&&4<=d.version||"Opera"===d.browser&&12<=d.version||"IE"===d.browser&&10<=d.version||!!~a.inArray(d.browser,["Chrome","Safari"])),upload_filesize:m,use_http_method:function(b){return!a.arrayDiff(b,["GET","POST"])}});a.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(h);a=h=null}}(this.destroy)});
a.extend(this.getShim(),g)}),g});d("moxie/runtime/html4/file/FileInput","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(a,b,c,d,g,l){return a.FileInput=function(){function a(){var g=this,q=g.getRuntime(),r,A,z,x,u,w;w=b.guid("uid_");r=q.getShimContainer();k&&(z=c.get(k+"_form"),z&&b.extend(z.style,{top:"100%"}));x=document.createElement("form");x.setAttribute("id",w+"_form");x.setAttribute("method",
"post");x.setAttribute("enctype","multipart/form-data");x.setAttribute("encoding","multipart/form-data");b.extend(x.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});u=document.createElement("input");u.setAttribute("id",w);u.setAttribute("type","file");u.setAttribute("name","Filedata");u.setAttribute("accept",p.join(","));b.extend(u.style,{fontSize:"999px",opacity:0});x.appendChild(u);r.appendChild(x);b.extend(u.style,{position:"absolute",top:0,left:0,width:"100%",
height:"100%"});"IE"===l.browser&&10>l.version&&b.extend(u.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});u.onchange=function(){var b;this.value&&(b=this.files?this.files[0]:{name:this.value},m=[b],this.onchange=function(){},a.call(g),g.bind("change",function(){var a=c.get(w),b=c.get(w+"_form"),d;g.files.length&&a&&b&&(d=g.files[0],a.setAttribute("id",d.uid),b.setAttribute("id",d.uid+"_form"),b.setAttribute("target",d.uid+"_iframe"))},998),u=x=null,g.trigger("change"))};q.can("summon_file_dialog")&&
(A=c.get(t.browse_button),d.removeEvent(A,"click",g.uid),d.addEvent(A,"click",function(a){u&&!u.disabled&&u.click();a.preventDefault()},g.uid));k=w;r=z=A=null;g.trigger({type:"ready",async:!0})}var k,m=[],p=[],t;b.extend(this,{init:function(b){var h=this,k=h.getRuntime(),m;t=b;p=b.accept.mimes||g.extList2mimes(b.accept,k.can("filter_by_extension"));m=k.getShimContainer();(function(){var a,g;a=c.get(b.browse_button);k.can("summon_file_dialog")&&("static"===c.getStyle(a,"position")&&(a.style.position=
"relative"),g=parseInt(c.getStyle(a,"z-index"),10)||1,a.style.zIndex=g,m.style.zIndex=g-1);a=k.can("summon_file_dialog")?a:m;d.addEvent(a,"mouseover",function(){h.trigger("mouseenter")},h.uid);d.addEvent(a,"mouseout",function(){h.trigger("mouseleave")},h.uid);d.addEvent(a,"mousedown",function(){h.trigger("mousedown")},h.uid);d.addEvent(c.get(b.container),"mouseup",function(){h.trigger("mouseup")},h.uid);a=null})();a.call(this);m=null},getFiles:function(){return m},disable:function(a){var b;(b=c.get(k))&&
(b.disabled=!!a)},destroy:function(){var a=this.getRuntime().getShimContainer();d.removeAllEvents(a,this.uid);d.removeAllEvents(t&&c.get(t.container),this.uid);d.removeAllEvents(t&&c.get(t.browse_button),this.uid);a&&(a.innerHTML="");k=m=p=t=null}})}});d("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(a,b){return a.FileReader=b});d("moxie/runtime/html4/xhr/XMLHttpRequest","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Url moxie/core/Exceptions moxie/core/utils/Events moxie/file/Blob moxie/xhr/FormData moxie/core/JSON".split(" "),
function(a,b,c,d,g,l,s,n,m){return a.XMLHttpRequest=function(){function a(b){var d=this,e,g,h,k=!1;if(v){if(e=v.id.replace(/_iframe$/,""),g=c.get(e+"_form")){e=g.getElementsByTagName("input");for(h=e.length;h--;)switch(e[h].getAttribute("type")){case "hidden":e[h].parentNode.removeChild(e[h]);break;case "file":k=!0}e=[];k||g.parentNode.removeChild(g);g=null}setTimeout(function(){l.removeEvent(v,"load",d.uid);v.parentNode&&v.parentNode.removeChild(v);var a=d.getRuntime().getShimContainer();a.children.length||
a.parentNode.removeChild(a);v=null;b()},1)}}var k,y,v;b.extend(this,{send:function(m,A){var z=this,x=z.getRuntime(),u,w,B,C;if(k=y=null,A instanceof n&&A.hasBlob()){if(C=A.getBlob(),u=C.uid,B=c.get(u),w=c.get(u+"_form"),!w)throw new g.DOMException(g.DOMException.NOT_FOUND_ERR);}else u=b.guid("uid_"),w=document.createElement("form"),w.setAttribute("id",u+"_form"),w.setAttribute("method",m.method),w.setAttribute("enctype","multipart/form-data"),w.setAttribute("encoding","multipart/form-data"),w.setAttribute("target",
u+"_iframe"),x.getShimContainer().appendChild(w);A instanceof n&&A.each(function(a,c){if(a instanceof s)B&&B.setAttribute("name",c);else{var d=document.createElement("input");b.extend(d,{type:"hidden",name:c,value:a});w.appendChild(d)}});w.setAttribute("action",m.url);(function(){var c=x.getShimContainer()||document.body,f=document.createElement("div");f.innerHTML='<iframe id="'+u+'_iframe" name="'+u+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';v=f.firstChild;c.appendChild(v);
l.addEvent(v,"load",function(){var c;try{c=v.contentWindow.document||v.contentDocument||window.frames[v.id].document,/^4\d{2}\s/.test(c.title)&&c.getElementsByTagName("address").length?k=c.title.replace(/^(\d+).*$/,"$1"):(k=200,y=b.trim(c.body.innerHTML),z.trigger({type:"progress",loaded:y.length,total:y.length}),C&&z.trigger({type:"uploadprogress",loaded:C.size||1025,total:C.size||1025}))}catch(f){if(!d.hasSameOrigin(m.url))return a.call(z,function(){z.trigger("error")}),void 0;k=404}a.call(z,function(){z.trigger("load")})},
z.uid)})();w.submit();z.trigger("loadstart")},getStatus:function(){return k},getResponse:function(a){if("json"===a&&"string"===b.typeOf(y))try{return m(y.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(c){return null}return y},abort:function(){var b=this;v&&v.contentWindow&&(v.contentWindow.stop?v.contentWindow.stop():v.contentWindow.document.execCommand?v.contentWindow.document.execCommand("Stop"):v.src="about:blank");a.call(this,function(){b.dispatchEvent("abort")})}})}});d("moxie/runtime/html4/image/Image",
["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(a,b){return a.Image=b});(function(c){for(var d=0;d<c.length;d++){for(var f=b,e=c[d],q=e.split(/[.\/]/),l=0;l<q.length-1;++l)f[q[l]]===a&&(f[q[l]]={}),f=f[q[l]];f[q[q.length-1]]=g[e]}})("moxie/core/utils/Basic moxie/core/I18n moxie/core/utils/Mime moxie/core/utils/Env moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/file/Blob moxie/file/File moxie/file/FileInput moxie/file/FileDrop moxie/runtime/RuntimeTarget moxie/file/FileReader moxie/core/utils/Url moxie/file/FileReaderSync moxie/xhr/FormData moxie/xhr/XMLHttpRequest moxie/runtime/Transporter moxie/core/JSON moxie/image/Image moxie/core/utils/Events".split(" "))}(this);
(function(){var b={},a=moxie.core.utils.Basic.inArray;return function d(g){var k,h;for(k in g)h=typeof g[k],"object"!==h||~a(k,["Exceptions","Env","Mime"])?"function"===h&&(b[k]=g[k]):d(g[k])}(window.moxie),b.Env=window.moxie.core.utils.Env,b.Mime=window.moxie.core.utils.Mime,b.Exceptions=window.moxie.core.Exceptions,window.mOxie=b,window.o||(window.o=b),b})();
(function(b,a,c){function d(a){function b(a,c,e){var f={chunks:"slice_blob",resize:"send_binary_string",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",max_file_size:"access_binary",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};f[a]?d[f[a]]=c:e||(d[a]=c)}var c=a.required_features,d={};return"string"==typeof c?h.each(c.split(/\s*,\s*/),
function(a){b(a,!0)}):"object"==typeof c?h.each(c,function(a,c){b(c,a)}):!0===c&&(a.multipart||(d.send_binary_string=!0),0<a.chunk_size&&(d.slice_blob=!0),h.each(a,function(a,c){b(c,!!a,!0)})),d}var g=b.setTimeout,k={},h={VERSION:"2.0.0beta",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,
IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:a.mimes,ua:a.ua,typeOf:a.typeOf,extend:a.extend,guid:a.guid,each:a.each,getPos:a.getPos,getSize:a.getSize,xmlEncode:function(a){var b={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},c=/[<>&\"\']/g;return a?(""+a).replace(c,function(a){return b[a]?"&"+b[a]+";":a}):a},toArray:a.toArray,inArray:a.inArray,addI18n:a.addI18n,translate:a.translate,isEmptyObj:a.isEmptyObj,hasClass:a.hasClass,addClass:a.addClass,removeClass:a.removeClass,getStyle:a.getStyle,addEvent:a.addEvent,
removeEvent:a.removeEvent,removeAllEvents:a.removeAllEvents,cleanName:function(a){var b,c;c=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(b=0;b<c.length;b+=2)a=a.replace(c[b],c[b+1]);return a=a.replace(/\s+/g,"_"),a=a.replace(/[^a-z0-9_\-\.]+/gi,""),a},buildUrl:function(a,b){var c="";return h.each(b,function(a,
b){c+=(c?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)}),c&&(a+=(0<a.indexOf("?")?"&":"?")+c),a},formatSize:function(a){return a===c||/\D/.test(a)?h.translate("N/A"):1099511627776<a?Math.round(a/1099511627776,1)+" "+h.translate("tb"):1073741824<a?Math.round(a/1073741824,1)+" "+h.translate("gb"):1048576<a?Math.round(a/1048576,1)+" "+h.translate("mb"):1024<a?Math.round(a/1024,1)+" "+h.translate("kb"):a+" "+h.translate("b")},parseSize:a.parseSizeStr,predictRuntime:function(a,b){var c,d;return b&&
(a.runtimes=b),c=new h.Uploader(a),d=c.runtime,c.destroy(),d},addFileFilter:function(a,b){k[a]=b}};h.addFileFilter("mime_types",function(){function a(b){var c=[];return h.each(b,function(a){h.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?c.push("\\.*"):c.push("\\."+a.replace(RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),RegExp("("+c.join("|")+")$","i")}var b,c;return function(d,g){c&&d==b||(c=a(d),b=[].slice.call(d));return c.test(g.name)?!0:(this.trigger("Error",
{code:h.FILE_EXTENSION_ERROR,message:h.translate("File extension error."),file:g}),!1)}}());h.addFileFilter("max_file_size",function(a,b){return void 0!==b.size&&a&&b.size>a?(this.trigger("Error",{code:h.FILE_SIZE_ERROR,message:h.translate("File size error."),file:b}),!1):!0});h.addFileFilter("prevent_duplicates",function(a,b){if(a)for(var c=this.files.length;c--;)if(b.name===this.files[c].name&&b.size===this.files[c].size)return this.trigger("Error",{code:h.FILE_DUPLICATE_ERROR,message:h.translate("Duplicate file error."),
file:b}),!1;return!0});h.Uploader=function(b){function e(){var a,b=0,c;if(this.state==h.STARTED){for(c=0;c<p.length;c++)a||p[c].status!=h.QUEUED?b++:(a=p[c],this.trigger("BeforeUpload",a)&&(a.status=h.UPLOADING,this.trigger("UploadFile",a)));b==p.length&&(this.state!==h.STOPPED&&(this.state=h.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",p))}}function q(a){a.percent=0<a.size?Math.ceil(100*(a.loaded/a.size)):100;l()}function l(){var a,b;r.reset();for(a=0;a<p.length;a++)b=p[a],
b.size!==c?(r.size+=b.origSize,r.loaded+=b.loaded*b.origSize/b.size):r.size=c,b.status==h.DONE?r.uploaded++:b.status==h.FAILED?r.failed++:r.queued++;r.size===c?r.percent=0<p.length?Math.ceil(100*(r.uploaded/p.length)):0:(r.bytesPerSec=Math.ceil(r.loaded/((+new Date-v||1)/1E3)),r.percent=0<r.size?Math.ceil(100*(r.loaded/r.size)):0)}function s(){var c=this,d=0,e={accept:b.filters.mime_types,runtime_order:b.runtimes,required_caps:y,swf_url:b.flash_swf_url,xap_url:b.silverlight_xap_url};h.each(b.runtimes.split(/\s*,\s*/),
function(a){b[a]&&(e[a]=b[a])});a.inSeries([function(g){b.browse_button?(z=new a.FileInput(h.extend({},e,{name:b.file_data_name,multiple:b.multi_selection,container:b.container,browse_button:b.browse_button})),z.onready=function(){var b=a.Runtime.getInfo(this.ruid);a.extend(c.features,{chunks:b.can("slice_blob"),multipart:b.can("send_multipart"),multi_selection:b.can("select_multiple")});d++;g()},z.onchange=function(){c.addFile(this.files)},z.bind("mouseenter mouseleave mousedown mouseup",function(c){if(!A){var d=
a.get(b.browse_button);d&&(b.browse_button_hover&&("mouseenter"===c.type?a.addClass(d,b.browse_button_hover):"mouseleave"===c.type&&a.removeClass(d,b.browse_button_hover)),b.browse_button_active&&("mousedown"===c.type?a.addClass(d,b.browse_button_active):"mouseup"===c.type&&a.removeClass(d,b.browse_button_active)))}}),z.bind("error runtimeerror",function(){z=null;g()}),z.init()):g()},function(g){b.drop_element?(x=new a.FileDrop(h.extend({},e,{drop_zone:b.drop_element})),x.onready=function(){var b=
a.Runtime.getInfo(this.ruid);c.features.dragdrop=b.can("drag_and_drop");d++;g()},x.ondrop=function(){c.addFile(this.files)},x.bind("error runtimeerror",function(){x=null;g()}),x.init()):g()}],function(){"function"==typeof b.init?b.init(c):h.each(b.init,function(a,b){c.bind(b,a)});d?c.trigger("PostInit"):c.trigger("Error",{code:h.INIT_ERROR,message:h.translate("Init error.")})})}function n(b,c){if(b.ruid){var d=a.Runtime.getInfo(b.ruid);if(d)return d.can(c)}return!1}function m(b,c,d){var e=new a.Image;
try{e.onload=function(){e.downsize(c.width,c.height,c.crop,c.preserve_headers)},e.onresize=function(){d(this.getAsBlob(b.type,c.quality));this.destroy()},e.onerror=function(){d(b)},e.load(b)}catch(f){d(b)}}var p=[],t={},y={},v,r,A=!1,z,x,u;r=new h.QueueProgress;b=h.extend({runtimes:a.Runtime.order,max_retries:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",send_chunk_number:!0},b);b.resize&&(b.resize=h.extend({preserve_headers:!0,
crop:!1},b.resize));b.chunk_size=h.parseSize(b.chunk_size)||0;"array"===h.typeOf(b.filters)&&(b.filters={mime_types:b.filters});b.filters=h.extend({mime_types:[],prevent_duplicates:!!b.prevent_duplicates,max_file_size:h.parseSize(b.max_file_size)||0},b.filters);b.required_features=y=d(h.extend({},b));h.extend(this,{id:h.guid(),state:h.STOPPED,features:{},runtime:a.Runtime.thatCan(y,b.runtimes),files:p,settings:b,total:r,init:function(){var c=this;b.browse_button=a.get(b.browse_button);b.drop_element=
a.get(b.drop_element);"function"==typeof b.preinit?b.preinit(c):h.each(b.preinit,function(a,b){c.bind(b,a)});b.browse_button&&b.url?(c.bind("BeforeAdd",function(a,b){var c,d=a.settings.filters;for(c in d)if(k[c]&&!k[c].call(this,d[c],b))return!1}),c.bind("FilesAdded",function(a,b){[].push.apply(p,b);g(function(){c.trigger("QueueChanged");c.refresh()},1)}),c.bind("CancelUpload",function(){u&&u.abort()}),b.unique_names&&c.bind("BeforeUpload",function(a,b){var c=b.name.match(/\.([^.]+)$/),d="part";c&&
(d=c[1]);b.target_name=b.id+"."+d}),c.bind("UploadFile",function(c,d){function e(){0<s--?g(k,1):(d.loaded=t,c.trigger("Error",{code:h.HTTP_ERROR,message:h.translate("HTTP Error."),file:d,response:u.responseText,status:u.status,responseHeaders:u.getAllResponseHeaders()}))}function k(){var m,n,s,w;d.status!=h.DONE&&(d.status!=h.FAILED&&c.state!=h.STOPPED)&&(s={name:d.target_name||d.name},q&&p.chunks&&r.size>q?(w=Math.min(q,r.size-t),m=r.slice(t,t+w)):(w=r.size,m=r),q&&p.chunks&&(b.send_chunk_number?
(s.chunk=Math.ceil(t/q),s.chunks=Math.ceil(r.size/q)):(s.offset=t,s.total=r.size)),u=new a.XMLHttpRequest,u.upload&&(u.upload.onprogress=function(a){d.loaded=Math.min(d.size,t+a.loaded);c.trigger("UploadProgress",d)}),u.onload=function(){400<=u.status?e():(w<r.size?(m.destroy(),t+=w,d.loaded=Math.min(t,r.size),c.trigger("ChunkUploaded",d,{offset:d.loaded,total:r.size,response:u.responseText,status:u.status,responseHeaders:u.getAllResponseHeaders()}),"Android Browser"===a.Env.browser&&c.trigger("UploadProgress",
d)):d.loaded=d.size,m=n=null,!t||t>=r.size?(d.size!=d.origSize&&(r.destroy(),r=null),c.trigger("UploadProgress",d),d.status=h.DONE,c.trigger("FileUploaded",d,{response:u.responseText,status:u.status,responseHeaders:u.getAllResponseHeaders()})):g(k,1))},u.onerror=function(){e()},u.onloadend=function(){this.destroy();u=null},c.settings.multipart&&p.multipart?(s.name=d.target_name||d.name,u.open("post",l,!0),h.each(c.settings.headers,function(a,b){u.setRequestHeader(b,a)}),n=new a.FormData,h.each(h.extend(s,
c.settings.multipart_params),function(a,b){n.append(b,a)}),n.append(c.settings.file_data_name,m),u.send(n,{runtime_order:c.settings.runtimes,required_caps:y,swf_url:c.settings.flash_swf_url,xap_url:c.settings.silverlight_xap_url})):(l=h.buildUrl(c.settings.url,h.extend(s,c.settings.multipart_params)),u.open("post",l,!0),u.setRequestHeader("Content-Type","application/octet-stream"),h.each(c.settings.headers,function(a,b){u.setRequestHeader(b,a)}),u.send(m,{runtime_order:c.settings.runtimes,required_caps:y,
swf_url:c.settings.flash_swf_url,xap_url:c.settings.silverlight_xap_url})))}var l=c.settings.url,p=c.features,q=b.chunk_size,s=b.max_retries,r,t=0;d.loaded&&(t=d.loaded=q*Math.floor(d.loaded/q));r=d.getSource();!a.isEmptyObj(c.settings.resize)&&n(r,"send_binary_string")&&~a.inArray(r.type,["image/jpeg","image/png"])?m.call(this,r,c.settings.resize,function(a){r=a;d.size=a.size;k()}):k()}),c.bind("UploadProgress",function(a,b){q(b)}),c.bind("StateChanged",function(a){if(a.state==h.STARTED)v=+new Date;
else if(a.state==h.STOPPED)for(var b=a.files.length-1;0<=b;b--)a.files[b].status==h.UPLOADING&&(a.files[b].status=h.QUEUED,l())}),c.bind("QueueChanged",l),c.bind("Error",function(a,b){b.file&&(b.file.status=h.FAILED,q(b.file),a.state==h.STARTED&&g(function(){e.call(c)},1))}),c.bind("FileUploaded",function(){l();g(function(){e.call(c)},1)}),c.trigger("Init",{runtime:this.runtime}),s.call(this)):this.trigger("Error",{code:h.INIT_ERROR,message:h.translate("Init error.")})},refresh:function(){z&&z.trigger("Refresh");
this.trigger("Refresh")},start:function(){this.state!=h.STARTED&&(this.state=h.STARTED,this.trigger("StateChanged"),e.call(this))},stop:function(){this.state!=h.STOPPED&&(this.state=h.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(a){A=a!==c?a:!0;z&&z.disable(A);this.trigger("DisableBrowse",A)},getFile:function(a){var b;for(b=p.length-1;0<=b;b--)if(p[b].id===a)return p[b]},addFile:function(b,c){function d(b){var k=a.typeOf(b);if(b instanceof a.File){if(!b.ruid){if(!g)return!1;
b.ruid=g;b.connectRuntime(g)}d(new h.File(b))}else b instanceof a.Blob?(d(b.getSource()),b.destroy()):b instanceof h.File?(c&&(b.name=c),e.trigger("BeforeAdd",b)&&f.push(b)):-1!==a.inArray(k,["file","blob"])?d(new a.File(null,b)):"node"===k&&"filelist"===a.typeOf(b.files)?a.each(b.files,d):"array"===k&&(c=null,a.each(b,d))}var e=this,f=[],g;g=function(){var a=x||z;return a?a.getRuntime().uid:!1}();d(b);f.length&&this.trigger("FilesAdded",f)},removeFile:function(a){a="string"==typeof a?a:a.id;for(var b=
p.length-1;0<=b;b--)if(p[b].id===a)return this.splice(b,1)[0]},splice:function(a,b){var d=p.splice(a===c?0:a,b===c?p.length:b);return this.trigger("FilesRemoved",d),this.trigger("QueueChanged"),h.each(d,function(a){a.destroy()}),d},trigger:function(a){var b=t[a.toLowerCase()],c,d;if(b)for(d=Array.prototype.slice.call(arguments),d[0]=this,c=0;c<b.length;c++)if(!1===b[c].func.apply(b[c].scope,d))return!1;return!0},hasEventListener:function(a){return!!t[a.toLowerCase()]},bind:function(a,b,c){var d;a=
a.toLowerCase();d=t[a]||[];d.push({func:b,scope:c||this});t[a]=d},unbind:function(a,b){a=a.toLowerCase();var d=t[a],e;if(d){if(b!==c)for(e=d.length-1;0<=e;e--){if(d[e].func===b){d.splice(e,1);break}}else d=[];d.length||delete t[a]}},unbindAll:function(){var a=this;h.each(t,function(b,c){a.unbind(c)})},destroy:function(){this.stop();h.each(p,function(a){a.destroy()});p=[];z&&(z.destroy(),z=null);x&&(x.destroy(),x=null);y={};v=r=A=u=null;this.trigger("Destroy");this.unbindAll();t={}}})};h.File=function(){var b=
{};return function(c){h.extend(this,{id:h.guid(),name:c.name||c.fileName,type:c.type||"",size:c.size||c.fileSize,origSize:c.size||c.fileSize,loaded:0,percent:0,status:h.QUEUED,lastModifiedDate:c.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var b=this.getSource().getSource();return-1!==a.inArray(a.typeOf(b),["blob","file"])?b:null},getSource:function(){return b[this.id]?b[this.id]:null},destroy:function(){var a=this.getSource();a&&(a.destroy(),delete b[this.id])}});b[this.id]=
c}}();h.QueueProgress=function(){var a=this;a.size=0;a.loaded=0;a.uploaded=0;a.failed=0;a.queued=0;a.percent=0;a.bytesPerSec=0;a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}};b.plupload=h})(window,mOxie);(function(b){function a(a){return plupload.translate(a)||a}function c(c,d){d.contents().each(function(a,c){c=b(c);c.is(".plupload")||c.remove()});d.prepend('<div class="plupload_wrapper plupload_scroll"><div id="'+c+'_container" class="plupload_container"><div class="plupload"><div class="plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+a("Select files")+'</div><div class="plupload_header_text">'+a("Add files to queue and click upload.")+'</div></div></div><div class="plupload_content"><div class="plupload_filelist_header"><div class="plupload_file_name">'+
a("Filename")+'</div><div class="plupload_file_action">&nbsp;</div><div class="plupload_file_status"><span>'+a("Status")+'</span></div><div class="plupload_file_size">'+a("Size")+'</div><div class="plupload_clearer">&nbsp;</div></div><ul id="'+c+'_filelist" class="plupload_filelist"></ul><div class="plupload_filelist_footer"><div class="plupload_file_name"><div class="plupload_buttons"><a href="#" class="plupload_button plupload_add" id="'+c+'_browse">'+a("Add")+'</a><a href="#" class="plupload_button plupload_start">'+
a("Upload")+'</a></div><span class="plupload_upload_status"></span></div><div class="plupload_file_action"></div><div class="plupload_file_status"><span class="plupload_total_status">0%</span></div><div class="plupload_file_size"><span class="plupload_total_file_size">0 b</span></div><div class="plupload_progress"><div class="plupload_progress_container"><div class="plupload_progress_bar"></div></div></div><div class="plupload_clearer">&nbsp;</div></div></div></div></div><input type="hidden" id="'+
c+'_count" name="'+c+'_count" value="0" /></div>')}var d={};b.fn.pluploadQueue=function(g){return g?(this.each(function(){function k(a){var c;a.status==plupload.DONE&&(c="plupload_done");a.status==plupload.FAILED&&(c="plupload_failed");a.status==plupload.QUEUED&&(c="plupload_delete");a.status==plupload.UPLOADING&&(c="plupload_uploading");c=b("#"+a.id).attr("class",c).find("a").css("display","block");a.hint&&c.attr("title",a.hint)}function h(){b("span.plupload_total_status",q).html(e.total.percent+
"%");b("div.plupload_progress_bar",q).css("width",e.total.percent+"%");b("span.plupload_upload_status",q).html(a("Uploaded %d/%d files").replace(/%d\/%d/,e.total.uploaded+"/"+e.files.length))}function f(){var c=b("ul.plupload_filelist",q).html(""),d=0,f;b.each(e.files,function(a,g){f="";g.status==plupload.DONE&&(g.target_name&&(f+='<input type="hidden" name="'+l+"_"+d+'_tmpname" value="'+plupload.xmlEncode(g.target_name)+'" />'),f+='<input type="hidden" name="'+l+"_"+d+'_name" value="'+plupload.xmlEncode(g.name)+
'" />',f+='<input type="hidden" name="'+l+"_"+d+'_status" value="'+(g.status==plupload.DONE?"done":"failed")+'" />',d++,b("#"+l+"_count").val(d));c.append('<li id="'+g.id+'"><div class="plupload_file_name"><span>'+g.name+'</span></div><div class="plupload_file_action"><a href="#"></a></div><div class="plupload_file_status">'+g.percent+'%</div><div class="plupload_file_size">'+plupload.formatSize(g.size)+'</div><div class="plupload_clearer">&nbsp;</div>'+f+"</li>");k(g);b("#"+g.id+".plupload_delete a").click(function(a){b("#"+
g.id).remove();e.removeFile(g);a.preventDefault()})});b("span.plupload_total_file_size",q).html(plupload.formatSize(e.total.size));0===e.total.queued?b("span.plupload_add_text",q).html(a("Add")):b("span.plupload_add_text",q).html(a("%d files queued").replace(/%d/,e.total.queued));b("a.plupload_start",q).toggleClass("plupload_disabled",e.files.length==e.total.uploaded+e.total.failed);c[0].scrollTop=c[0].scrollHeight;h();!e.files.length&&(e.features.dragdrop&&e.settings.dragdrop)&&b("#"+l+"_filelist").append('<li class="plupload_droptext">'+
a("Drag files here.")+"</li>")}var e,q,l,s;q=b(this);l=q.attr("id");l||(l=plupload.guid(),q.attr("id",l));s=q.html();c(l,q);e=new plupload.Uploader(b.extend({dragdrop:!0,browse_button:l+"_browse",container:l},g));d[l]=e;e.bind("UploadFile",function(a,c){b("#"+c.id).addClass("plupload_current_file")});e.bind("Init",function(a,c){if(!g.unique_names&&g.rename)q.on("click","#"+l+"_filelist div.plupload_file_name span",function(c){var d=b(c.target),e,f,g="";e=a.getFile(d.parents("li")[0].id);f=e.name;
if(c=/^(.+)(\.[^.]+)$/.exec(f))f=c[1],g=c[2];d.hide().after('<input type="text" />');d.next().val(f).focus().blur(function(){d.show().next().remove()}).keydown(function(a){var c=b(this);13==a.keyCode&&(a.preventDefault(),e.name=c.val()+g,d.html(e.name),c.blur())})});a.settings.dragdrop&&(a.settings.drop_element=l+"_filelist");b("#"+l+"_container").attr("title","Using runtime: "+c.runtime);b("a.plupload_start",q).click(function(a){b(this).hasClass("plupload_disabled")||e.start();a.preventDefault()});
b("a.plupload_stop",q).click(function(a){a.preventDefault();e.stop()});b("a.plupload_start",q).addClass("plupload_disabled")});e.bind("Error",function(c,f){var g=f.file,h;g&&(h=f.message,f.details&&(h+=" ("+f.details+")"),f.code==plupload.FILE_SIZE_ERROR&&alert(a("Error: File too large:")+" "+g.name),f.code==plupload.FILE_EXTENSION_ERROR&&alert(a("Error: Invalid file extension:")+" "+g.name),g.hint=h,b("#"+g.id).attr("class","plupload_failed").find("a").css("display","block").attr("title",h));f.code===
plupload.INIT_ERROR&&setTimeout(function(){delete d[l];e.destroy();q.html(s);e=q=s=null},1)});e.bind("PostInit",function(c){c.settings.dragdrop&&c.features.dragdrop&&b("#"+l+"_filelist").append('<li class="plupload_droptext">'+a("Drag files here.")+"</li>")});e.init();e.bind("StateChanged",function(){e.state===plupload.STARTED?(b("li.plupload_delete a,div.plupload_buttons",q).hide(),b("span.plupload_upload_status,div.plupload_progress,a.plupload_stop",q).css("display","block"),b("span.plupload_upload_status",
q).html("Uploaded "+e.total.uploaded+"/"+e.files.length+" files"),g.multiple_queues&&b("span.plupload_total_status,span.plupload_total_file_size",q).show()):(f(),b("a.plupload_stop,div.plupload_progress",q).hide(),b("a.plupload_delete",q).css("display","block"),g.multiple_queues&&e.total.uploaded+e.total.failed==e.files.length&&(b(".plupload_buttons,.plupload_upload_status",q).css("display","inline"),b(".plupload_start",q).addClass("plupload_disabled"),b("span.plupload_total_status,span.plupload_total_file_size",
q).hide()))});e.bind("QueueChanged",f);e.bind("FileUploaded",function(a,b){k(b)});e.bind("UploadProgress",function(a,c){b("#"+c.id+" div.plupload_file_status",q).html(c.percent+"%");k(c);h()});g.setup&&g.setup(e)}),this):d[b(this[0]).attr("id")]}})(jQuery);(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):b(window.jQuery)})(function(b){var a=0;b.ajaxTransport("iframe",function(c){if(c.async){var d=c.initialIframeSrc||"javascript:false;",g,k,h;return{send:function(f,e){g=b('<form style="display:none;"></form>');g.attr("accept-charset",c.formAcceptCharset);h=/\?/.test(c.url)?"&":"?";"DELETE"===c.type?(c.url=c.url+h+"_method=DELETE",c.type="POST"):"PUT"===c.type?(c.url=c.url+h+"_method=PUT",c.type="POST"):"PATCH"===c.type&&(c.url=
c.url+h+"_method=PATCH",c.type="POST");a+=1;k=b('<iframe src="'+d+'" name="iframe-transport-'+a+'"></iframe>').bind("load",function(){var a,f=b.isArray(c.paramName)?c.paramName:[c.paramName];k.unbind("load").bind("load",function(){var a;try{if(a=k.contents(),!a.length||!a[0].firstChild)throw Error();}catch(c){a=void 0}e(200,"success",{iframe:a});b('<iframe src="'+d+'"></iframe>').appendTo(g);window.setTimeout(function(){g.remove()},0)});g.prop("target",k.prop("name")).prop("action",c.url).prop("method",
c.type);c.formData&&b.each(c.formData,function(a,c){b('<input type="hidden"/>').prop("name",c.name).val(c.value).appendTo(g)});c.fileInput&&(c.fileInput.length&&"POST"===c.type)&&(a=c.fileInput.clone(),c.fileInput.after(function(b){return a[b]}),c.paramName&&c.fileInput.each(function(a){b(this).prop("name",f[a]||c.paramName)}),g.append(c.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),c.fileInput.removeAttr("form"));g.submit();a&&a.length&&c.fileInput.each(function(c,
d){var e=b(a[c]);b(d).prop("name",e.prop("name")).attr("form",e.attr("form"));e.replaceWith(d)})});g.append(k).appendTo(document.body)},abort:function(){k&&k.unbind("load").prop("src",d);g&&g.remove()}}}});b.ajaxSetup({converters:{"iframe text":function(a){return a&&b(a[0].body).text()},"iframe json":function(a){return a&&b.parseJSON(b(a[0].body).text())},"iframe html":function(a){return a&&b(a[0].body).html()},"iframe xml":function(a){return(a=a&&a[0])&&b.isXMLDoc(a)?a:b.parseXML(a.XMLDocument&&
a.XMLDocument.xml||b(a.body).html())},"iframe script":function(a){return a&&b.globalEval(b(a[0].body).text())}}})});(function(b){"function"===typeof define&&define.amd?define(["jquery","jquery.ui.widget"],b):b(window.jQuery)})(function(b){b.support.fileInput=!(RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||b('<input type="file">').prop("disabled"));b.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader);b.support.xhrFormDataFileUpload=!!window.FormData;b.support.blobSlice=
window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);b.widget("blueimp.fileupload",{options:{dropZone:b(document),pasteZone:b(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,
uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(a,c){a=this.messages[a]||a.toString();c&&b.each(c,function(b,c){a=a.replace("{"+b+"}",c)});return a},formData:function(a){return a.serializeArray()},add:function(a,c){if(a.isDefaultPrevented())return!1;(c.autoUpload||!1!==c.autoUpload&&b(this).fileupload("option","autoUpload"))&&c.process().done(function(){c.submit()})},processData:!1,
contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:b.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(a,b,d){var g=a-this.timestamp;if(!this.bitrate||!d||g>d)this.bitrate=8*(b-this.loaded)*(1E3/g),this.loaded=b,this.timestamp=a;return this.bitrate}},
_isXHRUpload:function(a){return!a.forceIframeTransport&&(!a.multipart&&b.support.xhrFileUpload||b.support.xhrFormDataFileUpload)},_getFormData:function(a){var c;return"function"===b.type(a.formData)?a.formData(a.form):b.isArray(a.formData)?a.formData:"object"===b.type(a.formData)?(c=[],b.each(a.formData,function(a,b){c.push({name:a,value:b})}),c):[]},_getTotal:function(a){var c=0;b.each(a,function(a,b){c+=b.size||1});return c},_initProgressObject:function(a){var c={loaded:0,total:0,bitrate:0};a._progress?
b.extend(a._progress,c):a._progress=c},_initResponseObject:function(a){var b;if(a._response)for(b in a._response)a._response.hasOwnProperty(b)&&delete a._response[b];else a._response={}},_onProgress:function(a,c){if(a.lengthComputable){var d=Date.now?Date.now():(new Date).getTime(),g;c._time&&c.progressInterval&&d-c._time<c.progressInterval&&a.loaded!==a.total||(c._time=d,g=Math.floor(a.loaded/a.total*(c.chunkSize||c._progress.total))+(c.uploadedBytes||0),this._progress.loaded+=g-c._progress.loaded,
this._progress.bitrate=this._bitrateTimer.getBitrate(d,this._progress.loaded,c.bitrateInterval),c._progress.loaded=c.loaded=g,c._progress.bitrate=c.bitrate=c._bitrateTimer.getBitrate(d,g,c.bitrateInterval),this._trigger("progress",b.Event("progress",{delegatedEvent:a}),c),this._trigger("progressall",b.Event("progressall",{delegatedEvent:a}),this._progress))}},_initProgressListener:function(a){var c=this,d=a.xhr?a.xhr():b.ajaxSettings.xhr();d.upload&&(b(d.upload).bind("progress",function(b){var d=
b.originalEvent;b.lengthComputable=d.lengthComputable;b.loaded=d.loaded;b.total=d.total;c._onProgress(b,a)}),a.xhr=function(){return d})},_isInstanceOf:function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},_initXHRData:function(a){var c=this,d,g=a.files[0],k=a.multipart||!b.support.xhrFileUpload,h="array"===b.type(a.paramName)?a.paramName[0]:a.paramName;a.headers=b.extend({},a.headers);a.contentRange&&(a.headers["Content-Range"]=a.contentRange);k&&!a.blob&&this._isInstanceOf("File",
g)||(a.headers["Content-Disposition"]='attachment; filename="'+encodeURI(g.name)+'"');k?b.support.xhrFormDataFileUpload&&(a.postMessage?(d=this._getFormData(a),a.blob?d.push({name:h,value:a.blob}):b.each(a.files,function(c,e){d.push({name:"array"===b.type(a.paramName)&&a.paramName[c]||h,value:e})})):(c._isInstanceOf("FormData",a.formData)?d=a.formData:(d=new FormData,b.each(this._getFormData(a),function(a,b){d.append(b.name,b.value)})),a.blob?d.append(h,a.blob,g.name):b.each(a.files,function(f,e){(c._isInstanceOf("File",
e)||c._isInstanceOf("Blob",e))&&d.append("array"===b.type(a.paramName)&&a.paramName[f]||h,e,e.uploadName||e.name)})),a.data=d):(a.contentType=g.type||"application/octet-stream",a.data=a.blob||g);a.blob=null},_initIframeSettings:function(a){var c=b("<a></a>").prop("href",a.url).prop("host");a.dataType="iframe "+(a.dataType||"");a.formData=this._getFormData(a);a.redirect&&(c&&c!==location.host)&&a.formData.push({name:a.redirectParamName||"redirect",value:a.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?
(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a)},_getParamName:function(a){var c=b(a.fileInput),d=a.paramName;d?b.isArray(d)||(d=[d]):(d=[],c.each(function(){for(var a=b(this),c=a.prop("name")||"files[]",a=(a.prop("files")||[1]).length;a;)d.push(c),a-=1}),d.length||(d=[c.prop("name")||"files[]"]));return d},_initFormSettings:function(a){a.form&&a.form.length||(a.form=b(a.fileInput.prop("form")),
a.form.length||(a.form=b(this.options.fileInput.prop("form"))));a.paramName=this._getParamName(a);a.url||(a.url=a.form.prop("action")||location.href);a.type=(a.type||"string"===b.type(a.form.prop("method"))&&a.form.prop("method")||"").toUpperCase();"POST"!==a.type&&("PUT"!==a.type&&"PATCH"!==a.type)&&(a.type="POST");a.formAcceptCharset||(a.formAcceptCharset=a.form.attr("accept-charset"))},_getAJAXSettings:function(a){a=b.extend({},this.options,a);this._initFormSettings(a);this._initDataSettings(a);
return a},_getDeferredState:function(a){return a.state?a.state():a.isResolved()?"resolved":a.isRejected()?"rejected":"pending"},_enhancePromise:function(a){a.success=a.done;a.error=a.fail;a.complete=a.always;return a},_getXHRPromise:function(a,c,d){var g=b.Deferred(),k=g.promise();c=c||this.options.context||k;!0===a?g.resolveWith(c,d):!1===a&&g.rejectWith(c,d);k.abort=g.promise;return this._enhancePromise(k)},_addConvenienceMethods:function(a,c){var d=this,g=function(a){return b.Deferred().resolveWith(d,
a).promise()};c.process=function(a,h){if(a||h)c._processQueue=this._processQueue=(this._processQueue||g([this])).pipe(function(){return c.errorThrown?b.Deferred().rejectWith(d,[c]).promise():g(arguments)}).pipe(a,h);return this._processQueue||g([this])};c.submit=function(){"pending"!==this.state()&&(c.jqXHR=this.jqXHR=!1!==d._trigger("submit",b.Event("submit",{delegatedEvent:a}),this)&&d._onSend(a,this));return this.jqXHR||d._getXHRPromise()};c.abort=function(){if(this.jqXHR)return this.jqXHR.abort();
this.errorThrown="abort";d._trigger("fail",null,this);return d._getXHRPromise(!1)};c.state=function(){if(this.jqXHR)return d._getDeferredState(this.jqXHR);if(this._processQueue)return d._getDeferredState(this._processQueue)};c.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===d._getDeferredState(this._processQueue)};c.progress=function(){return this._progress};c.response=function(){return this._response}},_getUploadedBytes:function(a){return(a=(a=(a=a.getResponseHeader("Range"))&&
a.split("-"))&&1<a.length&&parseInt(a[1],10))&&a+1},_chunkedUpload:function(a,c){a.uploadedBytes=a.uploadedBytes||0;var d=this,g=a.files[0],k=g.size,h=a.uploadedBytes,f=a.maxChunkSize||k,e=this._blobSlice,q=b.Deferred(),l=q.promise(),s,n;if(!(this._isXHRUpload(a)&&e&&(h||f<k))||a.data)return!1;if(c)return!0;if(h>=k)return g.error=a.i18n("uploadedBytes"),this._getXHRPromise(!1,a.context,[null,"error",g.error]);n=function(){var c=b.extend({},a),l=c._progress.loaded;c.blob=e.call(g,h,h+f,g.type);c.chunkSize=
c.blob.size;c.contentRange="bytes "+h+"-"+(h+c.chunkSize-1)+"/"+k;d._initXHRData(c);d._initProgressListener(c);s=(!1!==d._trigger("chunksend",null,c)&&b.ajax(c)||d._getXHRPromise(!1,c.context)).done(function(e,f,g){h=d._getUploadedBytes(g)||h+c.chunkSize;l+c.chunkSize-c._progress.loaded&&d._onProgress(b.Event("progress",{lengthComputable:!0,loaded:h-c.uploadedBytes,total:h-c.uploadedBytes}),c);a.uploadedBytes=c.uploadedBytes=h;c.result=e;c.textStatus=f;c.jqXHR=g;d._trigger("chunkdone",null,c);d._trigger("chunkalways",
null,c);h<k?n():q.resolveWith(c.context,[e,f,g])}).fail(function(a,b,e){c.jqXHR=a;c.textStatus=b;c.errorThrown=e;d._trigger("chunkfail",null,c);d._trigger("chunkalways",null,c);q.rejectWith(c.context,[a,b,e])})};this._enhancePromise(l);l.abort=function(){return s.abort()};n();return l},_beforeSend:function(a,b){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(b);this._initProgressObject(b);
b._progress.loaded=b.loaded=b.uploadedBytes||0;b._progress.total=b.total=this._getTotal(b.files)||1;b._progress.bitrate=b.bitrate=0;this._active+=1;this._progress.loaded+=b.loaded;this._progress.total+=b.total},_onDone:function(a,c,d,g){var k=g._progress.total,h=g._response;g._progress.loaded<k&&this._onProgress(b.Event("progress",{lengthComputable:!0,loaded:k,total:k}),g);h.result=g.result=a;h.textStatus=g.textStatus=c;h.jqXHR=g.jqXHR=d;this._trigger("done",null,g)},_onFail:function(a,b,d,g){var k=
g._response;g.recalculateProgress&&(this._progress.loaded-=g._progress.loaded,this._progress.total-=g._progress.total);k.jqXHR=g.jqXHR=a;k.textStatus=g.textStatus=b;k.errorThrown=g.errorThrown=d;this._trigger("fail",null,g)},_onAlways:function(a,b,d,g){this._trigger("always",null,g)},_onSend:function(a,c){c.submit||this._addConvenienceMethods(a,c);var d=this,g,k,h,f,e=d._getAJAXSettings(c),q=function(){d._sending+=1;e._bitrateTimer=new d._BitrateTimer;return g=g||((k||!1===d._trigger("send",b.Event("send",
{delegatedEvent:a}),e))&&d._getXHRPromise(!1,e.context,k)||d._chunkedUpload(e)||b.ajax(e)).done(function(a,b,c){d._onDone(a,b,c,e)}).fail(function(a,b,c){d._onFail(a,b,c,e)}).always(function(a,b,c){d._onAlways(a,b,c,e);d._sending-=1;d._active-=1;if(e.limitConcurrentUploads&&e.limitConcurrentUploads>d._sending)for(a=d._slots.shift();a;){if("pending"===d._getDeferredState(a)){a.resolve();break}a=d._slots.shift()}0===d._active&&d._trigger("stop")})};this._beforeSend(a,e);return this.options.sequentialUploads||
this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(1<this.options.limitConcurrentUploads?(h=b.Deferred(),this._slots.push(h),f=h.pipe(q)):f=this._sequence=this._sequence.pipe(q,q),f.abort=function(){k=[void 0,"abort","abort"];return g?g.abort():(h&&h.rejectWith(e.context,k),q())},this._enhancePromise(f)):q()},_onAdd:function(a,c){var d=this,g=!0,k=b.extend({},this.options,c),h=c.files,f=h.length,e=k.limitMultiFileUploads,q=k.limitMultiFileUploadSize,l=k.limitMultiFileUploadSizeOverhead,
s=0,n=this._getParamName(k),m,p,t=0;!q||f&&void 0!==h[0].size||(q=void 0);if((k.singleFileUploads||e||q)&&this._isXHRUpload(k))if(k.singleFileUploads||q||!e)if(!k.singleFileUploads&&q)for(p=[],m=[],k=0;k<f;k+=1){if(s+=h[k].size+l,k+1===f||s+h[k+1].size+l>q||e&&k+1-t>=e)p.push(h.slice(t,k+1)),s=n.slice(t,k+1),s.length||(s=n),m.push(s),t=k+1,s=0}else m=n;else for(p=[],m=[],k=0;k<f;k+=e)p.push(h.slice(k,k+e)),s=n.slice(k,k+e),s.length||(s=n),m.push(s);else p=[h],m=[n];c.originalFiles=h;b.each(p||h,function(e,
f){var h=b.extend({},c);h.files=p?f:[f];h.paramName=m[e];d._initResponseObject(h);d._initProgressObject(h);d._addConvenienceMethods(a,h);return g=d._trigger("add",b.Event("add",{delegatedEvent:a}),h)});return g},_replaceFileInput:function(a){var c=a.clone(!0);b("<form></form>").append(c)[0].reset();a.after(c).detach();b.cleanData(a.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(b,g){return g===a[0]?c[0]:g});a[0]===this.element[0]&&(this.element=c)},_handleFileTreeEntry:function(a,
c){var d=this,g=b.Deferred(),k=function(b){b&&!b.entry&&(b.entry=a);g.resolve([b])},h;c=c||"";a.isFile?a._file?(a._file.relativePath=c,g.resolve(a._file)):a.file(function(a){a.relativePath=c;g.resolve(a)},k):a.isDirectory?(h=a.createReader(),h.readEntries(function(b){d._handleFileTreeEntries(b,c+a.name+"/").done(function(a){g.resolve(a)}).fail(k)},k)):g.resolve([]);return g.promise()},_handleFileTreeEntries:function(a,c){var d=this;return b.when.apply(b,b.map(a,function(a){return d._handleFileTreeEntry(a,
c)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(a){a=a||{};var c=a.items;return c&&c.length&&(c[0].webkitGetAsEntry||c[0].getAsEntry)?this._handleFileTreeEntries(b.map(c,function(a){var b;if(a.webkitGetAsEntry){if(b=a.webkitGetAsEntry())b._file=a.getAsFile();return b}return a.getAsEntry()})):b.Deferred().resolve(b.makeArray(a.files)).promise()},_getSingleFileInputFiles:function(a){a=b(a);var c=a.prop("webkitEntries")||a.prop("entries");if(c&&c.length)return this._handleFileTreeEntries(c);
c=b.makeArray(a.prop("files"));if(c.length)void 0===c[0].name&&c[0].fileName&&b.each(c,function(a,b){b.name=b.fileName;b.size=b.fileSize});else{a=a.prop("value");if(!a)return b.Deferred().resolve([]).promise();c=[{name:a.replace(/^.*\\/,"")}]}return b.Deferred().resolve(c).promise()},_getFileInputFiles:function(a){return a instanceof b&&1!==a.length?b.when.apply(b,b.map(a,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(a)},
_onChange:function(a){var c=this,d={fileInput:b(a.target),form:b(a.target.form)};this._getFileInputFiles(d.fileInput).always(function(g){d.files=g;c.options.replaceFileInput&&c._replaceFileInput(d.fileInput);!1!==c._trigger("change",b.Event("change",{delegatedEvent:a}),d)&&c._onAdd(a,d)})},_onPaste:function(a){var c=a.originalEvent&&a.originalEvent.clipboardData&&a.originalEvent.clipboardData.items,d={files:[]};c&&c.length&&(b.each(c,function(a,b){var c=b.getAsFile&&b.getAsFile();c&&d.files.push(c)}),
!1!==this._trigger("paste",b.Event("paste",{delegatedEvent:a}),d)&&this._onAdd(a,d))},_onDrop:function(a){a.dataTransfer=a.originalEvent&&a.originalEvent.dataTransfer;var c=this,d=a.dataTransfer,g={};d&&(d.files&&d.files.length)&&(a.preventDefault(),this._getDroppedFiles(d).always(function(d){g.files=d;!1!==c._trigger("drop",b.Event("drop",{delegatedEvent:a}),g)&&c._onAdd(a,g)}))},_onDragOver:function(a){a.dataTransfer=a.originalEvent&&a.originalEvent.dataTransfer;var c=a.dataTransfer;c&&(-1!==b.inArray("Files",
c.types)&&!1!==this._trigger("dragover",b.Event("dragover",{delegatedEvent:a})))&&(a.preventDefault(),c.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));b.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,
"paste");this._off(this.options.fileInput,"change")},_setOption:function(a,c){var d=-1!==b.inArray(a,this._specialOptions);d&&this._destroyEventHandlers();this._super(a,c);d&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var a=this.options;void 0===a.fileInput?a.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):a.fileInput instanceof b||(a.fileInput=b(a.fileInput));a.dropZone instanceof b||(a.dropZone=b(a.dropZone));
a.pasteZone instanceof b||(a.pasteZone=b(a.pasteZone))},_getRegExp:function(a){a=a.split("/");var b=a.pop();a.shift();return RegExp(a.join("/"),b)},_isRegExpOption:function(a,c){return"url"!==a&&"string"===b.type(c)&&/^\/.*\/[igm]{0,3}$/.test(c)},_initDataAttributes:function(){var a=this,c=this.options;b.each(b(this.element[0].cloneNode(!1)).data(),function(b,g){a._isRegExpOption(b,g)&&(g=a._getRegExp(g));c[b]=g})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=
[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(a){var c=this;a&&!this.options.disabled&&(a.fileInput&&!a.files?this._getFileInputFiles(a.fileInput).always(function(b){a.files=b;c._onAdd(null,a)}):(a.files=b.makeArray(a.files),this._onAdd(null,a)))},send:function(a){if(a&&!this.options.disabled){if(a.fileInput&&!a.files){var c=
this,d=b.Deferred(),g=d.promise(),k,h;g.abort=function(){h=!0;if(k)return k.abort();d.reject(null,"abort","abort");return g};this._getFileInputFiles(a.fileInput).always(function(b){h||(b.length?(a.files=b,k=c._onSend(null,a).then(function(a,b,c){d.resolve(a,b,c)},function(a,b,c){d.reject(a,b,c)})):d.reject())});return this._enhancePromise(g)}a.files=b.makeArray(a.files);if(a.files.length)return this._onSend(null,a)}return this._getXHRPromise(!1,a&&a.context)}})});$(document).ready(function(){$("#playerOne").jPlayer({errorAlerts:!1,warningAlerts:!1,preload:"auto",swfPath:"includes/js",ready:function(){},progress:function(a){1==primary_player&&(seekPercent=a.jPlayer.status.seekPercent,null==seekPercent&&(seekPercent=100,consoleLog("seekPercent was null, so setting it to ",seekPercent)),100>seekPercent||!load_progress_complete)&&(consoleLog("Inside progress event handler",a),consoleLog("Updating load progress display to ",seekPercent),updateLoadProgressDisplay(seekPercent),
100==seekPercent&&(load_progress_complete=!0,updateLoadProgressDisplay(100)))},stalled:function(a){playing&&1==primary_player&&$.mobile.loading("show",theme.bars,"Stalled")},waiting:function(a){1==primary_player&&(consoleLog("Inside waiting event handler",a),$.mobile.loading("show",theme.bars,"Waiting"))},abort:function(a){1==primary_player&&$.mobile.loading("show",theme.bars,"Aborting")},error:function(a){consoleLog("Inside error event handler for playerOne",a.jPlayer.error)},warning:function(a){consoleLog("Inside warning event handler for playerOne",
a.jPlayer.warning)},loadstart:function(a){playing&&(1==primary_player&&""!=a.jPlayer.status.src)&&(consoleLog("current track position",current_track_position),0<current_track_position&&(a.jPlayer.status.src==playlist.tracks[track_position].oggurl||a.jPlayer.status.src==playlist.tracks[track_position].url)&&!shuffle_queue?$.mobile.loading("show",theme.bars,"Resuming"):$.mobile.loading("show",theme.bars,"Loading"))},loadedmetadata:function(a){1==primary_player&&(consoleLog("Inside loadedmetadata event handler",
a),$.mobile.loading("show",theme.bars,"Metadata loaded"))},durationchange:function(a){consoleLog("Inside durationchange event handler for playerOne",a)},playing:function(a){1==primary_player&&(consoleLog("Inside playing event handler",a),$.mobile.loading("show",theme.bars,"Playing"))},timeupdate:function(a){1==primary_player&&(currentTime=a.jPlayer.status.currentTime,totalDuration=a.jPlayer.status.duration,0===playlist.tracks[track_position].url.indexOf("http://")&&(totalDuration="Infinity:NaN"),
playProgress=a.jPlayer.status.currentPercentAbsolute,0==playProgress&&(playProgress=a.jPlayer.status.currentPercentRelative),processTimeUpdate(currentTime,totalDuration,playProgress))},ended:function(a){next_track_already_added?(consoleLog("Updating the currently playing track info",playlist.tracks[track_position]),updateCurrentTrackInfo(playlist.tracks[track_position]),next_track_already_added=!1,out_volume_left_to_fade=volume_fade-1,in_volume_left_to_fade=volume_fade-1,crossfade_is_in_progress=
!1,primary_player=1==primary_player?2:1,consoleLog("Primary player set to "+primary_player),tmpPlayerSelector=activePlayerSelector,activePlayerSelector=inactivePlayerSelector,inactivePlayerSelector=tmpPlayerSelector,consoleLog("Active player selector is now: "+activePlayerSelector),consoleLog("Inactive player selector is now: "+inactivePlayerSelector),$(inactivePlayerSelector).jPlayer("volume",1),load_progress_complete=!1):repeat_track?skipto("same"):skipto("next")},volumechange:function(a){consoleLog("Player volume set to "+
a.jPlayer.options.volume)}});$("#playerTwo").jPlayer({errorAlerts:!1,warningAlerts:!1,preload:"auto",swfPath:"includes/js",cssSelectorAncestor:"#jukebox",ready:function(){},progress:function(a){2==primary_player&&(seekPercent=a.jPlayer.status.seekPercent,null==seekPercent&&(seekPercent=100,consoleLog("seekPercent was null, so setting it to ",seekPercent)),100>seekPercent||!load_progress_complete)&&(consoleLog("Inside progress event handler",a),consoleLog("Updating load progress display to ",seekPercent),
updateLoadProgressDisplay(seekPercent),100==seekPercent&&(load_progress_complete=!0,updateLoadProgressDisplay(100)))},stalled:function(a){playing&&2==primary_player&&$.mobile.loading("show",theme.bars,"Stalled")},waiting:function(a){2==primary_player&&(consoleLog("Inside waiting event handler",a),$.mobile.loading("show",theme.bars,"Waiting"))},abort:function(a){2==primary_player&&$.mobile.loading("show",theme.bars,"Aborting")},error:function(a){consoleLog("Inside error event handler for playerTwo",
a.jPlayer.error)},warning:function(a){consoleLog("Inside warning event handler for playerTwo",a.jPlayer.warning)},loadstart:function(a){playing&&(2==primary_player&&""!=a.jPlayer.status.src)&&(consoleLog("current track position",current_track_position),0<current_track_position&&(a.jPlayer.status.src==playlist.tracks[track_position].oggurl||a.jPlayer.status.src==playlist.tracks[track_position].url)&&!shuffle_queue?$.mobile.loading("show",theme.bars,"Resuming"):$.mobile.loading("show",theme.bars,"Loading"))},
loadedmetadata:function(a){2==primary_player&&(consoleLog("Inside loadedmetadata event handler",a),$.mobile.loading("show",theme.bars,"Metadata loaded"))},durationchange:function(a){consoleLog("Inside durationchange event handler for playerTwo",a)},playing:function(a){2==primary_player&&(consoleLog("Inside playing event handler",a),$.mobile.loading("show",theme.bars,"Playing"))},timeupdate:function(a){2==primary_player&&(currentTime=a.jPlayer.status.currentTime,totalDuration=a.jPlayer.status.duration,
0===playlist.tracks[track_position].url.indexOf("http://")&&(totalDuration="Infinity:NaN"),playProgress=a.jPlayer.status.currentPercentAbsolute,0==playProgress&&(playProgress=a.jPlayer.status.currentPercentRelative),processTimeUpdate(currentTime,totalDuration,playProgress))},ended:function(a){next_track_already_added?(consoleLog("Updating the currently playing track info",playlist.tracks[track_position]),updateCurrentTrackInfo(playlist.tracks[track_position]),next_track_already_added=!1,out_volume_left_to_fade=
volume_fade-1,in_volume_left_to_fade=volume_fade-1,crossfade_is_in_progress=!1,primary_player=1==primary_player?2:1,consoleLog("Primary player set to "+primary_player),tmpPlayerSelector=activePlayerSelector,activePlayerSelector=inactivePlayerSelector,inactivePlayerSelector=tmpPlayerSelector,consoleLog("Active player selector is now: "+activePlayerSelector),consoleLog("Inactive player selector is now: "+inactivePlayerSelector),$(inactivePlayerSelector).jPlayer("volume",1),load_progress_complete=!1):
repeat_track?skipto("same"):skipto("next")},volumechange:function(a){consoleLog("Player volume set to "+a.jPlayer.options.volume)}});if("undefined"!==typeof playlist&&"undefined"!==typeof playlist.tracks){$("#artistDiv").html(playlist.tracks[track_position].artist);var b=playlist.tracks[track_position].album,b=b.length>max_album_name_string_length?b.substring(0,max_album_name_string_length)+"...":b;$("#albumDiv").html(b).trigger("updatelayout");0===playlist.tracks[track_position].url.indexOf("http://")?
$("#trackDiv").html(playlist.tracks[track_position].url).trigger("updatelayout"):(b=playlist.tracks[track_position].title,b=b.length>max_track_title_string_length?b.substring(0,max_track_title_string_length)+"...":b,$("#trackDiv").html(b).trigger("updatelayout"))}});function control_mpd(b,a){var c="/musicpd/index",d=!1,g=!1,k=!1,h="Loading",f=0;switch(b){case "play":c="/musicpd/control/play";break;case "pause":c="/musicpd/control/pause";break;case "stop":c="/musicpd/control/stop";break;case "next":c="/musicpd/control/next";break;case "prev":c="/musicpd/control/previous";break;case "set_crossfade":c="/musicpd/control/crossfade";break;case "shuffle":c="/musicpd/control/shuffle";break;case "repeat":c="/musicpd/control/repeat";break;case "set_volume":c="/musicpd/control/volume";
break;case "mute":c="/musicpd/control/mute";break;case "start_over":c="/musicpd/control/reset";break;case "save_playlist":g=!0;h="Saving playlist";c="/musicpd/playlist/save";d=!0;break;case "delete_playlist":g=!0;h="Deleting playlist";c="/musicpd/playlist/delete";d=!0;break;case "track_add":c="/musicpd/playlist/add/track";break;case "move_track":c="/musicpd/playlist/move/track";break;case "track_move":c="/musicpd/playlist/move/track";break;case "track_remove":c="/musicpd/playlist/remove/track";break;
case "remove":f=3E3;g=!0;h="Removing track";c="/musicpd/playlist/remove/track";break;case "clear":f=3E3;g=!0;h="Clearing playlist";c="/musicpd/playlist/clear";break;case "add":f=1E3;g=!0;k=!1;h="Adding track";c="/musicpd/playlist/add/track";break;case "add_url":c="/musicpd/playlist/add/url";break;case "add_all":f=3E3;g=!0;h="Adding tracks";c="/musicpd/playlist/add/tracks";d=!0;break;case "add_albums":f=3E3;g=!0;h="Adding albums";c="/musicpd/playlist/add/albums";d=!0;break;case "skip_to":c="/musicpd/control/skip";
break;case "update":f=3E3;g=!0;h="Refreshing MPD";c="/musicpd/control/refresh";break;default:c="/musicpd/index"}post_data="";if("undefined"!==typeof a){for(parameter in a)post_data+=parameter+"="+encodeURIComponent(a[parameter])+"&";post_data=post_data.substring(0,post_data.length-1)}g&&(0==f&&($.mobile.loadingMessage=h),$.mobile.loading("show","a",h,k));$.ajax({type:"POST",url:c,async:!0,dataType:"json",data:post_data,success:function(a){g&&(""!=a.message?($.mobile.loading("hide"),$.mobile.loadingMessage=
a.message,$.mobile.loading("show",a.success?theme.body:"r",a.message,k),f=3E3,d=!1,setTimeout(function(){$.mobile.loading("hide");$.mobile.loadingMessage="Loading"},f)):0==f?($.mobile.loading("hide"),$.mobile.loadingMessage="Loading"):setTimeout(function(){$.mobile.loading("hide")},f));d&&setTimeout(function(){$("#header-back-link").trigger("click")},f);if(a.success)switch(a.action){case "clear":clearQueue();break;case "remove":removeQueuedTrack(a.id,a.index)}}})};function get_timer_display(b){minutes="-";seconds="--";time_display=minutes+":"+seconds;if("Infinity:NaN"==b)return time_display="<font style='font-size:12px;'>\u221e</font>",b="#FFFFFF",b=0==(new Date).getSeconds()%2?"#FFFFFF":"#000000",$("#streamProgressDiv").css("background-color",b),time_display;0<b&&(minutes=Math.floor(b/60),seconds=Math.floor(b%60),10>seconds&&(seconds="0"+seconds));time_display=minutes+":"+seconds;if("0:01"==time_display||"0:00"==time_display)time_display="-:--";return time_display}
function initialize_timer_display(){$("#trackPlayDuration").html("-:--");$("#playProgressDiv").css("width",0);$("#playProgressDiv").css("background-color","#FFFFFF");$("#loadProgressDiv").css("width","100%");$("#loadProgressDiv").css("background","rgba(0, 0, 0, .4)");$("#loadProgressDiv").css("border","1px inset #888888");$("#trackTotalDuration").html("-:--")}
function fade_out_current_track(){try{0<out_volume_left_to_fade&&(out_faded_volume=out_volume_left_to_fade/volume_fade,consoleLog("Setting "+activePlayerSelector+" volume to: "+out_faded_volume),$(activePlayerSelector).jPlayer("volume",out_faded_volume),out_volume_left_to_fade--)}catch(b){}}
function fade_in_next_track(){try{0<volume_fade-in_volume_left_to_fade&&0<=in_volume_left_to_fade&&(in_faded_volume=(volume_fade-in_volume_left_to_fade)/volume_fade,consoleLog("Setting "+activePlayerSelector+" volume to: "+out_faded_volume),$(activePlayerSelector).jPlayer("volume",out_faded_volume),in_volume_left_to_fade--)}catch(b){}}
function play_station_stream(b){$.ajax({type:"POST",url:"/stations/get_station_details",async:!0,data:"station_id="+b,success:function(a){result=$.parseJSON(a);station=result.station[0];"undefined"!==typeof station&&($("#jukebox .albumart").attr("src",station.icon_url+station.icon),$("#artistDiv").html(station.name),$("#albumDiv").html(station.description),$("#trackDiv").html(station.url).trigger("updatelayout"),$(inactivePlayerSelector).jPlayer("setMedia",{mp3:station.url}),$(inactivePlayerSelector).jPlayer("play"),
consoleLog("Checking to see if srcSet is true or false",$(activePlayerSelector).data("jPlayer").status),$(activePlayerSelector).data("jPlayer").status.srcSet&&$(activePlayerSelector).jPlayer("stop"),tmpPlayerSelector=activePlayerSelector,activePlayerSelector=inactivePlayerSelector,inactivePlayerSelector=tmpPlayerSelector,primary_player=1==primary_player?2:1,updatePlayerDisplay(playing),$("#streamProgressDiv").css("width","100%"),$("#streamProgressDiv").css("background","rgba(0, 0, 0, .4)"),playing=
!0,post={parameters:[{station_url:station.url}]},control_mpd("add_url",post.parameters[0]))}})}function updatePlayProgressDisplay(b,a,c){$("#trackTotalDuration").html(get_timer_display(a));$("#playProgressDiv").css("width",c+"%");$("#trackPlayDuration").html(get_timer_display(b))}function updateLoadProgressDisplay(b){consoleLog("Inside updateLoadProgressDisplay - setting loadProgressDiv to ",b);$("#loadProgressDiv").css("width",b+"%")}
function getNextTrackPosition(b,a,c){consoleLog("Inside getNextTrackPosition - destination ",b);consoleLog("Inside getNextTrackPosition - currentTrackPosition ","'"+a+"'");consoleLog("Inside getNextTrackPosition - currentPlaylistLength ",c);consoleLog("Inside getNextTrackPosition - currentPlaylistLength minus 1 ",c-1);var d=a;switch(b){case "next":a==c-1?d=0:d++;break;case "previous":0==a?d=c-1:d--;break;case "beginning":d=0;break;case "same":break;default:Math.floor(b)==b&&$.isNumeric(b)&&(d=b)}return d}
function processTimeUpdate(b,a,c){1<b&&($.mobile.loading("hide"),$.mobile.loadingMessage="Loading");updatePlayProgressDisplay(b,a,c);0<a&&(0<b&&!repeat_track)&&(a-b<=max_crossfade&&0<a&&0<b&&!next_track_already_added?(next_track_already_added=!0,fade_out_current_track(),track_position=getNextTrackPosition("next",track_position,playlist.tracks.length),current_track_position=0,$(inactivePlayerSelector).jPlayer("setMedia",{mp3:playlist.tracks[track_position].url}),$(inactivePlayerSelector).jPlayer("play",
current_track_position),fade_in_next_track()):a-b<=max_crossfade&&(fade_out_current_track(),fade_in_next_track()))}
function updatePlayerDisplay(b,a){b&&"pause"==(a||"play")?($("#jukebox #playpause").attr("data-icon","play"),$("#jukebox #playpause").buttonMarkup("refresh"),$("#jukebox #playpause").removeClass("ui-icon-pause").addClass("ui-icon-play"),$("#playerCurrentlyPlayingDiv").slideUp({duration:default_easout_duration,easing:default_easout_equation,complete:function(){$("#trackProgressDiv").slideUp({duration:default_easout_duration,easing:default_easout_equation,complete:function(){}})}})):($("#jukebox #playpause").attr("data-icon",
"pause"),$("#jukebox #playpause").buttonMarkup("refresh"),$("#jukebox #playpause").removeClass("ui-icon-play").addClass("ui-icon-pause"),"none"==$("#playerCurrentlyPlayingDiv").css("display")&&$("#playerCurrentlyPlayingDiv").slideDown({duration:default_easin_duration,easing:default_easin_equation,complete:function(){$("#trackProgressDiv").slideDown({duration:default_easin_duration,easing:default_easin_equation,complete:function(){}})}}))}
function skipto(b){$.mobile.loading("hide");$.mobile.loadingMessage="Loading";initialize_timer_display();if("undefined"===typeof playlist.tracks)return!1;load_progress_complete=!1;next_track_already_added&&($(inactivePlayerSelector).data("jPlayer").status.srcSet&&$(inactivePlayerSelector).jPlayer("stop"),$(inactivePlayerSelector).jPlayer("volume",1),$(activePlayerSelector).jPlayer("volume",1));track_position=getNextTrackPosition(b,track_position,playlist.tracks.length);updateCurrentTrackInfo(playlist.tracks[track_position]);
updatePlayerDisplay(playing);$(inactivePlayerSelector).jPlayer("setMedia",{mp3:playlist.tracks[track_position].url});$(inactivePlayerSelector).jPlayer("play");consoleLog("Checking to see if srcSet is true or false",$(activePlayerSelector).data("jPlayer").status);$(activePlayerSelector).data("jPlayer").status.srcSet&&$(activePlayerSelector).jPlayer("stop");tmpPlayerSelector=activePlayerSelector;activePlayerSelector=inactivePlayerSelector;inactivePlayerSelector=tmpPlayerSelector;primary_player=1==primary_player?
2:1;shuffle_queue?(post={parameters:[{index:playlist.tracks[track_position].mpd_index}]},control_mpd("skip_to",post.parameters[0])):"next"==b?control_mpd("next"):"previous"==b?control_mpd("prev"):"beginning"!=b&&(Math.floor(b)==b&&$.isNumeric(b))&&(document.getElementById("currentalbumart"),b=document.getElementById("currentlyPlayingInfoDiv"),document.getElementById("playerCurrentlyPlayingDiv"),"undefined"!==typeof b&&(""!=b&&null!=b)&&($(".currentalbumart").attr("src",playlist.tracks[track_position].art),
$("#currentlyPlayingArtistDiv").html(playlist.tracks[track_position].artist),$("#currentlyPlayingAlbumDiv").html(playlist.tracks[track_position].album),$("#currentlyPlayingTrackDiv").html(playlist.tracks[track_position].title).trigger("updatelayout"),$("#currentlyPlayingInfoDiv").slideDown({duration:default_easin_duration,easing:default_easin_equation,complete:function(){}})),bumped_file=playlist.tracks[track_position].file,0==bumped_file.indexOf("http://")?$("#streamProgressDiv").css("width","100%"):
$("#streamProgressDiv").css("width","0px"),$("#streamProgressDiv").css("background-color","#000000"),$("#currentlyPlayingArtistDiv").css("max-width",0.6*$(window).width()),$("#currentlyPlayingAlbumDiv").css("max-width",0.6*$(window).width()),$("#currentlyPlayingTrackDiv").css("max-width",0.6*$(window).width()),post={parameters:[{index:track_position}]},control_mpd("skip_to",post.parameters[0]));playing||(playing=!0)}
function updateCurrentTrackInfo(b){consoleLog("Trying to set the info about the song being played using the track object",b);$("#currentAlbumArtImg").attr("src",b.art);$("#artistDiv").html(b.artist);var a=b.album,a=a.length>max_album_name_string_length?a.substring(0,max_album_name_string_length)+"...":a;$("#albumDiv").html(a).trigger("updatelayout");0===b.url.indexOf("http://")?$("#trackDiv").html(b.url).trigger("updatelayout"):(a=b.title,a=a.length>max_track_title_string_length?a.substring(0,max_track_title_string_length)+
"...":a,$("#trackDiv").html(a).trigger("updatelayout"));$("#playerCurrentlyPlayingDiv").css("max-width",0.9*$(window).width());0==b.file.indexOf("http://")?($("#streamProgressDiv").css("width","100%"),$("#streamProgressDiv").css("background","rgba(0, 0, 0, .4)")):$("#streamProgressDiv").css("width","0")}
function crossfadePlayers(b){b/=90;$("#"+priPlayerID).jPlayer("volume",0);$.timer(b,function(a){var b=$("#"+secPlayerID).jPlayer("getData","volume")-1;$("#"+secPlayerID).jPlayer("volume",b);1>b&&($("#"+secPlayerID).jPlayer("stop"),a.stop())});$("#"+secPlayerID+"_elements").hide();$.timer(b/2,function(a){var b=$("#"+priPlayerID).jPlayer("getData","volume")+2;$("#"+priPlayerID).jPlayer("volume",b);90<b&&a.stop()});$("#"+priPlayerID+"_elements").show()}
function consoleLog(b,a){a=a||"";"console"in window&&("log"in window.console&&debug)&&(console.log(b),""!=a&&console.log(a))};function get_mpd_playlist(b){var a;$.ajax({type:"POST",url:"/musicpd/query",async:!1,data:"query=playlist",success:function(c){a=c;b&&(a=shuffle_playlist(a))}});return a}
function shuffle_playlist(b){b=$.parseJSON(b);shuffled_playlist='{ "tracks" : [';count_of_tracks=number_of_tracks=b.tracks.length;for(i=0;i<number_of_tracks;i++){var a=Math.floor(Math.random()*count_of_tracks);shuffled_playlist=1==count_of_tracks?shuffled_playlist+JSON.stringify(b.tracks[a]):shuffled_playlist+(JSON.stringify(b.tracks[a])+", ");count_of_tracks--}return shuffled_playlist+="]}"}function unshuffle_playlist(){return unshuffled_playlist=$.parseJSON(get_mpd_playlist())};function clearQueue(){$.mobile.loading("show");track_position=0;playlist="";$("#jukebox #playpause").attr("data-icon","play");$("#jukebox #playpause").buttonMarkup("refresh");$("#playpause-span-one").attr("class","play ui-btn-inner ui-btn-corner-all");$("#playpause-span-two").attr("class","play ui-btn-text");$("#playpause-span-three").attr("class","play-inner ui-icon ui-icon-play ui-icon-shadow");shuffle_queue=!1;$("#shuffle").attr("data-theme",theme.buttons);$("#shuffle").attr("data-icon","shuffle");
$("#shuffle").removeClass($.mobile.activeBtnClass);1==primary_player?("console"in window&&"log"in window.console&&(console.log("Checking to see if playerOne's srcSet is true or false"),console.log($("#playerOne").data("jPlayer").status)),$("#playerOne").data("jPlayer").status.srcSet&&($("#playerOne").jPlayer("pause"),$("#playerOne").jPlayer("clearMedia"))):("console"in window&&"log"in window.console&&(console.log("Checking to see if playerTwo's srcSet is true or false"),console.log($("#playerTwo").data("jPlayer").status)),
$("#playerTwo").data("jPlayer").status.srcSet&&($("#playerTwo").jPlayer("pause"),$("#playerTwo").jPlayer("clearMedia")));current_track_position=0;playing=!1;paused=!0;setTimeout(function(){$("#trackProgressDiv").slideUp("slow");$("#playerCurrentlyPlayingDiv").slideUp("slow",function(){$.mobile.loading("hide")});initialize_timer_display()},1E3)}function removeQueuedTrack(b,a){$("#"+b).slideUp("slow",function(){delete playlist.tracks[a];$("#"+b).remove()})};$("body").on("pagebeforeshow","#setup",function(b,a){$("body").attr("class","ui-mobile-viewport ui-overlay-a")});$("body").on("pagebeforeshow","#edit_site_config",function(b,a){"undefined"!=typeof theme?$("body").attr("class","ui-mobile-viewport ui-overlay-"+theme.body):$("body").attr("class","ui-mobile-viewport ui-overlay-a");$("div.required-field-error").prev().css("border","2px solid #CC0000")});
$("body").on("pagebeforeshow","#error",function(b,a){"undefined"!=typeof theme?$("body").attr("class","ui-mobile-viewport ui-overlay-"+theme.body):$("body").attr("class","ui-mobile-viewport ui-overlay-a")});$("body").on("pagebeforeshow","#setup_success",function(b,a){$("body").attr("class","ui-mobile-viewport ui-overlay-a")});
$("body").on("pagebeforeshow","#login",function(b,a){$("body").attr("class","ui-mobile-viewport ui-overlay-a");$("#login_form a.ui-btn").removeClass("ui-btn-hover-g");$("div.required-field-error").prev().css("border","2px solid #CC0000")});$("body").on("pageinit","#register_form",function(b,a){Recaptcha.destroy();Recaptcha.create(recaptcha_public_key,recaptcha_widget_name,recaptcha_options);set_recaptcha_padding_and_width()});
$("body").on("pagebeforeshow","#register_form",function(b,a){$("body").attr("class","ui-mobile-viewport ui-overlay-a");$("div.required-field-error").prev().css("border","2px solid #CC0000")});$("body").on("pagehide","#register_form",function(b,a){});$("body").on("pageshow","#register_form",function(b,a){Recaptcha.destroy();Recaptcha.create(recaptcha_public_key,recaptcha_widget_name,recaptcha_options);set_recaptcha_padding_and_width();$("div.required-field-error").prev().css("border","2px solid #CC0000")});
$("body").on("pagebeforeshow","#paypal",function(b,a){$("body").attr("class","ui-mobile-viewport ui-overlay-a")});$("body").on("pagebeforeshow","#paypal_payment_cancelled",function(b,a){$("body").attr("class","ui-mobile-viewport ui-overlay-a")});$("body").on("click","#login_form a.ui-btn",function(b){$(this).addClass("ui-btn-hover-g")});$("body").on("click","#register_form a.ui-btn",function(b){$(this).addClass("ui-btn-hover-g")});$("body").on("click","#login_submit",function(b){$("#login_submit").parent().addClass("ui-btn-hover-g")});
$("body").on("click","#register_submit",function(b){$("#register_submit").parent().addClass("ui-btn-hover-g")});$("body").on("click","#paypal_submit",function(b){$("#paypal_submit").parent().addClass("ui-btn-hover-g")});$("body").on("click","#refresh_captcha",function(b){b.preventDefault();$("#refresh_captcha").parent().addClass("ui-btn-hover-g");refresh_recaptcha()});
$("body").on("click","#switch_type_audio",function(b){b.preventDefault();$("#switch_type_audio").parent().addClass("ui-btn-hover-g");setTimeout(function(){$("#switch_type_audio").parent().removeClass("ui-btn-hover-g")},500);Recaptcha.switch_type("audio")});$("body").on("click","#switch_type_image",function(b){b.preventDefault();$("#switch_type_image").parent().addClass("ui-btn-hover-g");setTimeout(function(){$("#switch_type_image").parent().removeClass("ui-btn-hover-g")},500);Recaptcha.switch_type("image")});
$("body").on("orientationchange","#register_form",function(b,a){set_recaptcha_padding_and_width()});function set_recaptcha_padding_and_width(){var b=$('div[role="dialog"]').width(),b=Math.floor(0.98*b);280<b&&(b=Math.floor((b-280)/2),$("#recaptcha_image").css("padding-left",b+"px"),$("#recaptcha_image img").css("cursor","pointer"),$("#recaptcha_image img").css("width","280px !important"),$("#recaptcha_image img:hover").css("width","280px !important"))}
function refresh_recaptcha(){$("#recaptcha_image").fadeOut(100,function(){$("#recaptcha_image").parent().append("<img style='padding-top:15px;' src='images/ajax-loader-fast.gif' />");Recaptcha.reload();set_recaptcha_padding_and_width()});setTimeout(function(){$("img:last").remove();$("#recaptcha_image").fadeIn(500);$("#register_form div.ui-btn").removeClass("ui-btn-hover-g")},2E3)}
function change_page(b,a,c,d,g,k,h,f,e){$.mobile.changePage(b||"home",{transition:a||"fade",reloadPage:c||!1,showLoadMsg:d||!1,changeHash:g||!1,type:k||"get",data:h||"",reverse:f||!1,allowSamePageTransition:e||!1})}function incremental_scroll_up(){var b=$("html,body").height();current_scroll_position=$(window).scrollTop();b=current_scroll_position-b;0>b&&(b=0);$("html,body").animate({scrollTop:b},1E3,function(){})}
function incremental_scroll_down(b){b=$("html,body").height();current_scroll_position=$(window).scrollTop();var a=0;0<current_scroll_position&&(a=current_scroll_position);a+=b;$("html,body").animate({scrollTop:a},1E3,function(){});$("#index").lazyloader("loadMore")}function attach_window_scroll_event(b){$(window).scroll(function(){window_scroll_event_just_fired||mousewheel_event_just_fired||(window_scroll_event_just_fired=!0);setTimeout(function(){window_scroll_event_just_fired=!1},1E3)})};(function(){function b(b,d){return b.section(d.get("json"),d,{block:a},null)}function a(a,b){return a.write("<li class='ui-li-has-thumb'><a href='").reference(b.get("href"),b,"h").write("' class='ui-link-inherit' data-transition='").reference(b.get("transition"),b,"h").write("'><img src='").reference(b.get("art"),b,"h").write("' class='ui-li-thumb album-art-img' /><h3 class='ui-li-heading album-name-heading'>").reference(b.get("name"),b,"h").write("</h3><span class='ui-li-count ui-btn-up-").reference(b.get("theme_buttons"),
b,"h").write(" ui-btn-corner-all'>").reference(b.get("count_bubble_value"),b,"h").write("</span><p class='ui-li-aside ui-li-desc'>").reference(b.get("total_length"),b,"h").write("</p></a></li>")}dust.register("albums",b);return b})();(function(){function b(b,d){return b.section(d.get("json"),d,{block:a},null)}function a(a,b){return a.write("<li><a href='").reference(b.get("href"),b,"h").write("' data-transition='").reference(b.get("transition"),b,"h").write("'>").reference(b.get("name"),b,"h").write("<span class='ui-li-count ui-btn-up-").reference(b.get("theme_buttons"),b,"h").write(" ui-btn-corner-all'>").reference(b.get("count_bubble_value"),b,"h").write("</span></a></li>")}dust.register("artists",b);return b})();(function(){function b(b,d){return b.section(d.get("json"),d,{block:a},null)}function a(a,b){return a.write("<li id='").reference(b.get("id"),b,"h").write("' style='position:relative;' class='ui-li-has-thumb' data-queue-track-index='").reference(b.get("playlist_index"),b,"h").write("' data-queue-track-title='").reference(b.get("title"),b,"h").write("' data-queue-track-file='").reference(b.get("file"),b,"h").write("' data-queue-track-link='").reference(b.get("symbolic_link_filename"),b,"h").write("' class='ui-li-has-thumb ui-btn ui-btn-icon-right'><a href='#queueTrackPopupMenu' data-rel=\"popup\" data-icon=\"none\" class=\"ui-link-inherit\"><img src='").reference(b.get("art"),
b,"h").write("' class='ui-li-thumb track-item-image' /><h3 class='track-title-heading ui-li-heading'>").reference(b.get("title"),b,"h").write("</h3><p class='ui-li-aside ui-li-desc'>").reference(b.get("time"),b,"h").write("</p></a><a href='' data-icon='move' class='").reference(b.get("theme_icon_class"),b,"h").write(" ui-li-link-alt ui-btn ui-btn-up-").reference(b.get("theme_buttons"),b,"h").write(" move' data-theme='").reference(b.get("theme_buttons"),b,"h").write("' title='").reference(b.get("move_tooltip"),
b,"h").write("'>").reference(b.get("move_tooltip"),b,"h").write("</a></li>")}dust.register("queue",b);return b})();(function(){function b(b,d){return b.section(d.get("json"),d,{block:a},null)}function a(a,b){return a.write("<li class='ui-li-has-thumb' data-icon='plus'><a href='' onclick='post = { \"parameters\" : [ { \"file\" : \"").reference(b.get("file"),b,"h").write("\" } ] }; control_mpd( \"add\", post.parameters[0] );' class='ui-link-inherit' title='").reference(b.get("title"),b,"h").write("'><img src='").reference(b.get("art"),b,"h").write("' class='ui-li-thumb track-item-image' /><h3 class='track-title-heading ui-li-heading'>").reference(b.get("name"),
b,"h").write("</h3><p class='ui-li-aside ui-li-desc'>").reference(b.get("length"),b,"h").write("</p></a></li>")}dust.register("tracks",b);return b})();(function(){function b(b,d){return b.section(d.get("json"),d,{block:a},null)}function a(a,b){return a.write("<li id='").reference(b.get("id"),b,"h").write("' style='position:relative;' data-theme='").reference(b.get("theme_buttons"),b,"h").write("' data-playlist-track-index='").reference(b.get("index"),b,"h").write("' data-playlist-track-file='").reference(b.get("file"),b,"h").write("' class='ui-li-has-thumb ui-btn ui-btn-icon-right'><a href='").reference(b.get("href"),b,"h").write("' data-rel='popup'><img src='").reference(b.get("art"),
b,"h").write("' class='ui-li-thumb track-item-image' /><h3 class='track-title-heading ui-li-heading'>").reference(b.get("name"),b,"h").write("</h3><p class='ui-li-aside ui-li-desc'>").reference(b.get("length"),b,"h").write("</p></a><a href='' data-icon='move' class='").reference(b.get("theme_icon_class"),b,"h").write(" ui-li-link-alt ui-btn ui-btn-up-").reference(b.get("theme_buttons"),b,"h").write(" move' data-theme='").reference(b.get("theme_buttons"),b,"h").write("' title='").reference(b.get("title"),
b,"h").write("'>").reference(b.get("title"),b,"h").write("</a></li>")}dust.register("playlistTracks",b);return b})();$("body").on("lazyloadercreate","#index",function(b){});$("body").on("lazyloaderbeforecreate","#index",function(b){});$("body").on("lazyloaderdestroy","#index",function(b){});$("body").on("lazyloaderdoneloading","#index",function(b){$.mobile.loading("hide");$.mobile.loadingMessage="Loading"});$("body").on("lazyloaderalldone","#index",function(b){$.mobile.loading("hide");$.mobile.loadingMessage="Loading"});
$("body").on("lazyloaderbusy","#index",function(b){$.mobile.loading("hide");$.mobile.loadingMessage="Loading"});$("body").on("lazyloadererror","#index",function(b){});$("body").on("lazyloaderreset","#index",function(b){});$("body").on("lazyloaderresetall","#index",function(b){});
$("body").on("pageinit","#index",function(b,a){$("#index").lazyloader();$("#index").lazyloader("reInitialize",{},{clearUrl:"/session/clear"},{});$.mobile.lazyloader.prototype.timeoutOptions.mousewheel=300;$.mobile.lazyloader.prototype.timeoutOptions.scrollstart=700;$.mobile.lazyloader.prototype.timeoutOptions.scrollstop=100;$.mobile.lazyloader.prototype.timeoutOptions.showprogress=100;$("body").enableSelection()});$("body").on("pageinit","#genres",function(b,a){});
$("body").on("pageinit","#queue",function(b,a){threshold=$(window).height();var c={threshold:threshold,retrieve:20,retrieved:20,bubbles:!0,offset:playlist_index_offset},d={retrieve:c.retrieve,retrieved:c.retrieved,offset:c.offset};$("#index").lazyloader("reInitialize",c,{pageId:"queue",templateType:"dust",templateId:"queue",templatePrecompiled:!0,mainId:"queueTracksList",progressDivId:"lazyloaderProgressDiv",moreUrl:"/queue/more",clearUrl:"/session/clear",JSONP:!1,JSONPCallback:"callback"},d);$("#queueTracksList").sortable({disabled:!1,
axis:"y",containment:"parent",distance:1,opacity:0.7,scroll:!0,scrollSensitivity:160,scrollSpeed:30,revert:!0,placeholder:"ui-state-highlight-sortable",items:"li",handle:"a.move",delay:800});$("body").disableSelection()});
$("body").on("pageinit","#artists",function(b,a){$("#index").lazyloader("reset","albums");threshold=$(window).height();var c={threshold:threshold,retrieve:20,retrieved:20,bubbles:!0,offset:0},d={retrieve:c.retrieve,retrieved:c.retrieved,offset:c.offset};$("#index").lazyloader("reInitialize",c,{pageId:"artists",templateType:"dust",templateId:"artists",templatePrecompiled:!0,mainId:"artistsList",progressDivId:"lazyloaderProgressDiv",moreUrl:"/artists/more",clearUrl:"/session/clear"},d)});
$("body").on("pageinit","#save_playlist",function(b,a){$("body").enableSelection();$("#index").lazyloader("reset","queue")});
$("body").on("pageinit","#albums",function(b,a){threshold=$(window).height();var c={threshold:threshold,retrieve:20,retrieved:20,bubbles:!0},d={retrieve:c.retrieve,retrieved:c.retrieved,offset:c.offset};$("#index").lazyloader("reInitialize",c,{pageId:"albums",templateType:"dust",templateId:"albums",templatePrecompiled:!0,mainId:"albumsList",progressDivId:"lazyloaderProgressDiv",moreUrl:"/albums/more",clearUrl:"/session/clear"},d)});
$("body").on("pageinit","#playlists",function(b,a){$("#index").lazyloader("reset","playlistTracksPage");$("body").enableSelection()});
$("body").on("pageinit","#playlistTracksPage",function(b,a){threshold=$(window).height();var c={threshold:threshold,retrieve:50,retrieved:50,bubbles:!0,offset:0},d={retrieve:c.retrieve,retrieved:c.retrieved,offset:c.offset};$("#index").lazyloader("reInitialize",c,{pageId:"playlistTracksPage",templateType:"dust",templateId:"playlistTracks",templatePrecompiled:!0,mainId:"playlistTracks",progressDivId:"lazyloaderProgressDiv",moreUrl:"/playlist/tracks/more",clearUrl:"/session/clear"},d);$("#playlistTracks").sortable({disabled:!1,
axis:"y",containment:"parent",distance:1,opacity:0.7,scroll:!0,scrollSensitivity:160,scrollSpeed:30,revert:!0,placeholder:"ui-state-highlight-sortable",items:"li",handle:"a.move",delay:800});$("body").disableSelection()});$("body").on("pageinit","#settings",function(b,a){$("#settings").on("change","#theme_id",function(a,b){"0"==$("#theme_id :selected").val()&&$.mobile.changePage("/settings/custom/theme",{allowSamePageTransition:!0,transition:"slideup",reloadPage:!1,showLoadMsg:!0,changeHash:!1})})});
$("body").on("pagebeforeshow","#music_uploader",function(b,a){$("div.plupload_header").addClass("ui-bar-"+theme.bars).attr("role","banner")});
$("body").on("pageinit","#music_uploader",function(b,a){$(function(){$("#uploader").pluploadQueue({runtimes:"html5",url:"/upload/music",max_file_size:"128mb",unique_names:!0,multiple_queues:!0,resize:{width:320,height:240,quality:90},filters:[{title:"MP3 files",extensions:"mp3"},{title:"OGG files",extensions:"ogg"}],init:{Refresh:function(a){},StateChanged:function(a){a.state==plupload.STOPPED&&control_mpd("update")},QueueChanged:function(a){},UploadProgress:function(a,b){},FilesAdded:function(a,
b){},FilesRemoved:function(a,b){},FileUploaded:function(a,b,g){},ChunkUploaded:function(a,b,g){},Error:function(a,b){}}});$("form").submit(function(a){var b=$("#uploader").pluploadQueue();0<b.files.length?(b.bind("StateChanged",function(){b.files.length===b.total.uploaded+b.total.failed&&$("form")[0].submit()}),b.start()):alert("You must queue at least one file.");return!1})})});$("body").on("pageshow","#register_form",function(b,a){});
$("body").on("pageshow","#index",function(b,a){$("body").attr("class","ui-mobile-viewport ui-overlay-"+theme.body);$("#playerCurrentlyPlayingDiv").css("max-width",0.9*$(window).width()).trigger("updatelayout");"undefined"!=typeof a.prevPage[0]&&"settings"!=a.prevPage[0].id&&("apply_settings"!=a.prevPage[0].id&&"music_uploader"!=a.prevPage[0].id)&&($.mobile.loading("hide"),current_playlist=$.trim(get_mpd_playlist(shuffle_queue)),playlist=""!=current_playlist?$.parseJSON(current_playlist):"");$("body").enableSelection();
$("#index").lazyloader("resetAll")});$("body").on("pageshow","#artists",function(b,a){$.mobile.loading("hide")});$("body").on("pageshow","#genres",function(b,a){$("#index").lazyloader("reset","artists");$.mobile.loading("hide")});$("body").on("pageshow","#playlists",function(b,a){$.mobile.loading("hide")});$("body").on("pageshow","#stations",function(b,a){$.mobile.loading("hide")});
$("body").on("pageshow","#queue",function(b,a){$.mobile.loading("hide");$("#currentlyPlayingArtistDiv").css("max-width",0.6*$(window).width());$("#currentlyPlayingAlbumDiv").css("max-width",0.6*$(window).width());$("#currentlyPlayingTrackDiv").css("max-width",0.6*$(window).width())});$("body").on("pageshow","#admin",function(b,a){$.mobile.loading("hide");"undefined"!=typeof a.prevPage[0]&&$.mobile.loading("hide");$.mobile.activeBtnClass="ui-btn-hover-"+theme.active});
$("body").on("pageshow","#setup",function(b,a){$.mobile.loading("hide");$("body").attr("class","ui-mobile-viewport ui-overlay-"+theme.body);$.mobile.activeBtnClass="ui-btn-hover-"+theme.active});$("body").on("pageshow","#music_uploader",function(b,a){$('*[data-role="button"]').each(function(a){$(this).attr("data-theme",theme.buttons).removeClass("ui-btn-up-"+theme.buttons).addClass("ui-btn-up-"+theme.buttons)})});
$("body").on("pageshow","#save_playlist",function(b,a){$("div.required-field-error").prev().css("border","2px solid #CC0000");if("undefined"!=typeof a.prevPage[0]&&"save_playlist"==a.prevPage[0].id){var c=!0;$("div.required-field-error").each(function(a){c=!1});c&&($.mobile.loadingMessage="Please wait",$.mobile.loading("show"),goBackTimer=setTimeout(function(){$.mobile.loading("hide");$.mobile.loadingMessage="Please wait";history.go(-1)},1E3))}});
$("body").on("pageshow","#admin_payments",function(b,a){$("div.required-field-error").prev().css("border","2px solid #CC0000");"undefined"!=typeof a.prevPage[0]&&"admin_payments"==a.prevPage[0].id&&window.scrollTo(0,1)});$("body").on("pageshow","#edit_site_config",function(b,a){$("div.required-field-error").prev().css("border","2px solid #CC0000");"undefined"!=typeof a.prevPage[0]&&"edit_site_config"==a.prevPage[0].id&&window.scrollTo(0,1)});
$("body").on("pageshow","#edit_user_config",function(b,a){$("div.required-field-error").prev().css("border","2px solid #CC0000");"undefined"!=typeof a.prevPage[0]&&"edit_user_config"==a.prevPage[0].id&&window.scrollTo(0,1)});$("body").on("pageshow","#playlists",function(b,a){});
$("body").on("pageshow","#account",function(b,a){$.mobile.activeBtnClass="ui-btn-hover-"+theme.active;$("div.required-field-error").prev().css("border","2px solid #CC0000");"undefined"!=typeof a.prevPage[0]&&"account"==a.prevPage[0].id&&window.scrollTo(0,1)});
$.widget("blueimp.fileupload",$.blueimp.fileupload,{options:{acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,processQueue:{action:"validate",acceptFileTypes:"@",disabled:"@disableValidation"}},processActions:{validate:function(b,a){if(a.disabled)return b;var c=$.Deferred(),d=b.files[b.index];a.acceptFileTypes.test(d.type)?c.resolveWith(this,[b]):(d.error="Invalid file type.",c.rejectWith(this,[b]));return c.promise()}}});
$("body").on("pageshow","#station",function(b,a){$("#station_image_file").fileupload({url:"/upload/station/icon",replaceFileInput:!1,sequentialUploads:!0,dataType:"json",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:5242880,add:function(a,b){var g=[];$("#station_image_file_div").children().removeClass("required-field");$("#station_image_file_div").closest(".station-field-divs").height(80).find("div.required-field-error").remove();consoleLog("The file being uploaded is as follows",b.originalFiles);
/^image\/(gif|jpe?g|png)$/i.test(b.originalFiles[0].type)||g.push("The selected file is not an allowed type");5242880<b.originalFiles[0].size&&g.push("The selected file is larger than 5MB");if(0<g.length){$("#station_image_file_div").children().addClass("required-field");var k='<div class="error-message-divs">'+g.join('</div><div class="error-message-divs">')+"</div>";extraHeight=20*g.length;currentHeight=$("#station_image_file_div").closest(".station-field-divs").height();$("#station_image_file_div").closest(".station-field-divs").height(currentHeight+
extraHeight).append('<div class="required-field-error">'+k+"</div>")}else b.submit()},start:function(a){$.mobile.loadingMessage="Uploading image";$.mobile.loading("show");consoleLog("File upload started")},progress:function(a,b){var g=parseInt(100*(b.loaded/b.total),10);$.mobile.loadingMessage=g+"%";consoleLog(g)},done:function(a,b){consoleLog("File upload complete");consoleLog("e",a);consoleLog("data",b);consoleLog("Setting the uploaded_image element src to: /"+b.result.baseurl+b.result.filename);
$("#uploaded_image").attr("src","/"+b.result.baseurl+b.result.filename);$("#station_icon_id").val(b.result.id);$.mobile.loading("hide");$.mobile.loadingMessage="Loading"},fail:function(a,b){consoleLog("File upload failed");$.mobile.loading("hide");$.mobile.loadingMessage="Loading"}});$("div.required-field-error").prev().css("border","2px solid #CC0000");$("#saved_successfully").removeClass("success-top-padding");"undefined"!=typeof a.prevPage[0]&&"station"==a.prevPage[0].id&&window.scrollTo(0,1)});
$("body").on("pageshow","#login",function(b,a){});$("body").on("pagehide","#create_new_theme",function(b,a){0==$("#theme_id option:selected").val()&&($("#theme_id option:selected").val("1"),$("#theme_id").selectmenu("refresh",!0))});$("body").on("pagebeforeshow","#index",function(b,a){});$("body").on("pagebeforeshow","#station",function(b,a){});
$("body").on("pagebeforeshow","#queue",function(b,a){$("#currentlyPlayingArtistDiv").css("max-width",0.6*$(window).width());$("#currentlyPlayingAlbumDiv").css("max-width",0.6*$(window).width());$("#currentlyPlayingTrackDiv").css("max-width",0.6*$(window).width())});$("body").on("pagebeforeshow","#account",function(b,a){$("body").attr("class","ui-mobile-viewport ui-overlay-"+theme.body);$.mobile.activeBtnClass="ui-btn-hover-"+theme.active});
$("body").on("pagebeforeshow","#admin",function(b,a){$("body").attr("class","ui-mobile-viewport ui-overlay-"+theme.body)});$("body").on("pagebeforechange","#artists",function(b,a){});$("body").on("pagebeforechange","#albums",function(b,a){});$("body").on("pagebeforechange","#tracks",function(b,a){});
$("body").on("change","#volume_control",function(){just_swiped_right=just_swiped_left=!0;waiting_to_adjust_volume||(waiting_to_adjust_volume=!0,setTimeout(function(){new_volume=$("#volume_control").val();post={parameters:[{volume:new_volume}]};control_mpd("set_volume",post.parameters[0]);just_swiped_right=just_swiped_left=waiting_to_adjust_volume=!1},1E3))});
$("body").on("change","#xfade_control",function(){just_swiped_right=just_swiped_left=!0;waiting_to_adjust_xfade||(waiting_to_adjust_xfade=!0,setTimeout(function(){new_xfade_value=$("#xfade_control").val();post={parameters:[{crossfade:new_xfade_value}]};control_mpd("set_crossfade",post.parameters[0]);just_swiped_right=just_swiped_left=waiting_to_adjust_xfade=!1},500))});
$("body").on("change","#volume_fade_control",function(){just_swiped_right=just_swiped_left=!0;waiting_to_adjust_volume_fade||(waiting_to_adjust_volume_fade=!0,setTimeout(function(){new_volume_fade_value=$("#volume_fade_control").val();just_swiped_right=just_swiped_left=waiting_to_adjust_volume_fade=!1},500))});$("body").on("change","#operating_mode",function(b,a){mode="Streaming"==$("#operating_mode :selected").text()?"streaming":"localplay"});
$("body").on("change","#station_visibility",function(b,a){var c="on"==$("#station_visibility").prop("value")?"off":"on";$("#station_visibility").prop("value",c).checkboxradio("refresh")});$("body").on("change","#user_account_active",function(b,a){var c="on"==$("#user_account_active").prop("value")?"off":"on";$("#user_account_active").prop("value",c).checkboxradio("refresh")});
$("body").on("change","#paypal_sandbox_mode",function(b,a){var c="on"==$("#paypal_sandbox_mode").prop("value")?"off":"on";$("#paypal_sandbox_mode").prop("value",c).checkboxradio("refresh")});
$("body").on("click","#playpause",function(b){b.preventDefault();$.mobile.loading("hide");$.mobile.loadingMessage="Loading";playing?(updatePlayerDisplay(playing,"pause"),next_track_already_added&&($(inactivePlayerSelector).data("jPlayer").status.srcSet&&$(inactivePlayerSelector).jPlayer("stop"),$(inactivePlayerSelector).jPlayer("volume",1),$(activePlayerSelector).jPlayer("volume",1)),$(activePlayerSelector).jPlayer("pause"),control_mpd("pause"),playing=!1,paused=!0):skipto("same")});
$("body").on("click","#next",function(b){b.preventDefault();skipto("next");return!1});$("body").on("click","#prev",function(b){b.preventDefault();skipto("previous");return!1});
$("body").on("click","#repeat",function(b){repeat_track?($.mobile.loading("show",theme.bars,"Repeat Off",!0),setTimeout(function(){$.mobile.loading("hide")},3E3),repeat_track=!1,$("#repeat").removeClass("ui-btn-"+theme.action).removeClass("ui-btn-up-"+theme.action).removeClass("ui-btn-hover-"+theme.action).attr("data-theme",theme.buttons).attr("data-icon","repeat").addClass("ui-btn-"+theme.buttons).addClass("ui-btn-up-"+theme.buttons),post={parameters:[{repeat:"0"}]}):($.mobile.loading("show",theme.bars,
"Repeat On",!0),setTimeout(function(){$.mobile.loading("hide")},3E3),repeat_track=!0,$("#repeat").removeClass("ui-btn-"+theme.buttons).removeClass("ui-btn-up-"+theme.buttons).removeClass("ui-btn-hover-"+theme.buttons).attr("data-theme",theme.action).attr("data-icon","repeat").addClass("ui-btn-"+theme.action).addClass("ui-btn-up-"+theme.action),post={parameters:[{repeat:"1"}]});control_mpd("repeat",post.parameters[0]);$(activePlayerSelector).jPlayer("loop",repeat_track)});
$("body").on("click","#shuffle",function(b){"undefined"!==typeof playlist.tracks?0<playlist.tracks.length?shuffle_queue?($.mobile.loading("show",theme.bars,"Unshuffling the playlist",!0),shuffle_queue=!1,$("#shuffle").removeClass("ui-btn-"+theme.action).removeClass("ui-btn-up-"+theme.action).removeClass("ui-btn-hover-"+theme.action).attr("data-theme",theme.buttons).attr("data-icon","shuffle").addClass("ui-btn-"+theme.buttons).addClass("ui-btn-up-"+theme.buttons),track_position=playlist.tracks[track_position].mpd_index,
playlist=unshuffle_playlist()):($.mobile.loading("show",theme.bars,"Shuffling the playlist",!0),shuffle_queue=!0,$("#shuffle").removeClass("ui-btn-"+theme.buttons).removeClass("ui-btn-up-"+theme.buttons).removeClass("ui-btn-hover-"+theme.buttons).attr("data-theme",theme.action).attr("data-icon","shuffle").addClass("ui-btn-"+theme.action).addClass("ui-btn-up-"+theme.action),playlist=$.parseJSON(shuffle_playlist(JSON.stringify(playlist)))):$.mobile.loading("show",theme.bars,"Nothing to shuffle",!0):
$.mobile.loading("show",theme.bars,"Nothing to shuffle",!0);setTimeout(function(){$.mobile.loading("hide")},2E3)});
$("body").on("click","#confirm_delete_yes",function(){var b=$("#item_type").val(),a=$("#item_name").val();"playlist"==b?(post={parameters:[{playlist_name:a}]},control_mpd("delete_playlist",post.parameters[0]),history.go(-2)):"station"==b?(b=$("#item_id").val(),$.mobile.loadingMessage="Deleting Station",$.mobile.loading("show"),$.ajax({type:"POST",url:"/stations/delete",async:!0,data:"station_id="+b,success:function(a){$.mobile.loading("hide");$.mobile.loadingMessage="Loading";history.go(-2)}})):"user"==
b&&(b=$("#item_id").val(),$.mobile.loadingMessage="Deleting User Account",$.mobile.loading("show"),$.ajax({type:"POST",url:"/user/"+b+"/delete",async:!0,data:"user_id="+b,success:function(a){$.mobile.loading("hide");$.mobile.loadingMessage="Loading";history.go(-2)}}))});$("body").on("click","#confirm_delete_no",function(){$(".ui-dialog").dialog("close")});
$("body").on("click","#apply_settings_yes",function(){setTimeout(function(){$.mobile.loadingMessage="Please wait";$.mobile.loading("show");setTimeout(function(){location.reload(!0)},500)},2E3)});$("body").on("click","#apply_settings_no",function(){});
$("body").on("click","#create_theme_save",function(b,a){b.preventDefault();var c=$("#theme_name").val(),d=$("#icon_color").val(),g=$("#bars_letter_code").val(),k=$("#buttons_letter_code").val(),h=$("#body_letter_code").val(),f=$("#controls_letter_code").val(),e=$("#action_letter_code").val(),q=$("#active_state_letter_code").val();"undefined"!=typeof c&&""!=c?($.mobile.loadingMessage="Saving Theme",$.mobile.loading("show"),$.ajax({type:"POST",url:"/settings/create/theme",async:!0,data:"theme_name="+
c+"&icon_color="+d+"&bars_letter_code="+g+"&buttons_letter_code="+k+"&body_letter_code="+h+"&controls_letter_code="+f+"&action_letter_code="+e+"&active_state_letter_code="+q,success:function(a){$.mobile.loading("hide");$.mobile.loadingMessage="Loading";history.go(-1)}})):$("#theme_name").css("border","2px solid #CC0000")});
$("body").on("click","#close_station",function(b,a){b.preventDefault();var c=0,d;for(d in $.mobile.urlHistory.stack)0<$.mobile.urlHistory.stack[d].url.indexOf("stations#&ui-state=dialog")&&(c+=1);window.history.go(-1*(c+1))});$("body").on("click","#close_database",function(b,a){b.preventDefault();var c=0,d;for(d in $.mobile.urlHistory.stack)0<$.mobile.urlHistory.stack[d].url.indexOf("setup/database")&&(c+=1);window.history.go(-1*c)});
$("body").on("click","#close_payments",function(b,a){b.preventDefault();var c=0,d;for(d in $.mobile.urlHistory.stack)0<$.mobile.urlHistory.stack[d].url.indexOf("admin/payments")&&(c+=1);window.history.go(-1*c)});$("body").on("click","#close_user",function(b,a){b.preventDefault();var c=0,d;for(d in $.mobile.urlHistory.stack)0<$.mobile.urlHistory.stack[d].url.indexOf("edit/user")&&(c+=1);window.history.go(-1*c)});
$(window).on("orientationchange",function(b){setTimeout(function(){$("#playerCurrentlyPlayingDiv").css("max-width",0.9*$(window).width());$("#playerCurrentlyPlayingDiv").width(0.9*$(window).width())},400)});
$("body").on("click","#volume_crossfade_form_save",function(b,a){b.preventDefault();var c=$("#is_admin_user").val(),d=$("#volume_control").val(),g=$("#xfade_control").val(),k=$("#volume_fade_control").val();"undefined"!=typeof d&&""!=d||!c||(d=5);if("undefined"==typeof g||""==g)g=5;if("undefined"==typeof k||""==k)k=5;$.mobile.loadingMessage="Saving Settings";$.mobile.loading("show");$.ajax({type:"POST",url:"/settings/save/volume",async:!0,data:"volume="+d+"&crossfade="+g+"&volume_fade="+k,success:function(a){saved=
$.parseJSON(a);$.mobile.loading("hide");$.mobile.loadingMessage="Loading";$("#volume_crossfade").dialog("close")}})});$("body").on("click","#settingsPopupMenu ul li #volume_crossfade_button",function(b,a){$.mobile.changePage("/settings/volume",{allowSamePageTransition:!0,transition:"pop",reloadPage:!1,showLoadMsg:!1,changeHash:!0})});
$("body").on("click",'#settingsPopupMenu ul div[data-role="collapsible-set"] div[data-role="collapsible"] ul li a',function(b,a){var c=b.target.getAttribute("data-id"),d=b.target.getAttribute("data-item-id");b.target.getAttribute("data-item-name");"changeLanguage"==c?"undefined"!=typeof d&&($.mobile.loadingMessage="Setting Language",$.mobile.loading("show"),c=$("#currently_selected_theme_id").val(),$.ajax({type:"POST",url:"/settings/save/language",async:!0,data:"language_id="+d+"&theme_id="+c,success:function(a){saved=
$.parseJSON(a);$("ul#availableLanguages li").find("a.ui-icon-check").removeClass("ui-icon-check").addClass("ui-icon-minus");$('ul#availableLanguages li a[data-item-id="'+d+'"]').removeClass("ui-icon-minus").addClass("ui-icon-check").closest("li").attr("data-icon","check");$.mobile.loading("hide");$.mobile.loadingMessage="Loading";$.mobile.changePage("/settings/apply",{allowSamePageTransition:!0,transition:"pop",reloadPage:!1,showLoadMsg:!1,changeHash:!0})}})):"changeTheme"==c&&("0"==d?$.mobile.changePage("/settings/custom/theme",
{allowSamePageTransition:!0,transition:"pop",reloadPage:!1,showLoadMsg:!1,changeHash:!0}):"undefined"!=typeof d&&($.mobile.loadingMessage="Applying Theme",$.mobile.loading("show"),c=$("#currently_selected_language_id").val(),$.ajax({type:"POST",url:"/settings/save/theme",async:!0,data:"theme_id="+d+"&language_id="+c,success:function(a){saved=$.parseJSON(a);var b,c,f,e;b=theme.body;c=theme.bars;f=theme.buttons;a=theme.controls;e=theme.actions;theme.body=saved.body;theme.bars=saved.bars;theme.buttons=
saved.buttons;theme.controls=saved.controls;theme.actions=saved.actions;theme.active=saved.active;$.mobile.loadingMessageTheme=theme.bars;$("#prev").attr("data-theme",theme.controls).removeClass("ui-btn-"+f).removeClass("ui-btn-"+a).addClass("ui-btn-"+theme.controls);$("#playpause").attr("data-theme",theme.controls).removeClass("ui-btn-"+f).removeClass("ui-btn-"+a).addClass("ui-btn-"+theme.controls);$("#next").attr("data-theme",theme.controls).removeClass("ui-btn-"+f).removeClass("ui-btn-"+a).addClass("ui-btn-"+
theme.controls);$('div[data-role="page"]').each(function(a){$(this).attr("data-theme",theme.buttons);$(this).attr("data-divider-theme",theme.bars)});$('div[data-role="popup"]').each(function(a){$(this).attr("data-theme",theme.body).attr("data-overlay-theme",theme.body).removeClass("ui-body-"+b).addClass("ui-body-"+theme.body)});$('div[data-role="collapsible-set"]').each(function(a){$(this).attr("data-theme",theme.actions).removeClass("ui-group-theme-"+e).addClass("ui-group-theme-"+theme.actions)});
$('div[data-role="header"]').each(function(a){$(this).attr("data-theme",theme.buttons).attr("data-divider-theme",theme.bars).removeClass("ui-bar-"+c).addClass("ui-bar-"+theme.bars)});$('div[data-role="content"]').each(function(a){$(this).attr("data-theme",theme.buttons).attr("data-divider-theme",theme.bars)});$('div[data-role="footer"]').each(function(a){$(this).attr("data-theme",theme.buttons).attr("data-divider-theme",theme.bars).removeClass("ui-bar-"+c).addClass("ui-bar-"+theme.bars)});$('*[data-role="button"]').each(function(a){$(this).attr("data-theme",
theme.buttons).removeClass("ui-btn-"+f).addClass("ui-btn-"+theme.buttons)});$("#index").removeClass("ui-page-theme-"+b).addClass("ui-page-theme-"+theme.body);$("#libraryNav").attr("data-theme",theme.buttons).attr("data-divider-theme",theme.buttons);$("#libraryNav").removeClass("ui-group-theme-"+f).addClass("ui-group-theme-"+theme.buttons);$('#libraryNav li[data-role="list-divider"]').removeClass("ui-btn-"+f).removeClass("ui-btn-"+c).removeClass("ui-bar-"+c).addClass("ui-bar-"+theme.bars);$("#adminNav").attr("data-theme",
theme.buttons).attr("data-divider-theme",theme.buttons);$("#adminNav").removeClass("ui-group-theme-"+f).addClass("ui-group-theme-"+theme.buttons);$('#adminNav li[data-role="list-divider"]').removeClass("ui-btn-"+f).removeClass("ui-btn-"+c).removeClass("ui-bar-"+c).addClass("ui-bar-"+theme.bars);$("#settingsPopupMenu-screen").removeClass("ui-overlay-"+b).addClass("ui-overlay-"+theme.body);$('div[data-role="collapsible"] h2 a').each(function(a){$(this).removeClass("ui-btn-"+e).addClass("ui-btn-"+theme.actions)});
$('div[data-role="collapsible"] div.ui-collapsible-content').removeClass("ui-body-"+e).addClass("ui-body-"+theme.actions);$("#settingsPopupMenu ul").not('div[data-role="collapsible"] ul').each(function(a){$(this).attr("data-theme",theme.buttons).attr("data-divider-theme",theme.bars).removeClass("ui-group-theme-"+f).addClass("ui-group-theme-"+theme.buttons)});$('div[data-role="collapsible"] div.ui-collapsible-content ul').attr("data-theme",theme.actions).removeClass("ui-group-theme-"+e).removeClass("ui-group-theme-"+
f).addClass("ui-group-theme-"+theme.actions);$("ul#availableThemes li").find("a.ui-icon-check").removeClass("ui-icon-check").addClass("ui-icon-minus");$('ul#availableThemes li a[data-item-id="'+d+'"]').removeClass("ui-icon-minus").addClass("ui-icon-check").closest("li").attr("data-icon","check");$.mobile.loading("hide");$.mobile.loadingMessage="Loading"}})))});
$("body").on("popupafterclose","#settingsPopupMenu",function(b,a){$("#settings_button").removeClass("ui-btn-hover-"+theme.actions).addClass("ui-btn-up-"+theme.buttons);$("#settingsPopupMenu .ui-collapsible").each(function(a){$(this).trigger("collapse")})});$("body").on("sortstart","#queueTracksList",function(b,a){fromIndexOfItemBeingSorted=$(b.target).children().index(a.item[0])-1;$(b.target).children().eq(fromIndexOfItemBeingSorted);$("#queueTracksList").listview("refresh")});
$("body").on("sortupdate","#queueTracksList",function(b,a){toIndexOfItemBeingSorted=$(b.target).children().index(a.item[0])-1;movedTrack=playlist.tracks[fromIndexOfItemBeingSorted];var c=$("#queueTrack_"+fromIndexOfItemBeingSorted);movedTrack.mpd_index=toIndexOfItemBeingSorted.toString();delete playlist.tracks[fromIndexOfItemBeingSorted];if(fromIndexOfItemBeingSorted<toIndexOfItemBeingSorted)playlist.tracks=$.map(playlist.tracks,function(a){if("undefined"!=typeof a){if(parseInt(a.mpd_index)>fromIndexOfItemBeingSorted&&
parseInt(a.mpd_index)<=toIndexOfItemBeingSorted){var b=a.mpd_index,c=(parseInt(a.mpd_index)-1).toString();a.mpd_index=c;$("#queueTrack_"+b).attr("data-queue-track-index",c).attr("id","queueTrack_"+c)}return a}return null});else if(fromIndexOfItemBeingSorted>toIndexOfItemBeingSorted){for(i=playlist.tracks.length-1;0<=i;i--)if("undefined"!=typeof playlist.tracks[i]&&parseInt(playlist.tracks[i].mpd_index)>=toIndexOfItemBeingSorted&&parseInt(playlist.tracks[i].mpd_index)<fromIndexOfItemBeingSorted){var d=
playlist.tracks[i].mpd_index,g=(parseInt(playlist.tracks[i].mpd_index)+1).toString();$("#queueTrack_"+d).attr("data-queue-track-index",g).attr("id","queueTrack_"+g)}playlist.tracks=$.map(playlist.tracks,function(a){return"undefined"!=typeof a?(parseInt(a.mpd_index)>=toIndexOfItemBeingSorted&&parseInt(a.mpd_index)<fromIndexOfItemBeingSorted&&(console.log(parseInt(a.mpd_index)+" >= "+toIndexOfItemBeingSorted+" && "+parseInt(a.mpd_index)+" < "+fromIndexOfItemBeingSorted),a.mpd_index=(parseInt(a.mpd_index)+
1).toString()),a):null})}c.attr("data-queue-track-index",toIndexOfItemBeingSorted).attr("id","queueTrack_"+toIndexOfItemBeingSorted);playlist.tracks.splice(toIndexOfItemBeingSorted,0,movedTrack);post={parameters:[{from_pos:fromIndexOfItemBeingSorted,to_pos:toIndexOfItemBeingSorted}]};control_mpd("move_track",post.parameters[0]);a.item[0].dataset.queueTrackIndex=toIndexOfItemBeingSorted});
$("body").on("sortstop","#queueTracksList",function(b,a){$(a.item[0]).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons);$("#queueTracksList").listview("refresh")});
$("body").on("click","#queue #queueTracksList li",function(b,a){var c=$(b.target).closest("li"),d=c.attr("data-queue-track-index"),g=c.attr("data-queue-track-file"),k=c.attr("data-queue-track-link"),c=c.attr("id");idOfQueueTrackJustClicked="queueTrack_"+d;var h=$("#"+this.id),h=$("#queueTracksList li").index(h)-1;options={corners:!0,shadow:!0,history:!1,positionTo:this,transition:"pop"};$("#queueTrackPopupMenu").popup("open",options);$('#queueTrackPopupMenu a[data-id="playQueueTrack"]').attr("data-queue-track-index",
d).attr("data-queue-track-true-index",h).attr("data-queue-track-file",g).attr("data-queue-track-link",k);$('#queueTrackPopupMenu a[data-id="removeFromQueue"]').attr("data-queue-track-index",d).attr("data-queue-track-true-index",h).attr("data-source-id",c)});
$("body").on("click",'#queueTrackPopupMenu ul li a[data-id="playQueueTrack"]',function(b){var a=b.target.getAttribute("data-queue-track-index");$(b.target).children().index(this);b.target.getAttribute("data-queue-track-true-index");$("#queueTrack_"+a).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons);$("#queueTrackPopupMenu").one("popupafterclose",function(b){skipto(a);$("html,body").animate({scrollTop:0},1200,function(){change_page("home",$.mobile.defaultPageTransition,
!1,!1,!0,null,null,!0,!1)})});$("#queueTrackPopupMenu").popup("close")});
$("body").on("click",'#queueTrackPopupMenu ul li a[data-id="removeFromQueue"]',function(b,a){var c=b.target.getAttribute("data-queue-track-index");$(b.target).children().index(this);var d=b.target.getAttribute("data-queue-track-true-index");$("#queueTrack_"+c).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons);var g=b.target.getAttribute("data-source-id");$("#queueTrackPopupMenu").one("popupafterclose",function(a){post={parameters:[{index:d,id:g}]};control_mpd("remove",
post.parameters[0])});$("#queueTrackPopupMenu").popup("close")});$("body").on("popupafterclose","#queueTrackPopupMenu",function(b,a){""!==idOfQueueTrackJustClicked&&$("#"+idOfQueueTrackJustClicked).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons)});$("body").on("sortstart","#playlistTracks",function(b,a){fromIndexOfItemBeingSorted=$(b.target).children().index(a.item[0])-1;$(b.target).children().eq(fromIndexOfItemBeingSorted);$("#playlistTracks").listview("refresh")});
$("body").on("sortupdate","#playlistTracks",function(b,a){var c=a.item.context.parentElement.dataset.playlistName;toIndexOfItemBeingSorted=$(b.target).children().index(a.item[0])-1;post={parameters:[{playlist_name:c,from_pos:fromIndexOfItemBeingSorted,to_pos:toIndexOfItemBeingSorted}]};control_mpd("track_move",post.parameters[0]);a.item[0].dataset.playlistTrackIndex=toIndexOfItemBeingSorted});
$("body").on("sortstop","#playlistTracks",function(b,a){$(a.item[0]).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons);$("#playlistTracks").listview("refresh")});
$("body").on("click","#playlistTracksPage #playlistTracks li",function(b,a){var c=$(b.target).closest("li"),d=c.attr("data-playlist-track-index"),g=c.attr("data-playlist-track-file"),c=c.attr("id");idOfPlaylistTrackJustClicked="playlistTrack_"+d;var k=$("#"+this.id),k=$("#playlistTracks li").index(k)-1;options={corners:!0,shadow:!0,history:!1,positionTo:this,transition:"pop"};$("#playlistTrackPopupMenu").popup("open",options);$('#playlistTrackPopupMenu a[data-id="addTrackToQueue"]').attr("data-playlist-track-index",
d).attr("data-playlist-track-file",g);$('#playlistTrackPopupMenu a[data-id="removeFromPlaylist"]').attr("data-playlist-track-index",d).attr("data-playlist-track-true-index",k).attr("data-source-id",c)});$("body").on("click","#settings_button",function(b,a){options={corners:!0,shadow:!0,history:!1,positionTo:this,transition:"slidedown"};$("#settingsPopupMenu").popup("open",options)});
$("body").on("click",'#playlistTrackPopupMenu ul li a[data-id="addTrackToQueue"]',function(b){var a=b.target.getAttribute("data-playlist-track-index");$(b.target).children().index(this);b=b.target.getAttribute("data-playlist-track-file");$("#playlistTrack_"+a).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons);post={parameters:[{file:b}]};control_mpd("add",post.parameters[0]);$("#playlistTrackPopupMenu").popup("close")});
$("body").on("click",'#playlistTrackPopupMenu ul li a[data-id="removeFromPlaylist"]',function(b,a){var c=b.target.getAttribute("data-playlist-track-index");$(b.target).children().index(this);var d=b.target.getAttribute("data-playlist-track-true-index");$("#playlistTrack_"+c).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons);var g=b.target.getAttribute("data-source-id");$("#playlistTrackPopupMenu").popup("close");$("#"+g).slideUp("slow",function(){post={parameters:[{playlist_name:$("#playlistTracks").attr("data-playlist-name"),
pos:d}]};control_mpd("track_remove",post.parameters[0]);$("#"+g).remove()})});
$("body").on("click","#albumTracksPage #albumTracks li",function(b,a){var c=$(b.target).closest("li"),d=c.attr("data-album-track-index"),g=c.attr("data-album-track-file"),c=c.attr("id");idOfAlbumTrackJustClicked="albumTrack_"+d;var k={corners:!0,shadow:!0,history:!1,positionTo:this,transition:"pop"};$("#albumTrackPopupMenu").popup("open",k);$('#albumTrackPopupMenu ul li a[data-id="addTrackToQueue"]').attr("data-album-track-index",d).attr("data-album-track-file",g);$('#albumTrackPopupMenu ul div #availablePlaylists a[data-id="addTrackToPlaylist"]').attr("data-album-track-index",
d).attr("data-album-track-file",g).attr("data-source-id",c)});$("body").on("popupafterclose","#playlistTrackPopupMenu",function(b,a){""!==idOfPlaylistTrackJustClicked&&$("#"+idOfPlaylistTrackJustClicked).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons)});$("body").on("popupafterclose","#albumTrackPopupMenu",function(b,a){""!==idOfAlbumTrackJustClicked&&$("#"+idOfAlbumTrackJustClicked).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons)});
$("body").on("click",'#albumTrackPopupMenu ul li a[data-id="addTrackToQueue"]',function(b){var a=b.target.getAttribute("data-album-track-index");b=b.target.getAttribute("data-album-track-file");$("#albumTrack_"+a).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons);post={parameters:[{file:b}]};control_mpd("add",post.parameters[0]);$("#albumTrackPopupMenu").popup("close")});
$("body").on("click",'#albumTrackPopupMenu ul div #availablePlaylists a[data-id="addTrackToPlaylist"]',function(b,a){var c=$(b.target).closest("li").attr("data-playlist-name"),d=b.target.getAttribute("data-album-track-index"),g=b.target.getAttribute("data-album-track-file");$("#albumTrack_"+d).removeClass("ui-btn-hover-"+theme.action).addClass("ui-btn-up-"+theme.buttons);post={parameters:[{playlist_name:c,file:g}]};control_mpd("track_add",post.parameters[0]);$("#albumTrackPopupMenu").popup("close")});
var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;
function simulateMouseEvent(b,a){var c,d,g,k;b.originalEvent.type.match(/^touch/)?(c=b.touches[0].screenX,d=b.touches[0].screenY,g=b.touches[0].clientX,k=b.touches[0].clientY):b.originalEvent.type.match(/^(mouse|click)/)?(c=b.originalEvent.screenX,d=b.originalEvent.screenY,g=b.originalEvent.clientX,k=b.originalEvent.clientY):k=g=d=c=0;var h=document.createEvent("MouseEvents");h.initMouseEvent(a,!0,!0,window,1,c,d,g,k,!1,!1,!1,!1,0,null);b.target.dispatchEvent(h)}
$("body").on("taphold","#playlistTracksPage #playlistTracks li a.move .ui-btn-inner",function(b,a){"undefined"!=typeof navigator.notification&&navigator.notification.vibrate(50);$(b.target).closest("li")});$("body").on("focusin",'#artists input[data-type="search"], #albums input[data-type="search"]',function(b,a){$.mobile.loadingMessage="Retrieving all";$.mobile.loading("show");$("#index").lazyloader("option","retrieve","all").lazyloader("refresh","parameter","retrieve").lazyloader("loadMore",0)});
